const Y=({x:e,y:t},n=Math.hypot(e,t))=>({x:e/n,y:t/n}),A=(e,t)=>({x:e.x+t.x,y:e.y+t.y}),_=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),B=(e,t)=>({x:e.x*t,y:e.y*t}),S=({x:e,y:t})=>({x:t,y:-e}),D=({x:e,y:t})=>({x:-e,y:-t}),P=({x:e,y:t},n,o)=>{const i=Math.sin(o),r=Math.cos(o),l=e-n.x,s=t-n.y,c=l*r-s*i,x=l*i+s*r;return{x:c+n.x,y:x+n.y}},J=(e,t)=>e.x*t.x+e.y*t.y,U=(e,t,n)=>A(e,B(_(t,e),n)),L=(e,t,n)=>A(e,B(t,n));class w{constructor(t,n,o,i,r){this.p=t,this.r=n,this.v=o,this.d=i,this.l=r}toJSON(){return[this.p.x,this.p.y,this.r]}dup(t=this.r){return new w(this.p,t,this.v,this.d,this.l)}}class M{constructor(t,n=t.length>0?t[t.length-1].l:0){this.points=t,this.length=n,this.sections=[0],this.pending={__proto__:null},this.queue=[],this.updateSections()}get empty(){return this.points.length==0}get dot(){return this.points.length==1}insert(t,n){if(t==this.points.length)n.forEach(o=>this.push(o,!0)),t=this.points.length,(n=this.pending[t])?(delete this.pending[t],this.insert(t,n)):this.updateSections();else if(t>this.points.length)this.pending[t]&&console.warn(`Override pending points from ${t}`),this.pending[t]=n;else throw new RangeError(`Position ${t} conflicts with existing points`)}push(t,n=!1){let{points:o}=this;if(o.length>0){let i,r=o[o.length-1];i={x:(t.x+r.p.x)/2,y:(t.y+r.p.y)/2,r:t.r};let l=r.p,s=Math.hypot(i.x-l.x,i.y-l.y);if(this.updateLength(s),this.length-r.l<5){r.r=Math.max(r.r,i.r);return}o.push(new w(i,i.r,Y(_(l,i)),s,this.length)),n||this.updateSections()}else o.push(new w(t,t.r,{x:1,y:1},0,0))}outline(t,n){let o=this.sections.find(r=>t<r),i=this.points.slice(t>0?t-1:t,o);if(i.length>1){let r=[],l=[],s=i.length,c=n,x=i[0].r,y=!0;o==null&&i[s-1].r==.5&&i[s-1].d>.4*n&&(s-1>=0&&(i[s-1]=i[s-1].dup(Math.max(.1,i[s-1].r-.4))),s-2>=0&&(i[s-2]=i[s-2].dup(Math.max(.1,i[s-2].r-.2))),y=!1);for(let h=0;h<s;h++){let{p:f,r:b,v:m,d:k}=i[h];h==0&&(k=0,h<s-1&&(m=i[h+1].v));let F=Math.min(1,k/n),Q=Math.min(1,1-F),V=Math.min(1,x+(Q-x)*(F*.3)),O=(h<s-1?i[h+1]:i[h]).v,G=h<s-1?J(m,O):1;c=Math.max(n*(.5*V),.75);let X=B(S(U(O,m,G)),c),H=_(f,X);r.push(H);let K=A(f,X);l.push(K),x=b}let N=[],q=[];for(let h=1/13,f=h;f<=1;f+=h)N.push(P(l[0],i[0].p,3.1416926535897933*f));if(y){let h=i[s-1],f=S(D(h.v)),b=L(h.p,f,c);for(let m=1/13,k=m;k<1;k+=m)q.push(P(b,h.p,3.1416926535897933*k))}return r.concat(q,l.reverse(),N)}else if(i.length==1){let r=i[0],l=S(D(r.v)),s=L(r.p,l,n*.36*r.r),c=[];for(let x=1/13,y=0;y<=2;y+=x)c.push(P(s,r.p,3.1416926535897933*y));return c}else return[]}updateLength(t){this.length+=t}updateSections(){let{sections:t}=this;for(let n=t.length>1?t[t.length-1]+1:2,o=this.points.length;n<o;n++)this.points[n].d<1e3&&J(this.points[n].v,this.points[n-1].v)<0&&(t.push(n),n+=1)}updateCurr(t,n){for(this.queue.push(t);this.queue.length>n;)this.queue.shift();let o=0,i=0;for(let r of this.queue)o+=r.x,i+=r.y;return n=this.queue.length,{x:o/n,y:i/n,r:t.r}}toJSON(){return this.points.map(t=>t.toJSON())}static fromJSON(t){if(!t||!Array.isArray(t))throw new RangeError("Invalid JSON representation for Stroke");return M.create(t.map(n=>({x:n[0],y:n[1],r:n[2]})))}static create(t=[]){let n=[],o=0;if(t.length>0){let i=t[0],r=0;n.push(new w(i,i.r,{x:1,y:1},0,0));for(let l=1;l<t.length;l++){let s=t[l],c=Math.hypot(s.x-i.x,s.y-i.y);if(r+=c,r-o<5){n[n.length-1].r=s.r;continue}n.push(new w(s,s.r,Y(_(i,s)),c,r)),i=s,o=r}}return new M(n,o)}}let W=document.getElementById("app"),u=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","g"),g={size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),outline:document.getElementById("outline"),data:document.getElementById("data")},z=0;function Z(e){try{let t=JSON.stringify(e.toJSON()).length;z+=t,g.data.textContent=`${R(t)} (Total: ${R(z)})`}catch(t){console.error(t)}}function R(e){return e<1024?e+" B":(e/1024).toFixed(1)+" kB"}let $={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(e,t){for(this.stack[this.index]={undo:e,redo:t},this.index+=1;this.stack.length>20;)this.stack.shift(),this.index-=1;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index-=1,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index+=1,this.update())},update(){g.undo.disabled=!this.undoable,g.redo.disabled=!this.redoable}};u.append(d);W.append(u);g.clear.onclick=()=>{let e=Array.from(d.children);d.textContent="",$.commit(()=>d.append(...e),()=>d.textContent="")};g.undo.onclick=()=>$.undo();g.redo.onclick=()=>$.redo();let a;d.setAttribute("fill","currentColor");g.outline.oninput=()=>{g.outline.checked?(d.setAttribute("fill","none"),d.setAttribute("stroke","currentColor"),d.setAttribute("stroke-width","1")):d.setAttribute("fill","currentColor")};u.setAttribute("fill-rule","nonzero");u.style.cssText="display: block; width: 100%; height: 100%; font-size: 0; touch-action: none; position: relative; contain: content";let I=!1,p={__proto__:null},E={__proto__:null};u.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),u.setPointerCapture(e.pointerId),a=u.getBoundingClientRect();let t=M.create([{x:e.clientX-a.left,y:e.clientY-a.top,r:e.pressure}]),n=document.createElementNS("http://www.w3.org/2000/svg","path");n.style.pointerEvents="none",p[e.pointerId]=[t,n,e.clientX,e.clientY],E[e.pointerId]=!0,d.append(n),!I&&(I=!0,queueMicrotask(C))};u.onpointermove=e=>{if(e.preventDefault(),e.stopPropagation(),p[e.pointerId]){let[t,n,o,i]=p[e.pointerId];if(o==e.clientX&&i==e.clientY)return;p[e.pointerId][2]=e.clientX,p[e.pointerId][3]=e.clientY;let r;if(e.pointerType==="mouse"&&r==0&&(r=.5),e.getCoalescedEvents?e.getCoalescedEvents().forEach(l=>{t.push({x:l.clientX-a.left,y:l.clientY-a.top,r:r??l.pressure})}):t.push({x:e.clientX-a.left,y:e.clientY-a.top,r:r??e.pressure}),E[e.pointerId]=!0,e.getPredictedEvents&&(p[e.pointerId][4]=e.getPredictedEvents()[0]),I)return;I=!0,queueMicrotask(C)}};u.onpointercancel=e=>{e.preventDefault(),e.stopPropagation(),p[e.pointerId]&&(p[e.pointerId][1].remove(),delete p[e.pointerId])};u.onpointerup=u.onpointerout=e=>{if(e.preventDefault(),e.stopPropagation(),p[e.pointerId]){let[t,n,o,i,r]=p[e.pointerId],l=!0;r&&(r.clientX!=o||r.clientY!=i)?(t.push({x:Math.round(r.clientX-a.left),y:Math.round(r.clientY-a.top),r:Math.max(r.pressure,.1)}),E[r.pointerId]=!0,C()):t.empty&&(n.remove(),l=!1),console.log(t),Z(t),delete p[e.pointerId],l&&$.commit(()=>n.remove(),()=>d.append(n))}};u.ontouchstart=u.ontouchmove=u.ontouchend=u.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};const T=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2}),j=({x:e,y:t})=>`M${e.toFixed(2)},${t.toFixed(2)}`,v=({x:e,y:t})=>`L${e.toFixed(2)},${t.toFixed(2)}`,tt=(e,{x:t,y:n})=>`Q${e.x.toFixed(2)},${e.y.toFixed(2)} ${t.toFixed(2)},${n.toFixed(2)}`;function C(){I=!1;let e=g.size.valueAsNumber;for(let t in E)if(p[t]){let[n,o]=p[t],i="";for(let r of n.sections)i+=et(n.outline(r,e));o.setAttribute("d",i)}E={__proto__:null}}function et(e){if(e.length==0)return"";let t=e.shift(),n=j(t),o=1;for(let i of e)o&&(n+=v(T(t,i))),n+=tt(t,T(t,i)),o=0,t=i;return n+v(e[e.length-1])}
//# sourceMappingURL=index-CHD0pGco.js.map
