const z=(e,t,i)=>e<t?t:e>i?i:e;class p{constructor(t,i){this.x=t,this.y=i}static of(t,i){return new p(t,i)}static from(t){return new p(t.x,t.y)}add(t){return new p(this.x+t.x,this.y+t.y)}subtract(t){return new p(this.x-t.x,this.y-t.y)}multiply(t){return new p(this.x*t,this.y*t)}normalize(t=Math.hypot(this.x,this.y)){return new p(this.x/t,this.y/t)}permutate(){return new p(-this.y,this.x)}negative(){return new p(-this.x,-this.y)}middle(t){return new p((this.x+t.x)/2,(this.y+t.y)/2)}rotate(t,i){const n=Math.sin(i),s=Math.cos(i),r=this.x-t.x,o=this.y-t.y,d=r*s-o*n,h=r*n+o*s;return new p(d+t.x,h+t.y)}dot(t){return this.x*t.x+this.y*t.y}lerp(t,i){return new p(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)}project(t,i){return new p(this.x+t.x*i,this.y+t.y*i)}}class Z{constructor(){this.value=-1,this.last=-1,this.target=-1}set(t){return this.target=t,this.value<0&&(this.value=t,this.last=t),this}update(t){if(t||(t=.016667),this.value>=0&&this.target>=0&&this.last>=0){let n=this.target-this.value,s=(this.value-this.last)/t,r=.7*n,o=.5*s,d=r-o,h=(s+d)*t;this.last=this.value,Math.abs(h)<.01&&Math.abs(n)<.01?this.value=this.target:this.value+=h}return this.value}}class g{constructor(t,i,n,s){this.x=t,this.y=i,this.p=n,this.t=s}static of(t,i,n,s){return new g(t,i,n,s)}static fromEvent(t,i=z(t.pressure||.5,0,1)){return new g(t.clientX,t.clientY,i,t.timeStamp)}static fromJSON(t){return new g(t.x,t.y,t.p,t.t)}}class M{constructor(t,i,n,s){this.p=t,this.v=i,this.d=n,this.l=s}static of(t,i,n,s){return new M(t,i,n,s)}static fromJSON(t){return new M(g.fromJSON(t.p),p.from(t.v),t.d,t.l)}}function j(e,t){return t-e.p.t>300?Math.min(e.p.p+.12,1):Math.min(e.p.p+.12*(t-e.p.t)/300,1)}function _(e,t,i){return i-t>300?Math.min(e+.12,1):Math.min(e+.12*(i-t)/300,1)}class S{constructor(t,i=t.length>0?t[t.length-1].l:0){this.points=t,this.length=i,this.segments=[0],this.pending={__proto__:null}}static of(t=[]){let i=new S([],0);for(let n of t)i._push(n);return i._updateSegments(),i}static fromJSON(t){let i=new S(t.points.map(M.fromJSON),t.length);return i.segments=t.segments,i.pending=t.pending,i}get empty(){return this.length==0}get dot(){return this.points.length==1}insert(t,i){if(t==this.points.length){for(let n of i)this._push(n);t=this.points.length,(i=this.pending[t])?(delete this.pending[t],this.insert(t,i)):this._updateSegments()}else if(t>this.points.length)this.pending[t]=i;else throw new RangeError(`Position ${t} conflicts with existing points`);return this}push(t){return this._push(t),this._updateSegments(),this}_push(t){let i=this.points;if(i.length>0){let n=i[i.length-1],s=Math.hypot(t.x-n.p.x,t.y-n.p.y);if(this._updateLength(s),this.length-n.l<4){n.p.p=Math.max(n.p.p,t.p);return}i.push(M.of(t,p.from(t).subtract(n.p).normalize(),s,this.length))}else i.push(M.of(t,p.of(0,0),0,0))}isSpreading(t=performance.now()){return this.points.length>0&&t-this.points[this.points.length-1].p.t<300}outline(t,i,n=performance.now()){let s=this.segments.find(o=>t<o),r=this.points.slice(t>0?t-1:t,s);if(r.length>1){let o=[],d=[],h=r.length,k=i,w=r[0].p.p,N=!0,A=0,G=new Z;if(s==null&&h>=2){let u=r[h-2];(u.p.p==.5||u.p.p==1)&&u.d>.4*i&&(N=!1)}for(let u=0;u<h;u++){let{p:f,v:$,d:I}=r[u];u==0&&(I=0,$=r[1].v);let b=Math.min(1,I/i),Q=Math.min(1,1-b),y=Math.min(1,w+(Q-w)*(b*.7)),J=(u<h-1?r[u+1]:r[u]).v,H=u<h-1?$.dot(J):1;y=G.set(y).update(A&&(f.t-A)/1e3),N||(u==h-1&&(y=.05),u==h-2&&(y=Math.max(.1,y-.2)),u==h-3&&(y=Math.max(.1,y-.1))),k=z(i*.5*_(y,f.t,n),.75,i/2);let L=J.lerp($,H).permutate().multiply(k),R=p.from(f).subtract(L),W=p.from(f).add(L);o.push(R),d.push(W),A=f.t,w=f.p}let O=[],U=d[0],T=[];for(let u=1/13,f=0;f<=1;f+=u)O.push(U.rotate(r[0].p,3.1416926535897933*f));if(N){let u=r[h-1],f=u.v.negative().permutate(),$=p.from(u.p).project(f,k);for(let I=1/13,b=0;b<1;b+=I)T.push($.rotate(u.p,3.1416926535897933*b))}return o.concat(T,d.reverse(),O)}else if(r.length==1){let o=r[0],d=p.from(o.p).project(p.of(1,0),i*.36*j(o,n)),h=[];for(let k=1/13,w=0;w<=2;w+=k)h.push(d.rotate(o.p,3.1416926535897933*w));return h}else return[]}stroke(t=this.points.map(i=>i.p)){let i=t.length;if(i==0)return"";let n=t[0],s=`M${n.x.toFixed(2)},${n.y.toFixed(2)}`;for(let r=1;r<i;r++){let o=t[r],d=p.from(n).middle(o);r==1?s+=`L${d.x.toFixed(2)},${d.y.toFixed(2)}`:s+=`Q${n.x.toFixed(2)},${n.y.toFixed(2)} ${d.x.toFixed(2)},${d.y.toFixed(2)}`,n=o}return i>1&&(s+=`L${n.x.toFixed(2)},${n.y.toFixed(2)}`),s}_updateLength(t){this.length+=t}_updateSegments(){let t=this.segments,i=this.points,n=i.length;for(let s=t[t.length-1]+1;s<n;s++)i[s].v.dot(i[s-1].v)<0&&(t.push(s),s++)}}let X=document.getElementById("app"),a=X.appendChild(document.createElementNS("http://www.w3.org/2000/svg","svg")),m=X.appendChild(document.createElement("div")),l={color:document.getElementById("stroke-color"),size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),pressure:document.getElementById("pressure"),eraser:document.getElementById("eraser")};a.setAttribute("fill-rule","nonzero");a.setAttribute("fill","currentColor");a.style.cssText=`display: block; width: 100%; height: 100%;
font-size: 0; touch-action: none; position: relative; contain: content;
overflow: hidden; overscroll-behavior: none;`;m.style.cssText=`display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
touch-action: none; contain: content; z-index: 1;`;l.color.value=matchMedia("(prefers-color-scheme: dark)").matches?"#ffffff":"#000000";l.clear.onclick=()=>{let e=Array.from(a.children);a.textContent="",C.commit(()=>a.append(...e),()=>a.textContent="")};l.undo.onclick=()=>C.undo();l.redo.onclick=()=>C.redo();let P;l.pressure.oninput=()=>{P=l.pressure.checked?void 0:.5};l.eraser.oninput=()=>{let e=l.eraser.checked;m.style.cursor=e?`url(https://api.iconify.design/mdi:eraser.svg?color=${encodeURIComponent(l.color.value)}) 12 32, auto`:"default",m.style.display=e?"block":"none"};let x=new Map;a.onpointerdown=e=>{let t=e.pointerId;x.has(t)&&Y(t),x.set(t,e),e.preventDefault(),e.stopPropagation(),a.setPointerCapture(t),V(t,g.fromEvent(e,P))};a.onpointermove=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),x.has(t)){let i=x.get(t);if(i.clientX===e.clientX&&i.clientY===e.clientY)return;if(x.set(t,e),e.getCoalescedEvents)for(let n of e.getCoalescedEvents())D(t,g.fromEvent(n,P));else D(t,g.fromEvent(e,P))}};a.onpointerup=a.onpointerout=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),x.has(t)){if(e.getPredictedEvents){let i=x.get(t).getPredictedEvents()[0];i&&D(t,g.fromEvent(i,P))}tt(t),x.delete(t)}};a.onpointercancel=e=>{let t=e.pointerId;e.preventDefault(),e.stopPropagation(),x.has(t)&&(Y(t),x.delete(t))};a.ontouchstart=a.ontouchmove=a.ontouchend=a.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let E;m.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),m.setPointerCapture(e.pointerId),q(E=g.fromEvent(e))};m.onpointermove=e=>{if(E){e.preventDefault(),e.stopPropagation();let t=g.fromEvent(e);q(t),E=t}};m.onpointerup=m.onpointerout=e=>{E=void 0};m.ontouchstart=m.ontouchmove=m.ontouchend=m.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let C={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(e,t){for(this.stack[this.index]={undo:e,redo:t},this.index++;this.stack.length>20;)this.stack.shift(),this.index--;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index--,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index++,this.update())},update(){l.undo.disabled=!this.undoable,l.redo.disabled=!this.redoable}},c={},v={},V=(e,t)=>{let i=S.of([t]),n=a.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path"));n.style.pointerEvents="none",n.style.fill=l.color.value,c[e]=[i,n],v[e]=!0,F()},D=(e,t)=>{c[e]&&(c[e][0].push(t),v[e]=!0,F(),B())},Y=e=>{c[e]&&(c[e][1].remove(),delete c[e],delete v[e])},tt=e=>{if(c[e]){let[t,i]=c[e],n=!0;t.empty&&!t.dot&&(i.remove(),n=!1),F(),delete v[e],B(),n&&C.commit(()=>i.remove(),()=>a.append(i))}},q=e=>{let t=a.createSVGPoint();t.x=e.x,t.y=e.y;for(let i of a.children)i.isPointInFill(t)&&i.remove();if(E){let i=e.x-E.x,n=e.y-E.y;for(let s=0;s<1;s+=.1){let r=a.createSVGPoint();r.x=e.x-s*i,r.y=e.y-s*n;for(let o of a.children)o.isPointInFill(r)&&o.remove()}}},F=()=>{let e=l.size.valueAsNumber;for(let t in v){if(c[t]){let[i,n]=c[t],s="";for(let r of i.segments){let o=i.outline(r,e);s+=i.stroke(o)}n.setAttribute("d",s)}delete v[t]}},K=0,B=()=>{cancelAnimationFrame(K),K=requestAnimationFrame(et)},et=()=>{F();let e=!1;for(let t in c)c[t][0].isSpreading()&&(v[t]=!0,e=!0);e&&B()},it=/Mac/.test(navigator.platform);document.onkeydown=e=>{let t=e.ctrlKey,i=e.shiftKey,n=e.metaKey,s=e.altKey,r=e.keyCode,o=it?n:t;const d=h=>{e.preventDefault(),h.focus(),h.click()};if(!t&&!i&&!n&&!s){if(r==80&&(l.eraser.checked?d(l.eraser):d(l.pressure)),r==69&&d(l.eraser),r==219||r==221){let h=l.size.valueAsNumber,k=r==221?5:-5;l.size.value=""+z(h+k,+l.size.min,+l.size.max)}}else o&&!i&&r==90?d(l.undo):o&&i&&r==90&&d(l.redo)};Object.assign(globalThis,{$settings:l,$svg:a,strokes:c,dirty:v,undoStack:C});
//# sourceMappingURL=index-DhbcDwHY.js.map
