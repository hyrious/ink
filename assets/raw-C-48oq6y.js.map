{"version":3,"file":"raw-C-48oq6y.js","sources":["../../raw.ts"],"sourcesContent":["const $svg = document.querySelector<SVGSVGElement>('#app')!\n\nconst running = new Map<number, PointerEvent>()\n\n$svg.onpointerdown = (e) => {\n  let id = e.pointerId\n  if (running.has(id)) onCancel(id)\n  running.set(id, e)\n  e.preventDefault()\n  e.stopPropagation()\n  $svg.setPointerCapture(id)\n  onOpen(id, e)\n}\n\n$svg.onpointermove = (e) => {\n  let id = e.pointerId\n  e.preventDefault()\n  e.stopPropagation()\n  if (running.has(id)) {\n    let e0 = running.get(id)!\n    // Apple pencil's bug, it fires 2 identical events.\n    if (e0.clientX === e.clientX && e0.clientY === e.clientY) return\n    running.set(id, e)\n    if (!!e.getCoalescedEvents) for (let ev of e.getCoalescedEvents()) {\n      onUpdate(id, ev)\n    } else {\n      onUpdate(id, e)\n    }\n  }\n}\n\n$svg.onpointerup = $svg.onpointerout = (e) => {\n  let id = e.pointerId\n  e.preventDefault()\n  e.stopPropagation()\n  if (running.has(id)) {\n    // The up event doesn't have meaningful predicted events.\n    if (!!e.getPredictedEvents) for (let ev of running.get(id)!.getPredictedEvents()) {\n      onUpdate(id, ev, 'green')\n    }\n    onClose(id)\n    running.delete(id)\n  }\n}\n\n$svg.onpointercancel = (e) => {\n  let id = e.pointerId\n  e.preventDefault()\n  e.stopPropagation()\n  if (running.has(id)) {\n    onCancel(id)\n    running.delete(id)\n  }\n}\n\n$svg.ontouchstart = $svg.ontouchmove = $svg.ontouchend = $svg.ontouchcancel = (e) => {\n  e.preventDefault()\n  e.stopPropagation()\n}\n\nlet strokes = new Map<number, SVGGElement>()\n\nlet addCircle = ($g: SVGGElement, x: number, y: number, r: number, stroke = 'currentColor') => {\n  let $circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle')\n  $circle.setAttribute('cx', x.toFixed(2))\n  $circle.setAttribute('cy', y.toFixed(2))\n  $circle.setAttribute('r', r.toFixed(2))\n  $circle.setAttribute('stroke', stroke)\n  $g.appendChild($circle)\n}\n\nlet onOpen = (id: number, e: PointerEvent) => {\n  let $g = document.createElementNS('http://www.w3.org/2000/svg', 'g')\n  addCircle($g, e.clientX, e.clientY, e.pressure * size, 'red')\n  $svg.appendChild($g)\n  strokes.set(id, $g)\n}\n\nlet size = 16\n\nlet onUpdate = (id: number, e: PointerEvent, stroke?: string) => {\n  if (strokes.has(id)) {\n    addCircle(strokes.get(id)!, e.clientX, e.clientY, e.pressure * size, stroke)\n  }\n}\n\nlet onCancel = (id: number) => {\n  if (strokes.has(id)) {\n    strokes.get(id)!.remove()\n    strokes.delete(id)\n  }\n}\n\nlet onClose = (id: number) => {\n  strokes.delete(id)\n}\n"],"names":["$svg","running","id","onOpen","e0","ev","onUpdate","onClose","onCancel","strokes","addCircle","$g","x","y","r","stroke","$circle","e","size"],"mappings":"AAAA,MAAMA,EAAO,SAAS,cAA6B,MAAM,EAEnDC,MAAc,IAEpBD,EAAK,cAAiB,GAAM,CAC1B,IAAIE,EAAK,EAAE,UACPD,EAAQ,IAAIC,CAAE,KAAYA,CAAE,EACxBD,EAAA,IAAIC,EAAI,CAAC,EACjB,EAAE,eAAe,EACjB,EAAE,gBAAgB,EAClBF,EAAK,kBAAkBE,CAAE,EACzBC,EAAOD,EAAI,CAAC,CACd,EAEAF,EAAK,cAAiB,GAAM,CAC1B,IAAIE,EAAK,EAAE,UAGP,GAFJ,EAAE,eAAe,EACjB,EAAE,gBAAgB,EACdD,EAAQ,IAAIC,CAAE,EAAG,CACf,IAAAE,EAAKH,EAAQ,IAAIC,CAAE,EAEvB,GAAIE,EAAG,UAAY,EAAE,SAAWA,EAAG,UAAY,EAAE,QAAS,OAEtD,GADIH,EAAA,IAAIC,EAAI,CAAC,EACX,EAAE,2BAA6BG,KAAM,EAAE,qBAC3CC,EAASJ,EAAIG,CAAE,OAEfC,EAASJ,EAAI,CAAC,CAElB,CACF,EAEAF,EAAK,YAAcA,EAAK,aAAgB,GAAM,CAC5C,IAAIE,EAAK,EAAE,UAGP,GAFJ,EAAE,eAAe,EACjB,EAAE,gBAAgB,EACdD,EAAQ,IAAIC,CAAE,EAAG,CAEf,GAAE,EAAE,mBAAoB,QAASG,KAAMJ,EAAQ,IAAIC,CAAE,EAAG,qBACjDI,EAAAJ,EAAIG,EAAI,OAAO,EAE1BE,EAAQL,CAAE,EACVD,EAAQ,OAAOC,CAAE,CACnB,CACF,EAEAF,EAAK,gBAAmB,GAAM,CAC5B,IAAIE,EAAK,EAAE,UACX,EAAE,eAAe,EACjB,EAAE,gBAAgB,EACdD,EAAQ,IAAIC,CAAE,IAChBM,EAASN,CAAE,EACXD,EAAQ,OAAOC,CAAE,EAErB,EAEAF,EAAK,aAAeA,EAAK,YAAcA,EAAK,WAAaA,EAAK,cAAiB,GAAM,CACnF,EAAE,eAAe,EACjB,EAAE,gBAAgB,CACpB,EAEA,IAAIS,MAAc,IAEdC,EAAY,CAACC,EAAiBC,EAAWC,EAAWC,EAAWC,EAAS,iBAAmB,CAC7F,IAAIC,EAAU,SAAS,gBAAgB,6BAA8B,QAAQ,EAC7EA,EAAQ,aAAa,KAAMJ,EAAE,QAAQ,CAAC,CAAC,EACvCI,EAAQ,aAAa,KAAMH,EAAE,QAAQ,CAAC,CAAC,EACvCG,EAAQ,aAAa,IAAKF,EAAE,QAAQ,CAAC,CAAC,EAC9BE,EAAA,aAAa,SAAUD,CAAM,EACrCJ,EAAG,YAAYK,CAAO,CACxB,EAEIb,EAAS,CAACD,EAAYe,IAAoB,CAC5C,IAAIN,EAAK,SAAS,gBAAgB,6BAA8B,GAAG,EACzDD,EAAAC,EAAIM,EAAE,QAASA,EAAE,QAASA,EAAE,SAAWC,EAAM,KAAK,EAC5DlB,EAAK,YAAYW,CAAE,EACXF,EAAA,IAAIP,EAAIS,CAAE,CACpB,EAEIO,EAAO,GAEPZ,EAAW,CAACJ,EAAYe,EAAiBF,IAAoB,CAC3DN,EAAQ,IAAIP,CAAE,GACNQ,EAAAD,EAAQ,IAAIP,CAAE,EAAIe,EAAE,QAASA,EAAE,QAASA,EAAE,SAAWC,EAAMH,CAAM,CAE/E,EAEIP,EAAYN,GAAe,CACzBO,EAAQ,IAAIP,CAAE,IACRO,EAAA,IAAIP,CAAE,EAAG,OAAO,EACxBO,EAAQ,OAAOP,CAAE,EAErB,EAEIK,EAAWL,GAAe,CAC5BO,EAAQ,OAAOP,CAAE,CACnB"}