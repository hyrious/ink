const D=({x:e,y:t},n=Math.hypot(e,t))=>({x:e/n,y:t/n}),S=(e,t)=>({x:e.x+t.x,y:e.y+t.y}),I=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),k=(e,t)=>({x:e.x*t,y:e.y*t}),E=({x:e,y:t})=>({x:t,y:-e}),O=({x:e,y:t})=>({x:-e,y:-t}),P=({x:e,y:t},n,s)=>{const i=Math.sin(s),r=Math.cos(s),l=e-n.x,o=t-n.y,c=l*r-o*i,g=l*i+o*r;return{x:c+n.x,y:g+n.y}},J=(e,t)=>e.x*t.x+e.y*t.y,V=(e,t,n)=>S(e,k(I(t,e),n)),L=(e,t,n)=>S(e,k(t,n));class m{constructor(t,n,s,i,r){this.p=t,this.r=n,this.v=s,this.d=i,this.l=r}toJSON(){return[this.p.x,this.p.y,this.r]}dup(t=this.r){return new m(this.p,t,this.v,this.d,this.l)}}class M{constructor(t,n=t.length>0?t[t.length-1].l:0){this.points=t,this.length=n,this.sections=[0],this.pending={__proto__:null},this.queue=[],this.updateSections()}get empty(){return this.points.length==0}get dot(){return this.points.length==1}insert(t,n){if(t==this.points.length)n.forEach(s=>this.push(s,!0)),t=this.points.length,(n=this.pending[t])?(delete this.pending[t],this.insert(t,n)):this.updateSections();else if(t>this.points.length)this.pending[t]&&console.warn(`Override pending points from ${t}`),this.pending[t]=n;else throw new RangeError(`Position ${t} conflicts with existing points`)}push(t,n=!1){let{points:s}=this;if(s.length>0){let i,r=s[s.length-1];i={x:(t.x+r.p.x)/2,y:(t.y+r.p.y)/2,r:t.r};let l=r.p,o=Math.hypot(i.x-l.x,i.y-l.y);if(this.updateLength(o),this.length-r.l<5){r.r=Math.max(r.r,i.r);return}s.push(new m(i,i.r,D(I(l,i)),o,this.length)),n||this.updateSections()}else s.push(new m(t,t.r,{x:1,y:1},0,0))}outline(t,n){let s=this.sections.find(r=>t<r),i=this.points.slice(t>0?t-1:t,s);if(i.length>1){let r=[],l=[],o=i.length,c=n,g=i[0].r,f=!0;s==null&&i[o-1].r==.5&&i[o-1].d>.4*n&&(o-1>=0&&(i[o-1]=i[o-1].dup(Math.max(.1,i[o-1].r-.4))),o-2>=0&&(i[o-2]=i[o-2].dup(Math.max(.1,i[o-2].r-.2))),f=!1);for(let p=0;p<o;p++){let{p:a,r:$,v:x,d:y}=i[p];p==0&&(y=0,p<o-1&&(x=i[p+1].v));let Y=Math.min(1,y/n),B=Math.min(1,1-Y),R=Math.min(1,g+(B-g)*(Y*.3)),A=(p<o-1?i[p+1]:i[p]).v,Q=p<o-1?J(x,A):1;c=Math.max(n*(.5*R),.75);let C=k(E(V(A,x,Q)),c),T=I(a,C);r.push(T);let v=S(a,C);l.push(v),g=$}let F=[],X=[];for(let p=1/13,a=p;a<=1;a+=p)F.push(P(l[0],i[0].p,3.1416926535897933*a));if(f){let p=i[o-1],a=E(O(p.v)),$=L(p.p,a,c);for(let x=1/13,y=x;y<1;y+=x)X.push(P($,p.p,3.1416926535897933*y))}return r.concat(X,l.reverse(),F)}else if(i.length==1){let r=i[0],l=E(O(r.v)),o=L(r.p,l,n*.4125*r.r),c=[];for(let g=1/13,f=0;f<=2;f+=g)c.push(P(o,r.p,3.1416926535897933*f));return c}else return[]}updateLength(t){this.length+=t}updateSections(){let{sections:t}=this;for(let n=t.length>1?t[t.length-1]+1:1,s=this.points.length;n<s;n++)this.points[n].d<1e3&&J(this.points[n].v,this.points[n-1].v)<0&&(t.push(n),n+=1)}updateCurr(t,n){for(this.queue.push(t);this.queue.length>n;)this.queue.shift();let s=0,i=0;for(let r of this.queue)s+=r.x,i+=r.y;return n=this.queue.length,{x:s/n,y:i/n,r:t.r}}toJSON(){return this.points.map(t=>t.toJSON())}static fromJSON(t){if(!t||!Array.isArray(t))throw new RangeError("Invalid JSON representation for Stroke");return M.create(t.map(n=>({x:n[0],y:n[1],r:n[2]})))}static create(t=[]){let n=[],s=0;if(t.length>0){let i=t[0],r=0;n.push(new m(i,i.r,{x:1,y:1},0,0));for(let l=1;l<t.length;l++){let o=t[l],c=Math.hypot(o.x-i.x,o.y-i.y);if(r+=c,r-s<5){n[n.length-1].r=o.r;continue}n.push(new m(o,o.r,D(I(i,o)),c,r)),i=o,s=r}}return new M(n,s)}}let G=document.getElementById("app"),h=document.createElementNS("http://www.w3.org/2000/svg","svg"),q=document.createElementNS("http://www.w3.org/2000/svg","g"),H={size:document.getElementById("stroke-size")};h.append(q);G.append(h);let d;q.setAttribute("fill","currentColor");h.setAttribute("fill-rule","nonzero");h.style.cssText="display: block; width: 100%; height: 100%; font-size: 0; touch-action: none; position: relative";let w=!1,u={__proto__:null},_={__proto__:null};h.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),h.setPointerCapture(e.pointerId),d=h.getBoundingClientRect();let t=M.create([{x:e.clientX-d.left,y:e.clientY-d.top,r:e.pressure}]),n=document.createElementNS("http://www.w3.org/2000/svg","path");n.style.pointerEvents="none",u[e.pointerId]=[t,n,e.clientX,e.clientY],_[e.pointerId]=!0,q.append(n),!w&&(w=!0,queueMicrotask(N))};h.onpointermove=e=>{if(e.preventDefault(),e.stopPropagation(),u[e.pointerId]){let[t,n,s,i]=u[e.pointerId];if(s==e.clientX&&i==e.clientY)return;u[e.pointerId][2]=e.clientX,u[e.pointerId][3]=e.clientY;let r;if(e.pointerType==="mouse"&&r==0&&(r=.5),e.getCoalescedEvents?e.getCoalescedEvents().forEach(l=>{t.push({x:l.clientX-d.left,y:l.clientY-d.top,r:r??l.pressure})}):t.push({x:e.clientX-d.left,y:e.clientY-d.top,r:r??e.pressure}),_[e.pointerId]=!0,e.getPredictedEvents&&(u[e.pointerId][4]=e.getPredictedEvents()[0]),w)return;w=!0,queueMicrotask(N)}};h.onpointercancel=e=>{e.preventDefault(),e.stopPropagation(),u[e.pointerId]&&(u[e.pointerId][1].remove(),delete u[e.pointerId])};h.onpointerup=h.onpointerout=e=>{if(e.preventDefault(),e.stopPropagation(),u[e.pointerId]){let[t,n,s,i,r]=u[e.pointerId];r&&(r.clientX!=s||r.clientY!=i)?(t.push({x:Math.round(r.clientX-d.left),y:Math.round(r.clientY-d.top),r:Math.max(r.pressure,.1)}),_[r.pointerId]=!0,N()):t.empty&&n.remove(),console.log(t),delete u[e.pointerId]}};h.ontouchstart=h.ontouchmove=h.ontouchend=h.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};const b=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2}),K=({x:e,y:t})=>`M${e.toFixed(2)},${t.toFixed(2)}`,z=({x:e,y:t})=>`L${e.toFixed(2)},${t.toFixed(2)}`,U=(e,{x:t,y:n})=>`Q${e.x.toFixed(2)},${e.y.toFixed(2)} ${t.toFixed(2)},${n.toFixed(2)}`;function N(){w=!1;let e=H.size.valueAsNumber;for(let t in _)if(u[t]){let[n,s]=u[t],i="";for(let r of n.sections)i+=W(n.outline(r,e));s.setAttribute("d",i)}_={__proto__:null}}function W(e){if(e.length==0)return"";let t=e.shift(),n=K(t),s=1;for(let i of e)s&&(n+=z(b(t,i))),n+=U(t,b(t,i)),s=0,t=i;return n+z(e[e.length-1])}
//# sourceMappingURL=index-Clbkz6Zh.js.map
