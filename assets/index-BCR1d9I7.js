var Ne=Object.defineProperty;var Ae=(l,t,e)=>t in l?Ne(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var T=(l,t,e)=>(Ae(l,typeof t!="symbol"?t+"":t,e),e);const we=l=>()=>l,Kt=l=>{const t=l?(e,i)=>i.minus(e).abs().isLessThanOrEqualTo(l):we(!1);return(e,i)=>t(e,i)?0:e.comparedTo(i)};function Re(l){const t=l?(e,i,n,r,c)=>e.exponentiatedBy(2).isLessThanOrEqualTo(r.minus(i).exponentiatedBy(2).plus(c.minus(n).exponentiatedBy(2)).times(l)):we(!1);return(e,i,n)=>{const r=e.x,c=e.y,h=n.x,d=n.y,E=c.minus(d).times(i.x.minus(h)).minus(r.minus(h).times(i.y.minus(d)));return t(E,r,c,h,d)?0:E.comparedTo(0)}}var Me=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Ft=Math.ceil,Z=Math.floor,V="[BigNumber Error] ",re=V+"Number primitive has more than 15 significant digits: ",it=1e14,R=14,$t=9007199254740991,Ut=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ht=1e7,$=1e9;function Ee(l){var t,e,i,n=_.prototype={constructor:_,toString:null,valueOf:null},r=new _(1),c=20,h=4,d=-7,E=21,S=-1e7,b=1e7,A=!1,N=1,P=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},C="0123456789abcdefghijklmnopqrstuvwxyz",nt=!0;function _(s,o){var u,m,a,g,w,f,p,x,y=this;if(!(y instanceof _))return new _(s,o);if(o==null){if(s&&s._isBigNumber===!0){y.s=s.s,!s.c||s.e>b?y.c=y.e=null:s.e<S?y.c=[y.e=0]:(y.e=s.e,y.c=s.c.slice());return}if((f=typeof s=="number")&&s*0==0){if(y.s=1/s<0?(s=-s,-1):1,s===~~s){for(g=0,w=s;w>=10;w/=10,g++);g>b?y.c=y.e=null:(y.e=g,y.c=[s]);return}x=String(s)}else{if(!Me.test(x=String(s)))return i(y,x,f);y.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}(g=x.indexOf("."))>-1&&(x=x.replace(".","")),(w=x.search(/e/i))>0?(g<0&&(g=w),g+=+x.slice(w+1),x=x.substring(0,w)):g<0&&(g=x.length)}else{if(B(o,2,C.length,"Base"),o==10&&nt)return y=new _(s),K(y,c+y.e+1,h);if(x=String(s),f=typeof s=="number"){if(s*0!=0)return i(y,x,f,o);if(y.s=1/s<0?(x=x.slice(1),-1):1,_.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(re+s)}else y.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(u=C.slice(0,o),g=w=0,p=x.length;w<p;w++)if(u.indexOf(m=x.charAt(w))<0){if(m=="."){if(w>g){g=p;continue}}else if(!a&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){a=!0,w=-1,g=0;continue}return i(y,String(s),f,o)}f=!1,x=e(x,o,10,y.s),(g=x.indexOf("."))>-1?x=x.replace(".",""):g=x.length}for(w=0;x.charCodeAt(w)===48;w++);for(p=x.length;x.charCodeAt(--p)===48;);if(x=x.slice(w,++p)){if(p-=w,f&&_.DEBUG&&p>15&&(s>$t||s!==Z(s)))throw Error(re+y.s*s);if((g=g-w-1)>b)y.c=y.e=null;else if(g<S)y.c=[y.e=0];else{if(y.e=g,y.c=[],w=(g+1)%R,g<0&&(w+=R),w<p){for(w&&y.c.push(+x.slice(0,w)),p-=R;w<p;)y.c.push(+x.slice(w,w+=R));w=R-(x=x.slice(w)).length}else w-=p;for(;w--;x+="0");y.c.push(+x)}}else y.c=[y.e=0]}_.clone=Ee,_.ROUND_UP=0,_.ROUND_DOWN=1,_.ROUND_CEIL=2,_.ROUND_FLOOR=3,_.ROUND_HALF_UP=4,_.ROUND_HALF_DOWN=5,_.ROUND_HALF_EVEN=6,_.ROUND_HALF_CEIL=7,_.ROUND_HALF_FLOOR=8,_.EUCLID=9,_.config=_.set=function(s){var o,u;if(s!=null)if(typeof s=="object"){if(s.hasOwnProperty(o="DECIMAL_PLACES")&&(u=s[o],B(u,0,$,o),c=u),s.hasOwnProperty(o="ROUNDING_MODE")&&(u=s[o],B(u,0,8,o),h=u),s.hasOwnProperty(o="EXPONENTIAL_AT")&&(u=s[o],u&&u.pop?(B(u[0],-$,0,o),B(u[1],0,$,o),d=u[0],E=u[1]):(B(u,-$,$,o),d=-(E=u<0?-u:u))),s.hasOwnProperty(o="RANGE"))if(u=s[o],u&&u.pop)B(u[0],-$,-1,o),B(u[1],1,$,o),S=u[0],b=u[1];else if(B(u,-$,$,o),u)S=-(b=u<0?-u:u);else throw Error(V+o+" cannot be zero: "+u);if(s.hasOwnProperty(o="CRYPTO"))if(u=s[o],u===!!u)if(u)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))A=u;else throw A=!u,Error(V+"crypto unavailable");else A=u;else throw Error(V+o+" not true or false: "+u);if(s.hasOwnProperty(o="MODULO_MODE")&&(u=s[o],B(u,0,9,o),N=u),s.hasOwnProperty(o="POW_PRECISION")&&(u=s[o],B(u,0,$,o),P=u),s.hasOwnProperty(o="FORMAT"))if(u=s[o],typeof u=="object")U=u;else throw Error(V+o+" not an object: "+u);if(s.hasOwnProperty(o="ALPHABET"))if(u=s[o],typeof u=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(u))nt=u.slice(0,10)=="0123456789",C=u;else throw Error(V+o+" invalid: "+u)}else throw Error(V+"Object expected: "+s);return{DECIMAL_PLACES:c,ROUNDING_MODE:h,EXPONENTIAL_AT:[d,E],RANGE:[S,b],CRYPTO:A,MODULO_MODE:N,POW_PRECISION:P,FORMAT:U,ALPHABET:C}},_.isBigNumber=function(s){if(!s||s._isBigNumber!==!0)return!1;if(!_.DEBUG)return!0;var o,u,m=s.c,a=s.e,g=s.s;t:if({}.toString.call(m)=="[object Array]"){if((g===1||g===-1)&&a>=-$&&a<=$&&a===Z(a)){if(m[0]===0){if(a===0&&m.length===1)return!0;break t}if(o=(a+1)%R,o<1&&(o+=R),String(m[0]).length==o){for(o=0;o<m.length;o++)if(u=m[o],u<0||u>=it||u!==Z(u))break t;if(u!==0)return!0}}}else if(m===null&&a===null&&(g===null||g===1||g===-1))return!0;throw Error(V+"Invalid BigNumber: "+s)},_.maximum=_.max=function(){return Ot(arguments,-1)},_.minimum=_.min=function(){return Ot(arguments,1)},_.random=function(){var s=9007199254740992,o=Math.random()*s&2097151?function(){return Z(Math.random()*s)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(u){var m,a,g,w,f,p=0,x=[],y=new _(r);if(u==null?u=c:B(u,0,$),w=Ft(u/R),A)if(crypto.getRandomValues){for(m=crypto.getRandomValues(new Uint32Array(w*=2));p<w;)f=m[p]*131072+(m[p+1]>>>11),f>=9e15?(a=crypto.getRandomValues(new Uint32Array(2)),m[p]=a[0],m[p+1]=a[1]):(x.push(f%1e14),p+=2);p=w/2}else if(crypto.randomBytes){for(m=crypto.randomBytes(w*=7);p<w;)f=(m[p]&31)*281474976710656+m[p+1]*1099511627776+m[p+2]*4294967296+m[p+3]*16777216+(m[p+4]<<16)+(m[p+5]<<8)+m[p+6],f>=9e15?crypto.randomBytes(7).copy(m,p):(x.push(f%1e14),p+=7);p=w/7}else throw A=!1,Error(V+"crypto unavailable");if(!A)for(;p<w;)f=o(),f<9e15&&(x[p++]=f%1e14);for(w=x[--p],u%=R,w&&u&&(f=Ut[R-u],x[p]=Z(w/f)*f);x[p]===0;x.pop(),p--);if(p<0)x=[g=0];else{for(g=-1;x[0]===0;x.splice(0,1),g-=R);for(p=1,f=x[0];f>=10;f/=10,p++);p<R&&(g-=R-p)}return y.e=g,y.c=x,y}}(),_.sum=function(){for(var s=1,o=arguments,u=new _(o[0]);s<o.length;)u=u.plus(o[s++]);return u},e=function(){var s="0123456789";function o(u,m,a,g){for(var w,f=[0],p,x=0,y=u.length;x<y;){for(p=f.length;p--;f[p]*=m);for(f[0]+=g.indexOf(u.charAt(x++)),w=0;w<f.length;w++)f[w]>a-1&&(f[w+1]==null&&(f[w+1]=0),f[w+1]+=f[w]/a|0,f[w]%=a)}return f.reverse()}return function(u,m,a,g,w){var f,p,x,y,v,O,I,L,q=u.indexOf("."),F=c,M=h;for(q>=0&&(y=P,P=0,u=u.replace(".",""),L=new _(m),O=L.pow(u.length-q),P=y,L.c=o(lt(j(O.c),O.e,"0"),10,a,s),L.e=L.c.length),I=o(u,m,a,w?(f=C,s):(f=s,C)),x=y=I.length;I[--y]==0;I.pop());if(!I[0])return f.charAt(0);if(q<0?--x:(O.c=I,O.e=x,O.s=g,O=t(O,L,F,M,a),I=O.c,v=O.r,x=O.e),p=x+F+1,q=I[p],y=a/2,v=v||p<0||I[p+1]!=null,v=M<4?(q!=null||v)&&(M==0||M==(O.s<0?3:2)):q>y||q==y&&(M==4||v||M==6&&I[p-1]&1||M==(O.s<0?8:7)),p<1||!I[0])u=v?lt(f.charAt(1),-F,f.charAt(0)):f.charAt(0);else{if(I.length=p,v)for(--a;++I[--p]>a;)I[p]=0,p||(++x,I=[1].concat(I));for(y=I.length;!I[--y];);for(q=0,u="";q<=y;u+=f.charAt(I[q++]));u=lt(u,x,f.charAt(0))}return u}}(),t=function(){function s(m,a,g){var w,f,p,x,y=0,v=m.length,O=a%ht,I=a/ht|0;for(m=m.slice();v--;)p=m[v]%ht,x=m[v]/ht|0,w=I*p+x*O,f=O*p+w%ht*ht+y,y=(f/g|0)+(w/ht|0)+I*x,m[v]=f%g;return y&&(m=[y].concat(m)),m}function o(m,a,g,w){var f,p;if(g!=w)p=g>w?1:-1;else for(f=p=0;f<g;f++)if(m[f]!=a[f]){p=m[f]>a[f]?1:-1;break}return p}function u(m,a,g,w){for(var f=0;g--;)m[g]-=f,f=m[g]<a[g]?1:0,m[g]=f*w+m[g]-a[g];for(;!m[0]&&m.length>1;m.splice(0,1));}return function(m,a,g,w,f){var p,x,y,v,O,I,L,q,F,M,k,X,It,zt,Dt,st,wt,J=m.s==a.s?1:-1,Y=m.c,z=a.c;if(!Y||!Y[0]||!z||!z[0])return new _(!m.s||!a.s||(Y?z&&Y[0]==z[0]:!z)?NaN:Y&&Y[0]==0||!z?J*0:J/0);for(q=new _(J),F=q.c=[],x=m.e-a.e,J=g+x+1,f||(f=it,x=W(m.e/R)-W(a.e/R),J=J/R|0),y=0;z[y]==(Y[y]||0);y++);if(z[y]>(Y[y]||0)&&x--,J<0)F.push(1),v=!0;else{for(zt=Y.length,st=z.length,y=0,J+=2,O=Z(f/(z[0]+1)),O>1&&(z=s(z,O,f),Y=s(Y,O,f),st=z.length,zt=Y.length),It=st,M=Y.slice(0,st),k=M.length;k<st;M[k++]=0);wt=z.slice(),wt=[0].concat(wt),Dt=z[0],z[1]>=f/2&&Dt++;do{if(O=0,p=o(z,M,st,k),p<0){if(X=M[0],st!=k&&(X=X*f+(M[1]||0)),O=Z(X/Dt),O>1)for(O>=f&&(O=f-1),I=s(z,O,f),L=I.length,k=M.length;o(I,M,L,k)==1;)O--,u(I,st<L?wt:z,L,f),L=I.length,p=1;else O==0&&(p=O=1),I=z.slice(),L=I.length;if(L<k&&(I=[0].concat(I)),u(M,I,k,f),k=M.length,p==-1)for(;o(z,M,st,k)<1;)O++,u(M,st<k?wt:z,k,f),k=M.length}else p===0&&(O++,M=[0]);F[y++]=O,M[0]?M[k++]=Y[It]||0:(M=[Y[It]],k=1)}while((It++<zt||M[0]!=null)&&J--);v=M[0]!=null,F[0]||F.splice(0,1)}if(f==it){for(y=1,J=F[0];J>=10;J/=10,y++);K(q,g+(q.e=y+x*R-1)+1,w,v)}else q.e=x,q.r=+v;return q}}();function xt(s,o,u,m){var a,g,w,f,p;if(u==null?u=h:B(u,0,8),!s.c)return s.toString();if(a=s.c[0],w=s.e,o==null)p=j(s.c),p=m==1||m==2&&(w<=d||w>=E)?At(p,w):lt(p,w,"0");else if(s=K(new _(s),o,u),g=s.e,p=j(s.c),f=p.length,m==1||m==2&&(o<=g||g<=d)){for(;f<o;p+="0",f++);p=At(p,g)}else if(o-=w,p=lt(p,g,"0"),g+1>f){if(--o>0)for(p+=".";o--;p+="0");}else if(o+=g-f,o>0)for(g+1==f&&(p+=".");o--;p+="0");return s.s<0&&a?"-"+p:p}function Ot(s,o){for(var u,m,a=1,g=new _(s[0]);a<s.length;a++)m=new _(s[a]),(!m.s||(u=ct(g,m))===o||u===0&&g.s===o)&&(g=m);return g}function pt(s,o,u){for(var m=1,a=o.length;!o[--a];o.pop());for(a=o[0];a>=10;a/=10,m++);return(u=m+u*R-1)>b?s.c=s.e=null:u<S?s.c=[s.e=0]:(s.e=u,s.c=o),s}i=function(){var s=/^(-?)0([xbo])(?=\w[\w.]*$)/i,o=/^([^.]+)\.$/,u=/^\.([^.]+)$/,m=/^-?(Infinity|NaN)$/,a=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(g,w,f,p){var x,y=f?w:w.replace(a,"");if(m.test(y))g.s=isNaN(y)?null:y<0?-1:1;else{if(!f&&(y=y.replace(s,function(v,O,I){return x=(I=I.toLowerCase())=="x"?16:I=="b"?2:8,!p||p==x?O:v}),p&&(x=p,y=y.replace(o,"$1").replace(u,"0.$1")),w!=y))return new _(y,x);if(_.DEBUG)throw Error(V+"Not a"+(p?" base "+p:"")+" number: "+w);g.s=null}g.c=g.e=null}}();function K(s,o,u,m){var a,g,w,f,p,x,y,v=s.c,O=Ut;if(v){t:{for(a=1,f=v[0];f>=10;f/=10,a++);if(g=o-a,g<0)g+=R,w=o,p=v[x=0],y=Z(p/O[a-w-1]%10);else if(x=Ft((g+1)/R),x>=v.length)if(m){for(;v.length<=x;v.push(0));p=y=0,a=1,g%=R,w=g-R+1}else break t;else{for(p=f=v[x],a=1;f>=10;f/=10,a++);g%=R,w=g-R+a,y=w<0?0:Z(p/O[a-w-1]%10)}if(m=m||o<0||v[x+1]!=null||(w<0?p:p%O[a-w-1]),m=u<4?(y||m)&&(u==0||u==(s.s<0?3:2)):y>5||y==5&&(u==4||m||u==6&&(g>0?w>0?p/O[a-w]:0:v[x-1])%10&1||u==(s.s<0?8:7)),o<1||!v[0])return v.length=0,m?(o-=s.e+1,v[0]=O[(R-o%R)%R],s.e=-o||0):v[0]=s.e=0,s;if(g==0?(v.length=x,f=1,x--):(v.length=x+1,f=O[R-g],v[x]=w>0?Z(p/O[a-w]%O[w])*f:0),m)for(;;)if(x==0){for(g=1,w=v[0];w>=10;w/=10,g++);for(w=v[0]+=f,f=1;w>=10;w/=10,f++);g!=f&&(s.e++,v[0]==it&&(v[0]=1));break}else{if(v[x]+=f,v[x]!=it)break;v[x--]=0,f=1}for(g=v.length;v[--g]===0;v.pop());}s.e>b?s.c=s.e=null:s.e<S&&(s.c=[s.e=0])}return s}function H(s){var o,u=s.e;return u===null?s.toString():(o=j(s.c),o=u<=d||u>=E?At(o,u):lt(o,u,"0"),s.s<0?"-"+o:o)}return n.absoluteValue=n.abs=function(){var s=new _(this);return s.s<0&&(s.s=1),s},n.comparedTo=function(s,o){return ct(this,new _(s,o))},n.decimalPlaces=n.dp=function(s,o){var u,m,a,g=this;if(s!=null)return B(s,0,$),o==null?o=h:B(o,0,8),K(new _(g),s+g.e+1,o);if(!(u=g.c))return null;if(m=((a=u.length-1)-W(this.e/R))*R,a=u[a])for(;a%10==0;a/=10,m--);return m<0&&(m=0),m},n.dividedBy=n.div=function(s,o){return t(this,new _(s,o),c,h)},n.dividedToIntegerBy=n.idiv=function(s,o){return t(this,new _(s,o),0,1)},n.exponentiatedBy=n.pow=function(s,o){var u,m,a,g,w,f,p,x,y,v=this;if(s=new _(s),s.c&&!s.isInteger())throw Error(V+"Exponent not an integer: "+H(s));if(o!=null&&(o=new _(o)),f=s.e>14,!v.c||!v.c[0]||v.c[0]==1&&!v.e&&v.c.length==1||!s.c||!s.c[0])return y=new _(Math.pow(+H(v),f?s.s*(2-Nt(s)):+H(s))),o?y.mod(o):y;if(p=s.s<0,o){if(o.c?!o.c[0]:!o.s)return new _(NaN);m=!p&&v.isInteger()&&o.isInteger(),m&&(v=v.mod(o))}else{if(s.e>9&&(v.e>0||v.e<-1||(v.e==0?v.c[0]>1||f&&v.c[1]>=24e7:v.c[0]<8e13||f&&v.c[0]<=9999975e7)))return g=v.s<0&&Nt(s)?-0:0,v.e>-1&&(g=1/g),new _(p?1/g:g);P&&(g=Ft(P/R+2))}for(f?(u=new _(.5),p&&(s.s=1),x=Nt(s)):(a=Math.abs(+H(s)),x=a%2),y=new _(r);;){if(x){if(y=y.times(v),!y.c)break;g?y.c.length>g&&(y.c.length=g):m&&(y=y.mod(o))}if(a){if(a=Z(a/2),a===0)break;x=a%2}else if(s=s.times(u),K(s,s.e+1,1),s.e>14)x=Nt(s);else{if(a=+H(s),a===0)break;x=a%2}v=v.times(v),g?v.c&&v.c.length>g&&(v.c.length=g):m&&(v=v.mod(o))}return m?y:(p&&(y=r.div(y)),o?y.mod(o):g?K(y,P,h,w):y)},n.integerValue=function(s){var o=new _(this);return s==null?s=h:B(s,0,8),K(o,o.e+1,s)},n.isEqualTo=n.eq=function(s,o){return ct(this,new _(s,o))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(s,o){return ct(this,new _(s,o))>0},n.isGreaterThanOrEqualTo=n.gte=function(s,o){return(o=ct(this,new _(s,o)))===1||o===0},n.isInteger=function(){return!!this.c&&W(this.e/R)>this.c.length-2},n.isLessThan=n.lt=function(s,o){return ct(this,new _(s,o))<0},n.isLessThanOrEqualTo=n.lte=function(s,o){return(o=ct(this,new _(s,o)))===-1||o===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(s,o){var u,m,a,g,w=this,f=w.s;if(s=new _(s,o),o=s.s,!f||!o)return new _(NaN);if(f!=o)return s.s=-o,w.plus(s);var p=w.e/R,x=s.e/R,y=w.c,v=s.c;if(!p||!x){if(!y||!v)return y?(s.s=-o,s):new _(v?w:NaN);if(!y[0]||!v[0])return v[0]?(s.s=-o,s):new _(y[0]?w:h==3?-0:0)}if(p=W(p),x=W(x),y=y.slice(),f=p-x){for((g=f<0)?(f=-f,a=y):(x=p,a=v),a.reverse(),o=f;o--;a.push(0));a.reverse()}else for(m=(g=(f=y.length)<(o=v.length))?f:o,f=o=0;o<m;o++)if(y[o]!=v[o]){g=y[o]<v[o];break}if(g&&(a=y,y=v,v=a,s.s=-s.s),o=(m=v.length)-(u=y.length),o>0)for(;o--;y[u++]=0);for(o=it-1;m>f;){if(y[--m]<v[m]){for(u=m;u&&!y[--u];y[u]=o);--y[u],y[m]+=it}y[m]-=v[m]}for(;y[0]==0;y.splice(0,1),--x);return y[0]?pt(s,y,x):(s.s=h==3?-1:1,s.c=[s.e=0],s)},n.modulo=n.mod=function(s,o){var u,m,a=this;return s=new _(s,o),!a.c||!s.s||s.c&&!s.c[0]?new _(NaN):!s.c||a.c&&!a.c[0]?new _(a):(N==9?(m=s.s,s.s=1,u=t(a,s,0,3),s.s=m,u.s*=m):u=t(a,s,0,N),s=a.minus(u.times(s)),!s.c[0]&&N==1&&(s.s=a.s),s)},n.multipliedBy=n.times=function(s,o){var u,m,a,g,w,f,p,x,y,v,O,I,L,q,F,M=this,k=M.c,X=(s=new _(s,o)).c;if(!k||!X||!k[0]||!X[0])return!M.s||!s.s||k&&!k[0]&&!X||X&&!X[0]&&!k?s.c=s.e=s.s=null:(s.s*=M.s,!k||!X?s.c=s.e=null:(s.c=[0],s.e=0)),s;for(m=W(M.e/R)+W(s.e/R),s.s*=M.s,p=k.length,v=X.length,p<v&&(L=k,k=X,X=L,a=p,p=v,v=a),a=p+v,L=[];a--;L.push(0));for(q=it,F=ht,a=v;--a>=0;){for(u=0,O=X[a]%F,I=X[a]/F|0,w=p,g=a+w;g>a;)x=k[--w]%F,y=k[w]/F|0,f=I*x+y*O,x=O*x+f%F*F+L[g]+u,u=(x/q|0)+(f/F|0)+I*y,L[g--]=x%q;L[g]=u}return u?++m:L.splice(0,1),pt(s,L,m)},n.negated=function(){var s=new _(this);return s.s=-s.s||null,s},n.plus=function(s,o){var u,m=this,a=m.s;if(s=new _(s,o),o=s.s,!a||!o)return new _(NaN);if(a!=o)return s.s=-o,m.minus(s);var g=m.e/R,w=s.e/R,f=m.c,p=s.c;if(!g||!w){if(!f||!p)return new _(a/0);if(!f[0]||!p[0])return p[0]?s:new _(f[0]?m:a*0)}if(g=W(g),w=W(w),f=f.slice(),a=g-w){for(a>0?(w=g,u=p):(a=-a,u=f),u.reverse();a--;u.push(0));u.reverse()}for(a=f.length,o=p.length,a-o<0&&(u=p,p=f,f=u,o=a),a=0;o;)a=(f[--o]=f[o]+p[o]+a)/it|0,f[o]=it===f[o]?0:f[o]%it;return a&&(f=[a].concat(f),++w),pt(s,f,w)},n.precision=n.sd=function(s,o){var u,m,a,g=this;if(s!=null&&s!==!!s)return B(s,1,$),o==null?o=h:B(o,0,8),K(new _(g),s,o);if(!(u=g.c))return null;if(a=u.length-1,m=a*R+1,a=u[a]){for(;a%10==0;a/=10,m--);for(a=u[0];a>=10;a/=10,m++);}return s&&g.e+1>m&&(m=g.e+1),m},n.shiftedBy=function(s){return B(s,-$t,$t),this.times("1e"+s)},n.squareRoot=n.sqrt=function(){var s,o,u,m,a,g=this,w=g.c,f=g.s,p=g.e,x=c+4,y=new _("0.5");if(f!==1||!w||!w[0])return new _(!f||f<0&&(!w||w[0])?NaN:w?g:1/0);if(f=Math.sqrt(+H(g)),f==0||f==1/0?(o=j(w),(o.length+p)%2==0&&(o+="0"),f=Math.sqrt(+o),p=W((p+1)/2)-(p<0||p%2),f==1/0?o="5e"+p:(o=f.toExponential(),o=o.slice(0,o.indexOf("e")+1)+p),u=new _(o)):u=new _(f+""),u.c[0]){for(p=u.e,f=p+x,f<3&&(f=0);;)if(a=u,u=y.times(a.plus(t(g,a,x,1))),j(a.c).slice(0,f)===(o=j(u.c)).slice(0,f))if(u.e<p&&--f,o=o.slice(f-3,f+1),o=="9999"||!m&&o=="4999"){if(!m&&(K(a,a.e+c+2,0),a.times(a).eq(g))){u=a;break}x+=4,f+=4,m=1}else{(!+o||!+o.slice(1)&&o.charAt(0)=="5")&&(K(u,u.e+c+2,1),s=!u.times(u).eq(g));break}}return K(u,u.e+c+1,h,s)},n.toExponential=function(s,o){return s!=null&&(B(s,0,$),s++),xt(this,s,o,1)},n.toFixed=function(s,o){return s!=null&&(B(s,0,$),s=s+this.e+1),xt(this,s,o)},n.toFormat=function(s,o,u){var m,a=this;if(u==null)s!=null&&o&&typeof o=="object"?(u=o,o=null):s&&typeof s=="object"?(u=s,s=o=null):u=U;else if(typeof u!="object")throw Error(V+"Argument not an object: "+u);if(m=a.toFixed(s,o),a.c){var g,w=m.split("."),f=+u.groupSize,p=+u.secondaryGroupSize,x=u.groupSeparator||"",y=w[0],v=w[1],O=a.s<0,I=O?y.slice(1):y,L=I.length;if(p&&(g=f,f=p,p=g,L-=g),f>0&&L>0){for(g=L%f||f,y=I.substr(0,g);g<L;g+=f)y+=x+I.substr(g,f);p>0&&(y+=x+I.slice(g)),O&&(y="-"+y)}m=v?y+(u.decimalSeparator||"")+((p=+u.fractionGroupSize)?v.replace(new RegExp("\\d{"+p+"}\\B","g"),"$&"+(u.fractionGroupSeparator||"")):v):y}return(u.prefix||"")+m+(u.suffix||"")},n.toFraction=function(s){var o,u,m,a,g,w,f,p,x,y,v,O,I=this,L=I.c;if(s!=null&&(f=new _(s),!f.isInteger()&&(f.c||f.s!==1)||f.lt(r)))throw Error(V+"Argument "+(f.isInteger()?"out of range: ":"not an integer: ")+H(f));if(!L)return new _(I);for(o=new _(r),x=u=new _(r),m=p=new _(r),O=j(L),g=o.e=O.length-I.e-1,o.c[0]=Ut[(w=g%R)<0?R+w:w],s=!s||f.comparedTo(o)>0?g>0?o:x:f,w=b,b=1/0,f=new _(O),p.c[0]=0;y=t(f,o,0,1),a=u.plus(y.times(m)),a.comparedTo(s)!=1;)u=m,m=a,x=p.plus(y.times(a=x)),p=a,o=f.minus(y.times(a=o)),f=a;return a=t(s.minus(u),m,0,1),p=p.plus(a.times(x)),u=u.plus(a.times(m)),p.s=x.s=I.s,g=g*2,v=t(x,m,g,h).minus(I).abs().comparedTo(t(p,u,g,h).minus(I).abs())<1?[x,m]:[p,u],b=w,v},n.toNumber=function(){return+H(this)},n.toPrecision=function(s,o){return s!=null&&B(s,1,$),xt(this,s,o,2)},n.toString=function(s){var o,u=this,m=u.s,a=u.e;return a===null?m?(o="Infinity",m<0&&(o="-"+o)):o="NaN":(s==null?o=a<=d||a>=E?At(j(u.c),a):lt(j(u.c),a,"0"):s===10&&nt?(u=K(new _(u),c+a+1,h),o=lt(j(u.c),u.e,"0")):(B(s,2,C.length,"Base"),o=e(lt(j(u.c),a,"0"),10,s,m,!0)),m<0&&u.c[0]&&(o="-"+o)),o},n.valueOf=n.toJSON=function(){return H(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,l!=null&&_.set(l),_}function W(l){var t=l|0;return l>0||l===t?t:t-1}function j(l){for(var t,e,i=1,n=l.length,r=l[0]+"";i<n;){for(t=l[i++]+"",e=R-t.length;e--;t="0"+t);r+=t}for(n=r.length;r.charCodeAt(--n)===48;);return r.slice(0,n+1||1)}function ct(l,t){var e,i,n=l.c,r=t.c,c=l.s,h=t.s,d=l.e,E=t.e;if(!c||!h)return null;if(e=n&&!n[0],i=r&&!r[0],e||i)return e?i?0:-h:c;if(c!=h)return c;if(e=c<0,i=d==E,!n||!r)return i?0:!n^e?1:-1;if(!i)return d>E^e?1:-1;for(h=(d=n.length)<(E=r.length)?d:E,c=0;c<h;c++)if(n[c]!=r[c])return n[c]>r[c]^e?1:-1;return d==E?0:d>E^e?1:-1}function B(l,t,e,i){if(l<t||l>e||l!==Z(l))throw Error(V+(i||"Argument")+(typeof l=="number"?l<t||l>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(l))}function Nt(l){var t=l.c.length-1;return W(l.e/R)==t&&l.c[t]%2!=0}function At(l,t){return(l.length>1?l.charAt(0)+"."+l.slice(1):l)+(t<0?"e":"e+")+t}function lt(l,t,e){var i,n;if(t<0){for(n=e+".";++t;n+=e);l=n+l}else if(i=l.length,++t>i){for(n=e,t-=i;--t;n+=e);l+=n}else t<i&&(l=l.slice(0,t)+"."+l.slice(t));return l}var rt=Ee();class Le{constructor(t){T(this,"key");T(this,"left",null);T(this,"right",null);this.key=t}}class Et extends Le{constructor(t){super(t)}}class Pe{constructor(){T(this,"size",0);T(this,"modificationCount",0);T(this,"splayCount",0)}splay(t){const e=this.root;if(e==null)return this.compare(t,t),-1;let i=null,n=null,r=null,c=null,h=e;const d=this.compare;let E;for(;;)if(E=d(h.key,t),E>0){let S=h.left;if(S==null||(E=d(S.key,t),E>0&&(h.left=S.right,S.right=h,h=S,S=h.left,S==null)))break;i==null?n=h:i.left=h,i=h,h=S}else if(E<0){let S=h.right;if(S==null||(E=d(S.key,t),E<0&&(h.right=S.left,S.left=h,h=S,S=h.right,S==null)))break;r==null?c=h:r.right=h,r=h,h=S}else break;return r!=null&&(r.right=h.left,h.left=c),i!=null&&(i.left=h.right,h.right=n),this.root!==h&&(this.root=h,this.splayCount++),E}splayMin(t){let e=t,i=e.left;for(;i!=null;){const n=i;e.left=n.right,n.right=e,e=n,i=e.left}return e}splayMax(t){let e=t,i=e.right;for(;i!=null;){const n=i;e.right=n.left,n.left=e,e=n,i=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let i=this.root;const n=i,r=i.left;if(this.size--,r==null)this.root=i.right;else{const c=i.right;i=this.splayMax(r),i.right=c,this.root=i}return this.modificationCount++,n}addNewRoot(t,e){this.size++,this.modificationCount++;const i=this.root;if(i==null){this.root=t;return}e<0?(t.left=i,t.right=i.right,i.right=null):(t.right=i,t.left=i.left,i.left=null),this.root=t}_first(){const t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){const t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}}var ni;const dt=class dt extends Pe{constructor(e,i){super();T(this,"root",null);T(this,"compare");T(this,"validKey");T(this,ni,"[object Set]");this.compare=e??this.defaultCompare(),this.validKey=i??(n=>n!=null&&n!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const i of e)this.delete(i)}forEach(e){const i=this[Symbol.iterator]();let n;for(;n=i.next(),!n.done;)e(n.value,n.value,this)}add(e){const i=this.splay(e);return i!=0&&this.addNewRoot(new Et(e),i),this}addAndReturn(e){const i=this.splay(e);return i!=0&&this.addNewRoot(new Et(e),i),this.root.key}addAll(e){for(const i of e)this.add(i)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let n=this.root.left;if(n==null)return null;let r=n.right;for(;r!=null;)n=r,r=n.right;return n.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let n=this.root.right;if(n==null)return null;let r=n.left;for(;r!=null;)n=r,r=n.left;return n.key}retainAll(e){const i=new dt(this.compare,this.validKey),n=this.modificationCount;for(const r of e){if(n!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(r)&&this.splay(r)==0&&i.add(this.root.key)}i.size!=this.size&&(this.root=i.root,this.size=i.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const i=new dt(this.compare,this.validKey);for(const n of this)e.has(n)&&i.add(n);return i}difference(e){const i=new dt(this.compare,this.validKey);for(const n of this)e.has(n)||i.add(n);return i}union(e){const i=this.clone();return i.addAll(e),i}clone(){const e=new dt(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function i(r,c){let h,d;do{if(h=r.left,d=r.right,h!=null){const E=new Et(h.key);c.left=E,i(h,E)}if(d!=null){const E=new Et(d.key);c.right=E,r=d,c=E}}while(d!=null)}const n=new Et(e.key);return i(e,n),n}toSet(){return this.clone()}entries(){return new Ce(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new ke(this.wrap())}};ni=Symbol.toStringTag;let yt=dt;class Se{constructor(t){T(this,"tree");T(this,"path",new Array);T(this,"modificationCount",null);T(this,"splayCount");this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let i=this.tree.getRoot();for(;i!=null;)this.path.push(i),i=i.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}}class ke extends Se{getValue(t){return t.key}}class Ce extends Se{getValue(t){return[t.key,t.key]}}const Be=l=>l,Ge=l=>{if(l){const t=new yt(Kt(l)),e=new yt(Kt(l)),i=(r,c)=>c.addAndReturn(r),n=r=>({x:i(r.x,t),y:i(r.y,e)});return n({x:new rt(0),y:new rt(0)}),n}return Be},Vt=l=>({set:t=>{ut=Vt(t)},reset:()=>Vt(l),compare:Kt(l),snap:Ge(l),orient:Re(l)});let ut=Vt();const St=(l,t)=>l.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(l.ur.x)&&l.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(l.ur.y),Ht=(l,t)=>{if(t.ur.x.isLessThan(l.ll.x)||l.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(l.ll.y)||l.ur.y.isLessThan(t.ll.y))return null;const e=l.ll.x.isLessThan(t.ll.x)?t.ll.x:l.ll.x,i=l.ur.x.isLessThan(t.ur.x)?l.ur.x:t.ur.x,n=l.ll.y.isLessThan(t.ll.y)?t.ll.y:l.ll.y,r=l.ur.y.isLessThan(t.ur.y)?l.ur.y:t.ur.y;return{ll:{x:e,y:n},ur:{x:i,y:r}}},Mt=(l,t)=>l.x.times(t.y).minus(l.y.times(t.x)),ve=(l,t)=>l.x.times(t.x).plus(l.y.times(t.y)),Pt=l=>ve(l,l).sqrt(),qe=(l,t,e)=>{const i={x:t.x.minus(l.x),y:t.y.minus(l.y)},n={x:e.x.minus(l.x),y:e.y.minus(l.y)};return Mt(n,i).div(Pt(n)).div(Pt(i))},ze=(l,t,e)=>{const i={x:t.x.minus(l.x),y:t.y.minus(l.y)},n={x:e.x.minus(l.x),y:e.y.minus(l.y)};return ve(n,i).div(Pt(n)).div(Pt(i))},oe=(l,t,e)=>t.y.isZero()?null:{x:l.x.plus(t.x.div(t.y).times(e.minus(l.y))),y:e},le=(l,t,e)=>t.x.isZero()?null:{x:e,y:l.y.plus(t.y.div(t.x).times(e.minus(l.x)))},De=(l,t,e,i)=>{if(t.x.isZero())return le(e,i,l.x);if(i.x.isZero())return le(l,t,e.x);if(t.y.isZero())return oe(e,i,l.y);if(i.y.isZero())return oe(l,t,e.y);const n=Mt(t,i);if(n.isZero())return null;const r={x:e.x.minus(l.x),y:e.y.minus(l.y)},c=Mt(r,t).div(n),h=Mt(r,i).div(n),d=l.x.plus(h.times(t.x)),E=e.x.plus(c.times(i.x)),S=l.y.plus(h.times(t.y)),b=e.y.plus(c.times(i.y)),A=d.plus(E).div(2),N=S.plus(b).div(2);return{x:A,y:N}};class Q{constructor(t,e){T(this,"point");T(this,"isLeft");T(this,"segment");T(this,"otherSE");T(this,"consumedBy");t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}static compare(t,e){const i=Q.comparePoints(t.point,e.point);return i!==0?i:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:ft.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x.isLessThan(e.x)?-1:t.x.isGreaterThan(e.x)?1:t.y.isLessThan(e.y)?-1:t.y.isGreaterThan(e.y)?1:0}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let i=0,n=e.length;i<n;i++){const r=e[i];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const i=this.point.events[e];if(i.segment.consumedBy===void 0)for(let n=e+1;n<t;n++){const r=this.point.events[n];r.consumedBy===void 0&&i.otherSE.point.events===r.otherSE.point.events&&i.segment.consume(r.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,i=this.point.events.length;e<i;e++){const n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){const e=new Map,i=n=>{const r=n.otherSE;e.set(n,{sine:qe(this.point,t.point,r.point),cosine:ze(this.point,t.point,r.point)})};return(n,r)=>{e.has(n)||i(n),e.has(r)||i(r);const{sine:c,cosine:h}=e.get(n),{sine:d,cosine:E}=e.get(r);return c.isGreaterThanOrEqualTo(0)&&d.isGreaterThanOrEqualTo(0)?h.isLessThan(E)?1:h.isGreaterThan(E)?-1:0:c.isLessThan(0)&&d.isLessThan(0)?h.isLessThan(E)?-1:h.isGreaterThan(E)?1:0:d.isLessThan(c)?-1:d.isGreaterThan(c)?1:0}}}let Fe=0;class ft{constructor(t,e,i,n){T(this,"id");T(this,"leftSE");T(this,"rightSE");T(this,"rings");T(this,"windings");T(this,"ringOut");T(this,"consumedBy");T(this,"prev");T(this,"_prevInResult");T(this,"_beforeState");T(this,"_afterState");T(this,"_isInResult");this.id=++Fe,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=i,this.windings=n}static compare(t,e){const i=t.leftSE.point.x,n=e.leftSE.point.x,r=t.rightSE.point.x,c=e.rightSE.point.x;if(c.isLessThan(i))return 1;if(r.isLessThan(n))return-1;const h=t.leftSE.point.y,d=e.leftSE.point.y,E=t.rightSE.point.y,S=e.rightSE.point.y;if(i.isLessThan(n)){if(d.isLessThan(h)&&d.isLessThan(E))return 1;if(d.isGreaterThan(h)&&d.isGreaterThan(E))return-1;const b=t.comparePoint(e.leftSE.point);if(b<0)return 1;if(b>0)return-1;const A=e.comparePoint(t.rightSE.point);return A!==0?A:-1}if(i.isGreaterThan(n)){if(h.isLessThan(d)&&h.isLessThan(S))return-1;if(h.isGreaterThan(d)&&h.isGreaterThan(S))return 1;const b=e.comparePoint(t.leftSE.point);if(b!==0)return b;const A=t.comparePoint(e.rightSE.point);return A<0?1:A>0?-1:1}if(h.isLessThan(d))return-1;if(h.isGreaterThan(d))return 1;if(r.isLessThan(c)){const b=e.comparePoint(t.rightSE.point);if(b!==0)return b}if(r.isGreaterThan(c)){const b=t.comparePoint(e.rightSE.point);if(b<0)return 1;if(b>0)return-1}if(!r.eq(c)){const b=E.minus(h),A=r.minus(i),N=S.minus(d),P=c.minus(n);if(b.isGreaterThan(A)&&N.isLessThan(P))return 1;if(b.isLessThan(A)&&N.isGreaterThan(P))return-1}return r.isGreaterThan(c)?1:r.isLessThan(c)||E.isLessThan(S)?-1:E.isGreaterThan(S)?1:t.id<e.id?-1:t.id>e.id?1:0}static fromRing(t,e,i){let n,r,c;const h=Q.comparePoints(t,e);if(h<0)n=t,r=e,c=1;else if(h>0)n=e,r=t,c=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const d=new Q(n,!0),E=new Q(r,!1);return new ft(d,E,[i],[c])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(e)?t:e},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(e)?t:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return ut.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){const e=this.bbox(),i=t.bbox(),n=Ht(e,i);if(n===null)return null;const r=this.leftSE.point,c=this.rightSE.point,h=t.leftSE.point,d=t.rightSE.point,E=St(e,h)&&this.comparePoint(h)===0,S=St(i,r)&&t.comparePoint(r)===0,b=St(e,d)&&this.comparePoint(d)===0,A=St(i,c)&&t.comparePoint(c)===0;if(S&&E)return A&&!b?c:!A&&b?d:null;if(S)return b&&r.x.eq(d.x)&&r.y.eq(d.y)?null:r;if(E)return A&&c.x.eq(h.x)&&c.y.eq(h.y)?null:h;if(A&&b)return null;if(A)return c;if(b)return d;const N=De(r,this.vector(),h,t.vector());return N===null||!St(n,N)?null:ut.snap(N)}split(t){const e=[],i=t.events!==void 0,n=new Q(t,!0),r=new Q(t,!1),c=this.rightSE;this.replaceRightSE(r),e.push(r),e.push(n);const h=new ft(n,c,this.rings.slice(),this.windings.slice());return Q.comparePoints(h.leftSE.point,h.rightSE.point)>0&&h.swapEvents(),Q.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),r.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,i=this.windings.length;e<i;e++)this.windings[e]*=-1}consume(t){let e=this,i=t;for(;e.consumedBy;)e=e.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const n=ft.compare(e,i);if(n!==0){if(n>0){const r=e;e=i,i=r}if(e.prev===i){const r=e;e=i,i=r}for(let r=0,c=i.rings.length;r<c;r++){const h=i.rings[r],d=i.windings[r],E=e.rings.indexOf(h);E===-1?(e.rings.push(h),e.windings.push(d)):e.windings[E]+=d}i.rings=null,i.windings=null,i.consumedBy=e,i.leftSE.consumedBy=e.leftSE,i.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let h=0,d=this.rings.length;h<d;h++){const E=this.rings[h],S=this.windings[h],b=e.indexOf(E);b===-1?(e.push(E),i.push(S)):i[b]+=S}const r=[],c=[];for(let h=0,d=e.length;h<d;h++){if(i[h]===0)continue;const E=e[h],S=E.poly;if(c.indexOf(S)===-1)if(E.isExterior)r.push(S);else{c.indexOf(S)===-1&&c.push(S);const b=r.indexOf(E.poly);b!==-1&&r.splice(b,1)}}for(let h=0,d=r.length;h<d;h++){const E=r[h].multiPoly;n.indexOf(E)===-1&&n.push(E)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Ct.type){case"union":{const i=t.length===0,n=e.length===0;this._isInResult=i!==n;break}case"intersection":{let i,n;t.length<e.length?(i=t.length,n=e.length):(i=e.length,n=t.length),this._isInResult=n===Ct.numMultiPolys&&i<n;break}case"xor":{const i=Math.abs(t.length-e.length);this._isInResult=i%2===1;break}case"difference":{const i=n=>n.length===1&&n[0].isSubject;this._isInResult=i(t)!==i(e);break}}return this._isInResult}}class ue{constructor(t,e,i){T(this,"poly");T(this,"isExterior");T(this,"segments");T(this,"bbox");if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=ut.snap({x:new rt(t[0][0]),y:new rt(t[0][1])});this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let r=n;for(let c=1,h=t.length;c<h;c++){if(typeof t[c][0]!="number"||typeof t[c][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const d=ut.snap({x:new rt(t[c][0]),y:new rt(t[c][1])});d.x.eq(r.x)&&d.y.eq(r.y)||(this.segments.push(ft.fromRing(r,d,this)),d.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=d.x),d.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=d.y),d.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=d.x),d.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=d.y),r=d)}(!n.x.eq(r.x)||!n.y.eq(r.y))&&this.segments.push(ft.fromRing(r,n,this))}getSweepEvents(){const t=[];for(let e=0,i=this.segments.length;e<i;e++){const n=this.segments[e];t.push(n.leftSE),t.push(n.rightSE)}return t}}class $e{constructor(t,e){T(this,"multiPoly");T(this,"exteriorRing");T(this,"interiorRings");T(this,"bbox");if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ue(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,n=t.length;i<n;i++){const r=new ue(t[i],this,!1);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,i=this.interiorRings.length;e<i;e++){const n=this.interiorRings[e].getSweepEvents();for(let r=0,c=n.length;r<c;r++)t.push(n[r])}return t}}class he{constructor(t,e){T(this,"isSubject");T(this,"polys");T(this,"bbox");if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new rt(Number.POSITIVE_INFINITY),y:new rt(Number.POSITIVE_INFINITY)},ur:{x:new rt(Number.NEGATIVE_INFINITY),y:new rt(Number.NEGATIVE_INFINITY)}};for(let i=0,n=t.length;i<n;i++){const r=new $e(t[i],this);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const n=this.polys[e].getSweepEvents();for(let r=0,c=n.length;r<c;r++)t.push(n[r])}return t}}class kt{constructor(t){T(this,"events");T(this,"poly");T(this,"_isExteriorRing");T(this,"_enclosingRing");this.events=t;for(let e=0,i=t.length;e<i;e++)t[e].segment.ringOut=this;this.poly=null}static factory(t){const e=[];for(let i=0,n=t.length;i<n;i++){const r=t[i];if(!r.isInResult()||r.ringOut)continue;let c=null,h=r.leftSE,d=r.rightSE;const E=[h],S=h.point,b=[];for(;c=h,h=d,E.push(h),h.point!==S;)for(;;){const A=h.getAvailableLinkedEvents();if(A.length===0){const U=E[0].point,C=E[E.length-1].point;throw new Error(`Unable to complete output ring starting at [${U.x}, ${U.y}]. Last matching segment found ends at [${C.x}, ${C.y}].`)}if(A.length===1){d=A[0].otherSE;break}let N=null;for(let U=0,C=b.length;U<C;U++)if(b[U].point===h.point){N=U;break}if(N!==null){const U=b.splice(N)[0],C=E.splice(U.index);C.unshift(C[0].otherSE),e.push(new kt(C.reverse()));continue}b.push({index:E.length,point:h.point});const P=h.getLeftmostComparator(c);d=A.sort(P)[0].otherSE;break}e.push(new kt(E))}return e}getGeom(){let t=this.events[0].point;const e=[t];for(let E=1,S=this.events.length-1;E<S;E++){const b=this.events[E].point,A=this.events[E+1].point;ut.orient(b,t,A)!==0&&(e.push(b),t=b)}if(e.length===1)return null;const i=e[0],n=e[1];ut.orient(i,t,n)===0&&e.shift(),e.push(e[0]);const r=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:e.length-1,h=this.isExteriorRing()?e.length:-1,d=[];for(let E=c;E!=h;E+=r)d.push([e[E].x.toNumber(),e[E].y.toNumber()]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var n,r;let t=this.events[0];for(let c=1,h=this.events.length;c<h;c++){const d=this.events[c];Q.compare(t,d)>0&&(t=d)}let e=t.segment.prevInResult(),i=e?e.prevInResult():null;for(;;){if(!e)return null;if(!i)return e.ringOut;if(i.ringOut!==e.ringOut)return((n=i.ringOut)==null?void 0:n.enclosingRing())!==e.ringOut?e.ringOut:(r=e.ringOut)==null?void 0:r.enclosingRing();e=i.prevInResult(),i=e?e.prevInResult():null}}}class fe{constructor(t){T(this,"exteriorRing");T(this,"interiorRings");this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=this.exteriorRing.getGeom();if(t===null)return null;const e=[t];for(let i=0,n=this.interiorRings.length;i<n;i++){const r=this.interiorRings[i].getGeom();r!==null&&e.push(r)}return e}}class Ue{constructor(t){T(this,"rings");T(this,"polys");this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const n=this.polys[e].getGeom();n!==null&&t.push(n)}return t}_composePolys(t){var i;const e=[];for(let n=0,r=t.length;n<r;n++){const c=t[n];if(!c.poly)if(c.isExteriorRing())e.push(new fe(c));else{const h=c.enclosingRing();h!=null&&h.poly||e.push(new fe(h)),(i=h==null?void 0:h.poly)==null||i.addInterior(c)}}return e}}class Xe{constructor(t,e=ft.compare){T(this,"queue");T(this,"tree");T(this,"segments");this.queue=t,this.tree=new yt(e),this.segments=[]}process(t){const e=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),i;t.isLeft&&this.tree.add(e);let n=e,r=e;do n=this.tree.lastBefore(n);while(n!=null&&n.consumedBy!=null);do r=this.tree.firstAfter(r);while(r!=null&&r.consumedBy!=null);if(t.isLeft){let c=null;if(n){const d=n.getIntersection(e);if(d!==null&&(e.isAnEndpoint(d)||(c=d),!n.isAnEndpoint(d))){const E=this._splitSafely(n,d);for(let S=0,b=E.length;S<b;S++)i.push(E[S])}}let h=null;if(r){const d=r.getIntersection(e);if(d!==null&&(e.isAnEndpoint(d)||(h=d),!r.isAnEndpoint(d))){const E=this._splitSafely(r,d);for(let S=0,b=E.length;S<b;S++)i.push(E[S])}}if(c!==null||h!==null){let d=null;c===null?d=h:h===null?d=c:d=Q.comparePoints(c,h)<=0?c:h,this.queue.delete(e.rightSE),i.push(e.rightSE);const E=e.split(d);for(let S=0,b=E.length;S<b;S++)i.push(E[S])}i.length>0?(this.tree.delete(e),i.push(t)):(this.segments.push(e),e.prev=n)}else{if(n&&r){const c=n.getIntersection(r);if(c!==null){if(!n.isAnEndpoint(c)){const h=this._splitSafely(n,c);for(let d=0,E=h.length;d<E;d++)i.push(h[d])}if(!r.isAnEndpoint(c)){const h=this._splitSafely(r,c);for(let d=0,E=h.length;d<E;d++)i.push(h[d])}}}this.tree.delete(e)}return i}_splitSafely(t,e){this.tree.delete(t);const i=t.rightSE;this.queue.delete(i);const n=t.split(e);return n.push(i),t.consumedBy===void 0&&this.tree.add(t),n}}class Ye{constructor(){T(this,"type");T(this,"numMultiPolys")}run(t,e,i){vt.type=t;const n=[new he(e,!0)];for(let S=0,b=i.length;S<b;S++)n.push(new he(i[S],!1));if(vt.numMultiPolys=n.length,vt.type==="difference"){const S=n[0];let b=1;for(;b<n.length;)Ht(n[b].bbox,S.bbox)!==null?b++:n.splice(b,1)}if(vt.type==="intersection")for(let S=0,b=n.length;S<b;S++){const A=n[S];for(let N=S+1,P=n.length;N<P;N++)if(Ht(A.bbox,n[N].bbox)===null)return[]}const r=new yt(Q.compare);for(let S=0,b=n.length;S<b;S++){const A=n[S].getSweepEvents();for(let N=0,P=A.length;N<P;N++)r.add(A[N])}const c=new Xe(r);let h=null;for(r.size!=0&&(h=r.first(),r.delete(h));h;){const S=c.process(h);for(let b=0,A=S.length;b<A;b++){const N=S[b];N.consumedBy===void 0&&r.add(N)}r.size!=0?(h=r.first(),r.delete(h)):h=null}ut.reset();const d=kt.factory(c.segments);return new Ue(d).getGeom()}}const vt=new Ye,Ct=vt,_e=(l,...t)=>Ct.run("union",l,t),Ke=(l,...t)=>Ct.run("difference",l,t),Ve=ut.set,ce=({x:l,y:t},e=Math.hypot(l,t))=>({x:l/e,y:t/e}),Qt=(l,t)=>({x:l.x+t.x,y:l.y+t.y}),Lt=(l,t)=>({x:l.x-t.x,y:l.y-t.y}),te=(l,t)=>({x:l.x*t,y:l.y*t}),Xt=({x:l,y:t})=>({x:t,y:-l}),ae=({x:l,y:t})=>({x:-l,y:-t}),Yt=({x:l,y:t},e,i)=>{const n=Math.sin(i),r=Math.cos(i),c=l-e.x,h=t-e.y,d=c*r-h*n,E=c*n+h*r;return{x:d+e.x,y:E+e.y}},pe=(l,t)=>l.x*t.x+l.y*t.y,He=(l,t,e)=>Qt(l,te(Lt(t,l),e)),ge=(l,t,e)=>Qt(l,te(t,e)),be=(l,t,e)=>l<t?t:l>e?e:l;class Je{constructor(){this._observers=new Map}on(t,e){let i=this._observers.get(t);return i===void 0&&this._observers.set(t,i=new Set),i.add(e),this.off.bind(this,t,e)}off(t,e){let i=this._observers.get(t);i!==void 0&&(i.delete(e),i.size==0&&this._observers.delete(t))}emit(t,...e){let i=this._observers.get(t);i&&i.forEach(n=>this._invoke(n,e))}_invoke(t,e){try{t(...e)}catch(i){console.error(i)}}dispose(){this._observers.clear()}}class ee extends Je{constructor(t=!1,e=!0,i=!0){super(),this.paused=t,this.gesture=e,this.pressure=i,this._map=new Map,this._onpointerdown=r=>{if(this.paused)return;let c=r.pointerId;this._map.has(c)&&this.emit("cancel",c),this._map.set(c,r),r.preventDefault(),r.stopPropagation(),this._dom.setPointerCapture(c);let h=this._rect=this._dom.getBoundingClientRect();if(this._mapGesture(r)&&this._map.size>1){let d=this._pinch=new je(this);this._map.forEach((E,S)=>{d.has(S)||(c!=S&&this.emit("cancel",S),d.add(E))})}else this.emit("open",c,{x:r.clientX-h.left,y:r.clientY-h.top,r:this._mapPressure(r.pressure)})},this._onpointermove=r=>{if(this.paused)return;let c=r.pointerId;if(r.preventDefault(),r.stopPropagation(),this._map.has(c)){let h=this._map.get(c);if(h.clientX==r.clientX&&h.clientY==r.clientY)return;if(this._map.set(c,r),this._pinch)this._pinch.move(r);else{let d;r.pointerType=="mouse"&&r.pressure==0&&(d=this._mapPressure(.5));let{left:E,top:S}=this._rect;if(r.getCoalescedEvents)for(let b of r.getCoalescedEvents())this.emit("update",c,{x:b.clientX-E,y:b.clientY-S,r:d??this._mapPressure(r.pressure)});else this.emit("update",c,{x:r.clientX-E,y:r.clientY-S,r:d??this._mapPressure(r.pressure)})}}},this._onpointerup=r=>{var h;if(this.paused)return;let c=r.pointerId;if(r.preventDefault(),r.stopPropagation(),this._map.has(c)){if(this._pinch)this._pinch.delete(c),this._pinch.empty&&(this._pinch=null);else{let{left:d,top:E}=this._rect;if(r.getPredictedEvents){let S=(h=this._map.get(c))==null?void 0:h.getPredictedEvents()[0];S&&this.emit("update",c,{x:S.clientX-d,y:S.clientY-E,r:this._mapPressure(S.pressure)})}this.emit("close",c)}this._map.delete(c)}},this._onpointercancel=r=>{if(this.paused)return;let c=r.pointerId;r.preventDefault(),r.stopPropagation(),this._map.delete(c),this._pinch?(this._pinch.delete(c),this._pinch.empty&&(this._pinch=null)):this.emit("cancel",c)},this._onwheel=r=>{if(this.paused)return;r.preventDefault(),r.stopPropagation();let{deltaX:c,deltaY:h}=r,d=Math.hypot(c,h),E=0,S=0;this._browser.windows&&(d=-d),c+h<0&&(d=-d),this._browser.mac&&r.ctrlKey?d=-d*.5:this._browser.mac&&(r.wheelDelta%120!=0||r.movementX!=0||r.deltaX!=0)||this._browser.windows&&!r.ctrlKey?(E=-c,S=-h,d=0):d*=.035,d=Math.max(d,-40)*.02;let{left:b,top:A}=this._rect;this.emit("wheel",{x:r.clientX-b,y:r.clientY-A,deltaX:E,deltaY:S,deltaScale:d})};const n=typeof navigator<"u"?navigator:{platform:""};this._browser={mac:/Mac/.test(n.platform),windows:/Win/.test(n.platform)}}get dom(){return this._dom}set dom(t){this._dom!=t&&(this._dom=t,this._listen(this._dom,{pointerdown:this._onpointerdown,pointermove:this._onpointermove,pointerup:this._onpointerup,pointerout:this._onpointerup,pointercancel:this._onpointercancel,wheel:this._onwheel}),this._dom&&(this._rect=this._dom.getBoundingClientRect()))}pause(){this.paused=!0}resume(){this.paused=!1}_listen(t,e){if(this._unlistenDOM&&(this._unlistenDOM(),this._unlistenDOM=void 0),t){for(let i in e)t.addEventListener(i,e[i]);this._unlistenDOM=()=>{for(let i in e)t.removeEventListener(i,e[i])}}}_mapPressure(t){return this.pressure===!0?t:be(this.pressure||.5,0,1)}_mapGesture(t){return this.gesture===!0||this.gesture&&t.pointerType=="touch"}dispose(){this._unlistenDOM&&(this._unlistenDOM(),this._unlistenDOM=void 0),super.dispose()}static create(t={}){let e=new ee(t.paused,t.gesture,t.pressure);return e.dom=t.dom,e}}class je{constructor(t){this.input=t,this.points=new Map,this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.scale=1,this.ox=0,this.oy=0,this.rate=1,this.initialized=!1,this.size=0}get empty(){return this.points.size==0}has(t){return this.points.has(t)}add(t){this.points.set(t.pointerId,t),this.update()}move(t){this.points.set(t.pointerId,t),this.update()}delete(t){this.points.delete(t),this.update()}update(){let t=this.desc(),e=1;this.size==0&&this.points.size==1?e=0:this.size>0&&this.points.size==0&&(e=2),this.initialized?(this.size!==this.points.size&&(this.ox=this.x1-t.x,this.oy=this.y1-t.y,this.rate=this.scale/t.d,this.size=this.points.size),this.x1=t.x+this.ox,this.y1=t.y+this.oy,this.scale=t.d*this.rate):(this.ox=this.oy=0,this.rate=1/t.d,this.x1=this.x0=t.x,this.y1=this.y0=t.y,this.scale=1,this.size=this.points.size,this.initialized=!0),this.input.emit("pinch",{phase:e,x:this.x0,y:this.y0,deltaX:this.x0-this.x1/this.scale,deltaY:this.y0-this.y1/this.scale,deltaScale:this.scale})}desc(){let t=0,e=0,i=0;for(let n of this.points.values())t+=n.clientX,e+=n.clientY;this.points.size>0&&(t/=this.points.size,e/=this.points.size);for(let n of this.points.values())i+=Math.hypot(n.clientX-t,n.clientY-e);return{x:t,y:e,d:i||1}}}class gt{constructor(t,e,i,n,r){this.p=t,this.r=e,this.v=i,this.d=n,this.l=r}toJSON(){return[this.p.x,this.p.y,this.r]}dup(t=this.r){return new gt(this.p,t,this.v,this.d,this.l)}}class Bt{constructor(t,e=t.length>0?t[t.length-1].l:0){this.points=t,this.length=e,this.sections=[0],this.pending={__proto__:null},this.queue=[],this.updateSections()}get empty(){return this.points.length==0}get dot(){return this.points.length==1}insert(t,e){if(t==this.points.length)e.forEach(i=>this.push(i,!0)),t=this.points.length,(e=this.pending[t])?(delete this.pending[t],this.insert(t,e)):this.updateSections();else if(t>this.points.length)this.pending[t]&&console.warn(`Override pending points from ${t}`),this.pending[t]=e;else throw new RangeError(`Position ${t} conflicts with existing points`)}push(t,e=!1){let{points:i}=this;if(i.length>0){let n,r=i[i.length-1];n=t;let c=r.p,h=Math.hypot(n.x-c.x,n.y-c.y);if(this.updateLength(h),this.length-r.l<4){r.r=Math.max(r.r,n.r);return}i.push(new gt(n,n.r,ce(Lt(c,n)),h,this.length)),e||this.updateSections()}else i.push(new gt(t,t.r,{x:1,y:1},0,0))}outline(t,e){let i=this.sections.find(r=>t<r),n=this.points.slice(t>0?t-1:t,i);if(n.length>1){let r=[],c=[],h=n.length,d=e,E=n[0].r,S=!0;if(i==null&&h>=2){let N=n[h-2];if((N.r==.5||N.r==1)&&N.d>.4*e){n[h-1]=n[h-1].dup(.05),n[h-2]=N.dup(Math.max(.1,N.r-.3));let P=h>=3?n[h-3]:null;P&&(n[h-3]=P.dup(Math.max(.1,P.r-.1))),S=!1}}for(let N=0;N<h;N++){let{p:P,r:U,v:C,d:nt}=n[N];N==0&&(nt=0,C=n[1].v);let _=Math.min(1,nt/e),xt=Math.min(1,1-_),Ot=Math.min(1,E+(xt-E)*(_*.3)),pt=(N<h-1?n[N+1]:n[N]).v,K=N<h-1?pe(C,pt):1;d=be(e*.5*Ot,.75,e/2);let H=te(Xt(He(pt,C,K)),d),s=Lt(P,H);r.push(s);let o=Qt(P,H);c.push(o),E=U}let b=[],A=[];for(let N=1/13,P=N;P<=1;P+=N)b.push(Yt(c[0],n[0].p,3.1416926535897933*P));if(S){let N=n[h-1],P=Xt(ae(N.v)),U=ge(N.p,P,d);for(let C=1/13,nt=C;nt<1;nt+=C)A.push(Yt(U,N.p,3.1416926535897933*nt))}return r.concat(A,c.reverse(),b)}else if(n.length==1){let r=n[0],c=Xt(ae(r.v)),h=ge(r.p,c,e*.36*r.r),d=[];for(let E=1/13,S=0;S<=2;S+=E)d.push(Yt(h,r.p,3.1416926535897933*S));return d}else return[]}updateLength(t){this.length+=t}updateSections(){let{sections:t}=this;for(let e=t.length>1?t[t.length-1]+1:2,i=this.points.length;e<i;e++)this.points[e].d<1e3&&pe(this.points[e].v,this.points[e-1].v)<0&&(t.push(e),e+=1)}updateCurr(t,e){for(this.queue.push(t);this.queue.length>e;)this.queue.shift();let i=0,n=0;for(let r of this.queue)i+=r.x,n+=r.y;return e=this.queue.length,{x:i/e,y:n/e,r:t.r}}toJSON(){return this.points.map(t=>t.toJSON())}static fromJSON(t){if(!t||!Array.isArray(t))throw new RangeError("Invalid JSON representation for Stroke");return Bt.create(t.map(e=>({x:e[0],y:e[1],r:e[2]})))}static create(t=[]){let e=[],i=0;if(t.length>0){let n=t[0],r=0;e.push(new gt(n,n.r,{x:1,y:1},0,0));for(let c=1;c<t.length;c++){let h=t[c],d=Math.hypot(h.x-n.x,h.y-n.y);if(r+=d,r-i<4){e[e.length-1].r=h.r;continue}e.push(new gt(h,h.r,ce(Lt(n,h)),d,r)),n=h,i=r}i=r}return new Bt(e,i)}}Ve(1e-12);let Ze=document.getElementById("app"),ot=document.createElementNS("http://www.w3.org/2000/svg","svg"),D=document.createElementNS("http://www.w3.org/2000/svg","g"),Te=document.createElementNS("http://www.w3.org/2000/svg","defs"),G={size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),outline:document.getElementById("outline"),pressure:document.getElementById("pressure"),eraser:document.getElementById("eraser"),data:document.getElementById("data")},Rt=document.getElementById("log");function Oe(...l){Rt.append(l.map(Jt).join(" ")+`
`),Rt.childNodes.length>20&&Rt.removeChild(Rt.firstChild)}function Jt(l){if(typeof l=="object"){if(typeof l=="function")return"Fn()";if(Array.isArray(l)){let t="[",e=!1;for(let i of l)t+=" "+Jt(i)+",",e=!0;return t=e?t.slice(0,-1)+" ]":t+"]",t}else{let t="{",e=!1;for(let i in l)t+=" "+i+": "+Jt(l[i])+",",e=!0;return t=e?t.slice(0,-1)+" }":t+"}",t}}else return typeof l=="number"?l.toFixed(1):""+l}window.onerror=function(t){Oe(t)};let We=console.log;console.log=function(){return Oe.apply(this,arguments),We.apply(this,arguments)};let Gt=0,jt=0,Ie=0;function Qe(l){try{jt=JSON.stringify(l.toJSON()).length,Ie+=jt}catch(t){console.error(t)}}function Zt(){G.data.textContent=`${Gt.toFixed(1)}ms, ${de(jt)} (Total: ${de(Ie)})`}function de(l){return l<1024?l+" B":(l/1024).toFixed(1)+" kB"}let mt={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(l,t){for(this.stack[this.index]={undo:l,redo:t},this.index+=1;this.stack.length>20;)this.stack.shift(),this.index-=1;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index-=1,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index+=1,this.update())},update(){G.undo.disabled=!this.undoable,G.redo.disabled=!this.redoable}};function Tt(){return G.eraser.checked}let _t=document.createElementNS("http://www.w3.org/2000/svg","mask");G.eraser.oninput=()=>{Tt()?(Te.append(_t),G.pressure.disabled=!0):(_t.remove(),G.pressure.disabled=!1)};_t.setAttribute("id","eraser");let qt=document.createElementNS("http://www.w3.org/2000/svg","rect");qt.setAttribute("width","100%");qt.setAttribute("height","100%");qt.setAttribute("fill","white");_t.append(qt);D.setAttribute("mask","url(#eraser)");ot.append(Te);ot.append(D);Ze.append(ot);G.clear.onclick=()=>{let l=Array.from(D.children);D.textContent="",mt.commit(()=>D.append(...l),()=>D.textContent="")};G.undo.onclick=()=>mt.undo();G.redo.onclick=()=>mt.redo();D.setAttribute("fill","currentColor");G.outline.oninput=()=>{G.outline.checked?(D.setAttribute("fill","none"),D.setAttribute("stroke","currentColor"),D.setAttribute("stroke-width","1")):D.setAttribute("fill","currentColor")};ot.setAttribute("fill-rule","nonzero");ot.style.cssText=`display: block; width: 100%; height: 100%;
font-size: 0; touch-action: none; position: relative; contain: content;
overflow: hidden; overscroll-behavior: none;`;let et={__proto__:null},bt={__proto__:null},at=ee.create({dom:ot,gesture:!1}),tt;G.pressure.oninput=()=>{at.pressure=G.pressure.checked};at.on("open",(l,t)=>{let e=Bt.create([t]),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.style.pointerEvents="none",Tt()?(i.setAttribute("fill","black"),_t.append(i),tt&&tt.$path.remove(),tt={stroke:e,$path:i}):(et[l]=[e,i],bt[l]=!0,D.append(i),ne())});at.on("update",(l,t)=>{if(Tt()&&tt){let e=G.size.valueAsNumber*2,{stroke:i,$path:n}=tt,r="",c=[];i.push(t);for(let h of i.sections){let d=i.outline(h,e);r+=se(d),c.push(d)}n[ie]=c,n.setAttribute("d",r)}else if(et[l]){let[e]=et[l];e.push(t),bt[l]=!0,ne()}});at.on("cancel",l=>{Tt()&&tt?tt.$path.remove():et[l]&&(et[l][1].remove(),delete et[l])});at.on("close",l=>{if(Tt()&&tt){let t=performance.now();try{ii(tt)}catch(e){console.error(e),alert("Failed to erase: "+e)}finally{tt.$path.remove()}tt=void 0,Gt=performance.now()-t,Zt()}if(et[l]){let[t,e]=et[l],i=!0;t.empty&&(e.remove(),i=!1),ne(),Qe(t),Zt(),console.info(t),delete et[l],i&&mt.commit(()=>e.remove(),()=>D.append(e))}});ot.ontouchstart=ot.ontouchmove=ot.ontouchend=ot.ontouchcancel=l=>{l.preventDefault(),l.stopPropagation()};document.onkeydown=l=>{let t=l.ctrlKey,e=l.shiftKey,i=l.metaKey,n=l.altKey,r=l.keyCode,c=at._browser.mac?i:t;const h=d=>{l.preventDefault(),d.focus(),d.click()};!t&&!e&&!i&&!n?(r==79&&h(G.outline),r==80&&(G.pressure.disabled?h(G.eraser):h(G.pressure)),r==69&&h(G.eraser)):c&&!e&&r==90?h(G.undo):c&&e&&r==90&&h(G.redo)};const ye=(l,t)=>({x:(l.x+t.x)/2,y:(l.y+t.y)/2}),ti=({x:l,y:t})=>`M${l.toFixed(2)},${t.toFixed(2)}`,me=({x:l,y:t})=>`L${l.toFixed(2)},${t.toFixed(2)}`,ei=(l,{x:t,y:e})=>`Q${l.x.toFixed(2)},${l.y.toFixed(2)} ${t.toFixed(2)},${e.toFixed(2)}`,ie="_outlines",Wt="_poly";function ne(){let l=G.size.valueAsNumber,t=performance.now(),e=!1;for(let i in bt){if(et[i]){let[n,r]=et[i],c="",h=[];for(let d of n.sections){let E=n.outline(d,l);c+=se(E),h.push(E)}r[ie]=h,r.setAttribute("d",c)}delete bt[i],e=!0}e&&(Gt=performance.now()-t)}function se(l){if(l.length==0)return"";let t=l.shift(),e=ti(t),i=1;for(let n of l)i&&(e+=me(ye(t,n))),e+=ei(t,ye(t,n)),i=0,t=n;return e+me(l[l.length-1])}function xe(l){if(l[Wt])return l[Wt];let t=l[ie]||[],e=[];for(let i of t)e=_e(e,[i.map(n=>[n.x,n.y])]);return e}function ii({$path:l}){let t=performance.now(),e=Array.from(D.children),i=[];i=_e(i,...e.map(xe));let n=xe(l),r=Ke(i,n),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.style.pointerEvents="none";let h="";for(let d of r)for(let E of d){let S=E.map(b=>({x:b[0],y:b[1]}));h+=se(S)}c[Wt]=r,c.setAttribute("d",h),D.textContent="",D.append(c),mt.commit(()=>{D.textContent="",D.append(...e)},()=>{D.textContent="",D.append(c)}),Gt=performance.now()-t,Zt()}Object.assign(window,{debug:{undoStack:mt,strokes:et,dirty:bt,input:at,eraser:()=>tt}});
//# sourceMappingURL=index-BCR1d9I7.js.map
