{"version":3,"file":"index-A8LWqNj9.js","sources":["../../src/base.ts","../../src/spring.ts","../../src/stroke.ts","../../main.ts"],"sourcesContent":["export const clamp = (value: number, min: number, max: number) => value < min ? min : value > max ? max : value;\n\nexport interface IPoint {\n  readonly x: number;\n  readonly y: number;\n}\n\nexport interface IRectangle extends IPoint {\n  readonly width: number;\n  readonly height: number;\n}\n\nexport class Vec {\n  /// @internal\n  constructor(\n    readonly x: number,\n    readonly y: number,\n  ) { }\n\n  static of(x: number, y: number) {\n    return new Vec(x, y);\n  }\n\n  static from(vec: IPoint) {\n    return new Vec(vec.x, vec.y);\n  }\n\n  add(other: IPoint) {\n    return new Vec(this.x + other.x, this.y + other.y);\n  }\n\n  subtract(other: IPoint) {\n    return new Vec(this.x - other.x, this.y - other.y);\n  }\n\n  multiply(scalar: number) {\n    return new Vec(this.x * scalar, this.y * scalar);\n  }\n\n  normalize(d = Math.hypot(this.x, this.y)) {\n    return new Vec(this.x / d, this.y / d);\n  }\n\n  /// Rotate the vector by 90 degrees. → becomes ↑\n  permutate() {\n    return new Vec(-this.y, this.x);\n  }\n\n  negative() {\n    return new Vec(-this.x, -this.y);\n  }\n\n  middle(other: IPoint) {\n    return new Vec((this.x + other.x) / 2, (this.y + other.y) / 2);\n  }\n\n  /// Rotate the vector around a center point.\n  rotate(center: IPoint, radius: number) {\n    const s = Math.sin(radius), c = Math.cos(radius),\n          px = this.x - center.x, py = this.y - center.y,\n          nx = px * c - py * s, ny = px * s + py * c;\n    return new Vec(nx + center.x, ny + center.y);\n  }\n\n  dot(other: IPoint) {\n    return this.x * other.x + this.y * other.y;\n  }\n\n  lerp(other: IPoint, t: number) {\n    return new Vec(this.x + (other.x - this.x) * t, this.y + (other.y - this.y) * t);\n  }\n\n  project(other: IPoint, c: number) {\n    return new Vec(this.x + other.x * c, this.y + other.y * c);\n  }\n}\n","const enum C {\n  initial = 0.36,\n  timespan = 0.016667,\n  stiffness = 2,\n  damping = 0.1,\n  precision = 0.01,\n}\n\nexport class Spring {\n  private value: number\n  private last: number\n  private target: number\n  constructor(value = C.initial) {\n    this.value = this.last = this.target = value\n  }\n  set(target: number): this {\n    this.target = target\n    return this\n  }\n  update(dt?: number): number {\n    if (!dt) dt = C.timespan\n    if (this.value >= 0 && this.target >= 0 && this.last >= 0) {\n      let v = this.target\n      let delta = v - this.value\n      let velocity = (this.value - this.last) / dt\n      let spring = C.stiffness * delta\n      let damper = C.damping * velocity\n      let acceleration = spring - damper\n      let d = (velocity + acceleration) * dt\n      this.last = this.value\n      if (Math.abs(d) < C.precision && Math.abs(delta) < C.precision) {\n        this.value = this.target\n      } else {\n        this.value += d\n      }\n    }\n    return this.value\n  }\n}\n","//\n// Strokes are made up of a series of points, each point may have a pressure and a timestamp.\n// The algorithm's goal is to calculate a smooth outline of these points with known information.\n// The basic idea is each stroke is affected by 2 factors:\n//\n// - \"Thinning\": The stroke will be thinner if the pressure is lower and\n//               distance per interval between points become longer.\n//               Without timestamp we can assume the interval is constant.\n//\n// - \"Spreading\": The last several points will spread (be bigger) even after you lift the pen.\n//\n\nimport { clamp, IPoint, Vec } from \"./base\";\nimport { Spring } from \"./spring\";\n\n/// The data structure for raw input point, should be easy to convert from pointer events.\nexport class RawPoint implements IPoint {\n  /// @internal\n  constructor(\n    readonly x: number,\n    readonly y: number,\n    /// Pressure, range from 0 to 1. Use 0.5 for no-pressure cases.\n    readonly p: number,\n    /// Timestamp in milliseconds. Use 0 for no-timestamp cases.\n    readonly t: number,\n  ) { }\n\n  /// Construct a RawPoint from x, y, pressure and timestamp.\n  static of(x: number, y: number, pressure: number, timestamp: number) {\n    return new RawPoint(x, y, pressure, timestamp);\n  }\n\n  /// Construct a RawPoint from a PointerEvent.\n  /// The position is from clientX and clientY, which may not be the best choice\n  /// for draw boards supporting pinch and zoom. Use {@link RawPoint.of} instead.\n  static fromEvent(event: PointerEvent, pressure = clamp(event.pressure || 0.5, 0, 1)) {\n    // Some stylus devices may report zero pressure, treat as no-pressure.\n    return new RawPoint(event.clientX, event.clientY, pressure, event.timeStamp);\n  }\n\n  /// @internal\n  static fromJSON(json: any) {\n    return new RawPoint(json.x, json.y, json.p, json.t);\n  }\n}\n\n/// The data structure for a point in a stroke, it has context information like\n/// its direction, distance to the previous point, and running length.\nexport class Point {\n  /// @internal\n  constructor(\n    readonly p: RawPoint,\n    /// Inverted direction of this point, equals to `previous - current`.\n    /// The first point's direction is the same as the second point.\n    readonly v: Vec,\n    /// Distance to the previous point, equals to `hypot(previous - current)`.\n    readonly d: number,\n    /// Running length from the first point to this point.\n    readonly l: number,\n  ) { }\n\n  static of(point: RawPoint, vector: Vec, distance: number, length: number) {\n    return new Point(point, vector, distance, length);\n  }\n\n  /// @internal\n  static fromJSON(json: any) {\n    return new Point(RawPoint.fromJSON(json.p), Vec.from(json.v), json.d, json.l);\n  }\n}\n\n// Constants which should not be exported as options.\nconst enum C {\n  // Skip points that are too close.\n  SkipDistance = 4,\n  // If the tail's length > `TailDistance * size`, draw a thinner tail,\n  // otherwise draw an end cap.\n  TailInterval = 100,\n  TailDistance = 0.51,\n  // Math.PI + 0.0001 to prevent floating number issue when drawing the cap.\n  PI = 3.1416926535897933,\n  // Simulate pressure for mouse and trackpad.\n  PressureChangeSpeed = 0.5,\n  // Approximate ratio that multiplies `size` to draw a dot.\n  DotSize = 0.36,\n  // Minimal stroke width / 2.\n  MinRadius = 0.75,\n  // Spreading interval in milliseconds.\n  SpreadInterval = 60,\n  // Spreading amount per interval.\n  SpreadAmount = 0.05,\n}\n\n/// @internal Increase each point's pressure in the next period with a small amount.\nfunction pressureTillNow(p: Point, now: number) {\n  if (now - p.p.t > C.SpreadInterval) return Math.min(p.p.p + C.SpreadAmount, 1);\n  return Math.min(p.p.p + C.SpreadAmount * (now - p.p.t) / C.SpreadInterval, 1);\n}\n\n/// @internal Increase pressure for the next period with a small amount.\nfunction pressureTillNow2(p: number, t: number, now: number) {\n  if (now - t > C.SpreadInterval) return Math.min(p + C.SpreadAmount, 1);\n  return Math.min(p + C.SpreadAmount * (now - t) / C.SpreadInterval, 1);\n}\n\n/// The data structure for a stroke.\nexport class Stroke {\n  /// Indexes to split {@link Stroke.points} into curves. The first index is always `0`.\n  readonly segments: number[] = [0]\n  /// @internal See {@link Stroke.insert}.\n  readonly pending: { [from: number]: RawPoint[] } = { __proto__: null } as any\n\n  /// @internal\n  constructor(\n    /// The stroke's points. It grows on {@link Stroke.insert} and {@link Stroke.push}.\n    readonly points: Point[],\n    /// The stroke's length, equals to `points.at(-1).l`.\n    /// {@link Stroke.insert} and {@link Stroke.push} will update this value.\n    readonly length = points.length > 0 ? points[points.length - 1].l : 0,\n  ) { }\n\n  /// Create a stroke from raw points.\n  static of(raw: RawPoint[] = []): Stroke {\n    let stroke = new Stroke([], 0)\n    for (let p of raw) stroke._push(p)\n    stroke._updateSegments()\n    return stroke\n  }\n\n  /// Revive a stroke from `JSON.parse(JSON.stringify(oldStroke))`.\n  static fromJSON(json: any) {\n    let stroke = new Stroke(json.points.map(Point.fromJSON), json.length);\n    (stroke as { segments: number[] }).segments = json.segments;\n    (stroke as { pending: { [from: number]: RawPoint[] } }).pending = json.pending;\n    return stroke;\n  }\n\n  /// True when no points in the stroke.\n  get empty() { return this.length == 0 }\n\n  /// True when the stroke has only one point.\n  get dot() { return this.points.length == 1 }\n\n  /// Update the stroke with new points inserted from `from`.\n  /// The `from` can exceed the stroke's length, where the points will be\n  // pending until there be new points fill the gap.\n  insert(from: number, raw: RawPoint[]): this {\n    if (from == this.points.length) {\n      for (let p of raw) this._push(p)\n      from = this.points.length\n      if (raw = this.pending[from]) {\n        delete this.pending[from]\n        this.insert(from, raw)\n      }\n      // Recursively call {@link Stroke.insert} to flush pending points.\n      // Ensure a {@link Stroke._updateSegments} is called at the end of the recursion.\n      else {\n        this._updateSegments()\n      }\n    }\n    else if (from > this.points.length) {\n      this.pending[from] = raw\n    }\n    else {\n      throw new RangeError(`Position ${from} conflicts with existing points`)\n    }\n    return this\n  }\n\n  /// Update the stroke by pushing new points to the end.\n  push(raw: RawPoint): this {\n    this._push(raw)\n    this._updateSegments()\n    return this\n  }\n\n  /// @internal This method does not call `_updateSegments`.\n  _push(raw: RawPoint) {\n    let points = this.points\n    if (points.length > 0) {\n      let prev = points[points.length - 1]\n      let d = Math.hypot(raw.x - prev.p.x, raw.y - prev.p.y)\n      this._updateLength(d)\n      if (this.length - prev.l < C.SkipDistance) {\n        // Skip this point, but preserve its pressure.\n        (prev.p as { p: number }).p = Math.max(prev.p.p, raw.p)\n        return\n      }\n      points.push(Point.of(raw, Vec.from(raw).subtract(prev.p).normalize(), d, this.length))\n    } else {\n      points.push(Point.of(raw, Vec.of(0, 0), 0, 0))\n    }\n  }\n\n  /// Is the stroke still \"spreading\"?\n  isSpreading(now = performance.now()): boolean {\n    return this.points.length > 0 && now - this.points[this.points.length - 1].p.t < C.SpreadInterval\n  }\n\n  /// Compute the outline points of the segment starting at `from`.\n  /// Returns an empty array if `from` is not in {@link Stroke.segments}.\n  /// The `size` is the full width when pressure is 1.\n  /// If the `tail` is true, it will simulate a thin tail when the last segment is long enough.\n  outline(from: number, size: number, now = performance.now(), tail = true): IPoint[] {\n    let end = this.segments.find(end => from < end)\n    let points = this.points.slice(from > 0 ? from - 1 : from, end)\n    if (points.length > 1) {\n      let leftPoints: Vec[] = [], rightPoints: Vec[] = [], length = points.length,\n          radius = size, prevPressure = points[0].p.p, lastPressure = points[length - 1].p.p,\n          drawEndCap = true, tailIndex = -1, prevTimestamp = points[0].p.t,\n          spring = new Spring(Math.max(prevPressure, C.DotSize / 5))\n      // Draw a tail if the last segment is long enough.\n      // The precisely comparing to 0.5 and 1.0 is probably a mouse event generated by chrome or firefox.\n      if (tail && end == null && length >= 2 && (prevPressure == 0.5 || prevPressure == 1 || lastPressure < C.DotSize)) {\n        // The last point is maybe a predicted point (no sense), so use the one before it.\n        let p2 = points[length - 2]\n        // Get the distance of tail in some time, if it is long enough then draw a tail.\n        let d = p2.d, p1 = p2, t = 0\n        for (let i = length - 3; i >= 0; i--) {\n          p1 = points[i]\n          d += p1.d\n          t = p2.p.t - p1.p.t\n          if (t <= 0 || t > C.TailInterval) break\n          tailIndex = i\n        }\n        if (d > C.TailDistance * size) {\n          drawEndCap = false\n          tailIndex += Math.ceil((length - tailIndex) / 3)\n        }\n      }\n      // Simulate pressure and push points.\n      for (let i = 0; i < length; i++) {\n        let { p, v, d } = points[i]\n        // Fix first point's distance and direction (assume the same as the next point).\n        if (i == 0) {\n          d = 0\n          v = points[1].v\n        }\n        let sp = Math.min(1, d / size), rp = Math.min(1, 1 - sp),\n            pressure = Math.min(1, prevPressure + (rp - prevPressure) * (sp * C.PressureChangeSpeed)),\n            nextVector = (i < length - 1 ? points[i + 1] : points[i]).v,\n            nextDot = i < length - 1 ? v.dot(nextVector) : 1\n\n        pressure = spring.set(pressure).update((p.t - prevTimestamp) / 800)\n        // Tail case.\n        if (!drawEndCap && i >= tailIndex) {\n          let t = 1 - (length - i - 1) / (length - tailIndex)\n          pressure = pressure * (1 - t * t)\n        }\n\n        radius = clamp(size * 0.5 * pressureTillNow2(pressure, p.t, now), C.MinRadius, size / 2)\n\n        let offset = nextVector.lerp(v, nextDot).permutate().multiply(radius),\n            pl = Vec.from(p).subtract(offset),\n            pr = Vec.from(p).add(offset)\n\n        leftPoints.push(pl)\n        rightPoints.push(pr)\n\n        prevTimestamp = p.t\n        prevPressure = p.p\n      }\n      let startCap: Vec[] = [], firstPoint = rightPoints[0], endCap: Vec[] = []\n      for (let step = 1 / 13, t = 0; t <= 1; t += step) {\n        startCap.push(firstPoint.rotate(points[0].p, C.PI * t))\n      }\n      if (drawEndCap) {\n        let lastPoint = points[length - 1],\n            direction = lastPoint.v.negative().permutate(),\n            start = Vec.from(lastPoint.p).project(direction, radius)\n        for (let step = 1 / 13, t = 0; t < 1; t += step) {\n          endCap.push(start.rotate(lastPoint.p, C.PI * t))\n        }\n      }\n      return leftPoints.concat(endCap, rightPoints.reverse(), startCap)\n    }\n    // Dot case.\n    else if (points.length == 1) {\n      let p = points[0],\n          start = Vec.from(p.p).project(Vec.of(1, 0), size * C.DotSize * pressureTillNow(p, now)),\n          circle: Vec[] = []\n      for (let step = 1 / 13, t = 0; t <= 2; t += step) {\n        circle.push(start.rotate(p.p, C.PI * t))\n      }\n      return circle\n    }\n    else {\n      return []\n    }\n  }\n\n  /// Construct an SVG path string from raw points with basic smoothing.\n  /// If `loop` is `true`, the path will be closed.\n  stroke(points: IPoint[] = this.points.map(p => p.p), loop = false): string {\n    let n = points.length\n    if (n == 0) return \"\"\n    let prev = points[0], path = '', curr: IPoint, middle: IPoint\n    if (loop) {\n      middle = Vec.from(prev).middle(points[n - 1])\n      path += `M${middle.x.toFixed(2)},${middle.y.toFixed(2)}`\n      for (let i = 1; i < n; i++) {\n        curr = points[i], middle = Vec.from(prev).middle(curr)\n        path += `Q${prev.x.toFixed(2)},${prev.y.toFixed(2)} ${middle.x.toFixed(2)},${middle.y.toFixed(2)}`\n        prev = curr\n      }\n      if (n > 1) path += 'Z'\n    } else {\n      path += `M${prev.x.toFixed(2)},${prev.y.toFixed(2)}`\n      for (let i = 1; i < n; i++) {\n        curr = points[i], middle = Vec.from(prev).middle(curr)\n        if (i == 1) path += `L${middle.x.toFixed(2)},${middle.y.toFixed(2)}`\n        else path += `Q${prev.x.toFixed(2)},${prev.y.toFixed(2)} ${middle.x.toFixed(2)},${middle.y.toFixed(2)}`\n        prev = curr\n      }\n      if (n > 1) path += `L${prev.x.toFixed(2)},${prev.y.toFixed(2)}`\n    }\n    return path\n  }\n\n  /// @internal Increase the running length.\n  _updateLength(d: number) {\n    (this as { length: number }).length += d\n  }\n\n  /// @internal Update {@link Stroke.segments} using current {@link Stroke.points}.\n  _updateSegments() {\n    let segments = this.segments, points = this.points, n = points.length\n    for (let i = segments[segments.length - 1] + 1; i < n; i++) {\n      if (points[i].v.dot(points[i - 1].v) < 0) {\n        segments.push(i)\n        i++\n      }\n    }\n  }\n}\n","import { clamp, RawPoint, Stroke } from './src/ink'\n\nlet $root = document.getElementById('app')!\nlet $svg = $root.appendChild(document.createElementNS('http://www.w3.org/2000/svg', 'svg'))\nlet $mask = $root.appendChild(document.createElement('div'))\nlet $settings = {\n  color: document.getElementById('stroke-color') as HTMLInputElement,\n  size: document.getElementById('stroke-size') as HTMLInputElement,\n  clear: document.getElementById('clear') as HTMLButtonElement,\n  undo: document.getElementById('undo') as HTMLButtonElement,\n  redo: document.getElementById('redo') as HTMLButtonElement,\n  pressure: document.getElementById('pressure') as HTMLInputElement,\n  tail: document.getElementById('tail') as HTMLInputElement,\n  eraser: document.getElementById('eraser') as HTMLInputElement,\n  smooth: document.getElementById('smooth') as HTMLSelectElement,\n}\n\nlet defaultPressure = $settings.pressure.checked\nlet defaultTail = $settings.tail.checked\nlet defaultSmooth = $settings.smooth.value\nlet defaultSize = $settings.size.valueAsNumber\n\n$svg.setAttribute('fill-rule', 'nonzero')\n$svg.setAttribute('fill', 'currentColor')\n$svg.style.cssText = `display: block; width: 100%; height: 100%;\nfont-size: 0; touch-action: none; position: relative; contain: content;\noverflow: hidden; overscroll-behavior: none;`\n\n$mask.style.cssText = `display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;\ntouch-action: none; contain: content; z-index: 1;`\n\nlet matchDark = matchMedia('(prefers-color-scheme: dark)')\nlet defaultColor = () => matchDark.matches ? '#ffffff' : '#000000'\n$settings.color.value = defaultColor()\n\n$settings.color.onchange = $settings.color.oninput = () => {\n  refreshUrl()\n}\n\n$settings.size.onchange = $settings.size.oninput = () => {\n  refreshUrl()\n}\n\n$settings.clear.onclick = () => {\n  let current = Array.from($svg.children)\n  $svg.textContent = ''\n  undoStack.commit(\n    () => $svg.append(...current),\n    () => $svg.textContent = '',\n  )\n}\n\n$settings.undo.onclick = () => undoStack.undo()\n$settings.redo.onclick = () => undoStack.redo()\n\nlet pressure: 0.5 | undefined\n\n$settings.pressure.oninput = () => {\n  pressure = $settings.pressure.checked ? void 0 : 0.5\n  refreshUrl()\n}\n\n$settings.tail.oninput = () => {\n  refreshUrl()\n}\n\n$settings.smooth.onchange = $settings.smooth.oninput = () => {\n  refreshUrl()\n}\n\n$settings.eraser.oninput = () => {\n  let erasing = $settings.eraser.checked\n  $mask.style.cursor = erasing ? `url(https://api.iconify.design/mdi:eraser.svg?color=${encodeURIComponent($settings.color.value)}) 12 32, auto` : 'default'\n  $mask.style.display = erasing ? 'block' : 'none'\n}\n\nfor (let i = 1; i <= 15; i++) {\n  let $option = document.createElement('option')\n  $option.value = $option.textContent = String(i)\n  $settings.smooth.appendChild($option)\n}\n\nlet refreshUrl = () => {\n  let replacement = ''\n  if ($settings.color.value !== defaultColor()) {\n    replacement += `&color=${$settings.color.value.slice(1)}`\n  }\n  if ($settings.size.valueAsNumber !== defaultSize) {\n    replacement += `&size=${$settings.size.valueAsNumber}`\n  }\n  if ($settings.pressure.checked !== defaultPressure) {\n    replacement += `&pressure=${$settings.pressure.checked ? 1 : 0}`\n  }\n  if ($settings.tail.checked !== defaultTail) {\n    replacement += `&tail=${$settings.tail.checked ? 1 : 0}`\n  }\n  if ($settings.smooth.value !== defaultSmooth) {\n    replacement += `&smooth=${$settings.smooth.value}`\n  }\n   history.replaceState({}, \"\", replacement ? replacement.replace('&', '?') : location.pathname)\n}\n\nlet search = new URL(location.href).searchParams\nif (search.has('color')) {\n  $settings.color.value = '#' + search.get('color')!\n}\nif (search.has('size')) {\n  $settings.size.value = search.get('size')!\n}\nif (search.has('pressure')) {\n  $settings.pressure.checked = search.get('pressure') !== '0'\n  $settings.pressure.dispatchEvent(new InputEvent('input'))\n}\nif (search.has('tail')) {\n  $settings.tail.checked = search.get('tail') !== '0'\n  $settings.tail.dispatchEvent(new InputEvent('input'))\n}\nif (search.has('smooth')) {\n  $settings.smooth.value = search.get('smooth')!\n}\nrefreshUrl()\n\nlet running = new Map<number, PointerEvent>()\n\n$svg.onpointerdown = (e) => {\n  let id = e.pointerId\n  if (running.has(id)) onCancel(id)\n  running.set(id, e)\n  e.preventDefault()\n  e.stopPropagation()\n  $svg.setPointerCapture(id)\n  // Ideally it should save $svg.getBoundingClientRect() for calculating the offset.\n  // In our demo case the offset is always 0.\n  onOpen(id, RawPoint.fromEvent(e, pressure))\n}\n\n$svg.onpointermove = (e) => {\n  let id = e.pointerId\n  e.preventDefault()\n  e.stopPropagation()\n  if (running.has(id)) {\n    let e0 = running.get(id)!\n    // Apple pencil's bug, it fires 2 identical events.\n    if (e0.clientX === e.clientX && e0.clientY === e.clientY) return\n    running.set(id, e)\n    if (!!e.getCoalescedEvents) for (let ev of e.getCoalescedEvents()) {\n      onUpdate(id, RawPoint.fromEvent(ev, pressure))\n    } else {\n      onUpdate(id, RawPoint.fromEvent(e, pressure))\n    }\n  }\n}\n\n$svg.onpointerup = $svg.onpointerout = (e) => {\n  let id = e.pointerId\n  e.preventDefault()\n  e.stopPropagation()\n  if (running.has(id)) {\n    if (!!e.getPredictedEvents) {\n      // Use last point's predict result instead of this pointerup event.\n      let ev = running.get(id)!.getPredictedEvents()[0]\n      if (ev) onUpdate(id, RawPoint.fromEvent(ev, pressure))\n    }\n    onClose(id)\n    running.delete(id)\n  }\n}\n\n$svg.onpointercancel = (e) => {\n  let id = e.pointerId\n  e.preventDefault()\n  e.stopPropagation()\n  if (running.has(id)) {\n    onCancel(id)\n    running.delete(id)\n  }\n}\n\n$svg.ontouchstart = $svg.ontouchmove = $svg.ontouchend = $svg.ontouchcancel = (e) => {\n  e.preventDefault()\n  e.stopPropagation()\n}\n\nlet eraserLastPoint: RawPoint | undefined\n\n$mask.onpointerdown = (e) => {\n  e.preventDefault()\n  e.stopPropagation()\n  $mask.setPointerCapture(e.pointerId)\n  onErase(eraserLastPoint = RawPoint.fromEvent(e))\n}\n\n$mask.onpointermove = (e) => {\n  if (eraserLastPoint) {\n    e.preventDefault()\n    e.stopPropagation()\n    let current = RawPoint.fromEvent(e)\n    onErase(current)\n    eraserLastPoint = current\n  }\n}\n\n$mask.onpointerup = $mask.onpointerout = (e) => {\n  eraserLastPoint = void 0\n}\n\n$mask.ontouchstart = $mask.ontouchmove = $mask.ontouchend = $mask.ontouchcancel = (e) => {\n  e.preventDefault()\n  e.stopPropagation()\n}\n\ninterface IUndoStack {\n  index: number\n  stack: { undo: () => void, redo: () => void }[]\n  readonly undoable: boolean\n  readonly redoable: boolean\n  commit(undo: () => void, redo: () => void): void\n  undo(): void\n  redo(): void\n  update(): void\n}\n\nlet undoStack: IUndoStack = {\n  index: 0,\n  stack: [],\n  get undoable() { return this.index > 0 },\n  get redoable() { return this.index < this.stack.length },\n  commit(undo: () => void, redo: () => void) {\n    this.stack[this.index] = { undo, redo }\n    this.index++\n    // Max 20 steps.\n    while (this.stack.length > 20) {\n      this.stack.shift()\n      this.index--\n    }\n    // Delete all redos.\n    this.stack.length = this.index\n    this.update()\n  },\n  undo() {\n    if (this.undoable) {\n      this.index--\n      this.stack[this.index].undo()\n      this.update()\n    }\n  },\n  redo() {\n    if (this.redoable) {\n      this.stack[this.index].redo()\n      this.index++\n      this.update()\n    }\n  },\n  update() {\n    $settings.undo.disabled = !this.undoable\n    $settings.redo.disabled = !this.redoable\n  }\n}\n\ninterface IQueue<T> {\n  push(item: T): this\n  /// Push the last element again, return undefined if no such element.\n  dup(): this | undefined\n  /// Get computed item.\n  get(): T\n}\n\nclass Queue1<T> implements IQueue<T> {\n  item: T | undefined\n\n  push(item: T) {\n    this.item = item\n    return this\n  }\n\n  dup() {\n    if (this.item) return this\n  }\n\n  get() {\n    return this.item!\n  }\n}\n\nclass Queue<T> implements IQueue<T> {\n  items: T[] = []\n  size = 0\n\n  constructor(\n    readonly compute: (items: T[]) => T,\n    readonly capacity = 2,\n  ) { }\n\n  push(item: T): this {\n    this.items.push(item)\n    this.size++\n    while (this.size > this.capacity) {\n      this.items.shift()\n      this.size--\n    }\n    return this\n  }\n\n  dup(): this | undefined {\n    if (this.size > 0) {\n      return this.push(this.items[this.items.length - 1])\n    }\n  }\n\n  get(): T {\n    return this.compute(this.items)\n  }\n}\n\nlet averagePoint = (ps: RawPoint[]): RawPoint => {\n  // Use average x, y and latest p, t.\n  let sum_x = 0, sum_y = 0, pressure = 0.5, timestamp = 0\n  for (let p of ps) {\n    sum_x += p.x\n    sum_y += p.y\n    pressure = p.p\n    timestamp = p.t\n  }\n  return RawPoint.of(sum_x / ps.length, sum_y / ps.length, pressure, timestamp)\n}\n\nlet createQueue = (p: RawPoint): IQueue<RawPoint> => {\n  if ($settings.smooth.value == '0') {\n    return new Queue1<RawPoint>().push(p)\n  } else {\n    let size = Number.parseInt($settings.smooth.value) + 1\n    return new Queue<RawPoint>(averagePoint, size).push(p)\n  }\n}\n\nlet strokes: { [id: number]: [Stroke, SVGPathElement] } = {}\nlet queue: { [id: number]: IQueue<RawPoint> } = {}\nlet dirty: { [id: number]: true } = {}\n\nlet onOpen = (id: number, p: RawPoint) => {\n  let stroke = Stroke.of([p])\n  let $path = $svg.appendChild(document.createElementNS('http://www.w3.org/2000/svg', 'path'))\n  $path.style.pointerEvents = 'none'\n  $path.style.fill = $settings.color.value\n  strokes[id] = [stroke, $path]\n  queue[id] = createQueue(p)\n  dirty[id] = true\n  render()\n}\n\nlet onUpdate = (id: number, p: RawPoint) => {\n  if (strokes[id]) {\n    strokes[id][0].push(queue[id].push(p).get())\n    dirty[id] = true\n    render()\n    requestAnimation()\n  }\n}\n\nlet onCancel = (id: number) => {\n  if (strokes[id]) {\n    strokes[id][1].remove()\n    delete queue[id]\n    delete strokes[id]\n    delete dirty[id]\n  }\n}\n\nlet onClose = (id: number) => {\n  if (strokes[id]) {\n    let [stroke, $path] = strokes[id]\n    let commit = true\n    if (stroke.empty && !stroke.dot) {\n      $path.remove()\n      commit = false\n    }\n    render()\n    delete queue[id]\n    delete dirty[id]\n    requestAnimation()\n    if (commit) undoStack.commit(\n      () => $path.remove(),\n      // The z-index is not correct, but this demo does not care about it.\n      () => $svg.append($path),\n    )\n  }\n}\n\nlet onErase = (p: RawPoint) => {\n  let point = $svg.createSVGPoint()\n  point.x = p.x\n  point.y = p.y\n  for (let $path of $svg.children as unknown as SVGPathElement[]) {\n    $path.isPointInFill(point) && $path.remove()\n  }\n  if (eraserLastPoint) {\n    let dx = p.x - eraserLastPoint.x, dy = p.y - eraserLastPoint.y\n    for (let x = 0; x < 1; x += 0.1) {\n      let point = $svg.createSVGPoint()\n      point.x = p.x - x * dx\n      point.y = p.y - x * dy\n      for (let $path of $svg.children as unknown as SVGPathElement[]) {\n        $path.isPointInFill(point) && $path.remove()\n      }\n    }\n  }\n}\n\n// This happens synchronously, without even a microtask.\nlet render = () => {\n  let now = performance.now()\n  let size = $settings.size.valueAsNumber\n  let tail = $settings.tail.checked\n  for (let id in dirty) {\n    if (strokes[id]) {\n      let [stroke, $path] = strokes[id], d = ''\n      for (let index of stroke.segments) {\n        let outline = stroke.outline(index, size, now, tail)\n        d += stroke.stroke(outline, true)\n      }\n      $path.setAttribute('d', d)\n    }\n    delete dirty[id]\n  }\n}\n\nlet animateId = 0\n\nlet requestAnimation = () => {\n  cancelAnimationFrame(animateId)\n  animateId = requestAnimationFrame(updateAnimation)\n}\n\nlet updateAnimation = () => {\n  render()\n  let schedule = false\n  for (let id in strokes) {\n    let q = queue[id]?.dup()\n    if (q) strokes[id][0].push(q.get())\n    if (strokes[id][0].isSpreading()) {\n      dirty[id] = true\n      schedule = true\n    }\n  }\n  if (schedule) requestAnimation()\n}\n\nlet isMac = /Mac/.test(navigator.platform)\n\ndocument.onkeydown = (ev) => {\n  let ctrl = ev.ctrlKey, shift = ev.shiftKey, meta = ev.metaKey, alt = ev.altKey, code = ev.keyCode\n  let primary = isMac ? meta : ctrl\n\n  const click = (btn: HTMLInputElement | HTMLButtonElement) => {\n    ev.preventDefault()\n    btn.focus(); btn.click()\n  }\n\n  if (!ctrl && !shift && !meta && !alt) {\n    if (code == 80)\n      if ($settings.eraser.checked)\n        click($settings.eraser)\n      else\n        click($settings.pressure)\n    if (code == 69) click($settings.eraser) \n    if (code == 219 || code == 221) {\n      let size = $settings.size.valueAsNumber, inc = code == 221 ? 5 : -5\n      $settings.size.value = '' + clamp(size + inc, +$settings.size.min, +$settings.size.max)\n      $settings.size.dispatchEvent(new InputEvent('input'))\n    }\n    if (code === 84) click($settings.tail)\n  } else if (primary && !shift && code == 90) {\n    click($settings.undo)\n  } else if (primary && shift && code == 90) {\n    click($settings.redo)\n  }\n}\n\nObject.assign(globalThis, {\n  $settings, $svg, strokes, dirty, undoStack,\n})\n"],"names":["clamp","value","min","max","Vec","x","y","vec","other","scalar","d","center","radius","c","px","py","nx","ny","t","Spring","target","dt","delta","velocity","spring","damper","acceleration","RawPoint","p","pressure","timestamp","event","json","Point","v","l","point","vector","distance","length","pressureTillNow","now","pressureTillNow2","Stroke","points","raw","stroke","from","prev","size","tail","end","leftPoints","rightPoints","prevPressure","lastPressure","drawEndCap","tailIndex","prevTimestamp","p2","p1","i","sp","rp","nextVector","nextDot","offset","pl","pr","startCap","firstPoint","endCap","step","lastPoint","direction","start","circle","loop","n","path","curr","middle","segments","$root","$svg","$mask","$settings","defaultPressure","defaultTail","defaultSmooth","defaultSize","matchDark","defaultColor","refreshUrl","current","undoStack","erasing","$option","replacement","search","running","id","onOpen","e0","ev","onUpdate","onClose","onCancel","eraserLastPoint","onErase","undo","redo","Queue1","item","Queue","compute","capacity","averagePoint","ps","sum_x","sum_y","createQueue","strokes","queue","dirty","$path","render","requestAnimation","commit","dx","dy","index","outline","animateId","updateAnimation","_a","schedule","q","isMac","ctrl","shift","meta","alt","code","primary","click","btn","inc"],"mappings":"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"}