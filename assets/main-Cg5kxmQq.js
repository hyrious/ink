const L=(e,t,i)=>e<t?t:e>i?i:e;class u{constructor(t,i){this.x=t,this.y=i}static of(t,i){return new u(t,i)}static from(t){return new u(t.x,t.y)}add(t){return new u(this.x+t.x,this.y+t.y)}subtract(t){return new u(this.x-t.x,this.y-t.y)}multiply(t){return new u(this.x*t,this.y*t)}normalize(t=Math.hypot(this.x,this.y)){return new u(this.x/t,this.y/t)}permutate(){return new u(-this.y,this.x)}negative(){return new u(-this.x,-this.y)}middle(t){return new u((this.x+t.x)/2,(this.y+t.y)/2)}rotate(t,i){const s=Math.sin(i),r=Math.cos(i),o=this.x-t.x,l=this.y-t.y,a=o*r-l*s,h=o*s+l*r;return new u(a+t.x,h+t.y)}dot(t){return this.x*t.x+this.y*t.y}lerp(t,i){return new u(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)}project(t,i){return new u(this.x+t.x*i,this.y+t.y*i)}}class nt{constructor(t=.36){this.value=this.last=this.target=t}set(t){return this.target=t,this}update(t){if(t||(t=.016667),this.value>=0&&this.target>=0&&this.last>=0){let s=this.target-this.value,r=(this.value-this.last)/t,o=2*s,l=.1*r,a=o-l,h=(r+a)*t;this.last=this.value,Math.abs(h)<.01&&Math.abs(s)<.01?this.value=this.target:this.value+=h}return this.value}}class v{constructor(t,i,s,r){this.x=t,this.y=i,this.p=s,this.t=r}static of(t,i,s,r){return new v(t,i,s,r)}static fromEvent(t,i=L(t.pressure||.5,0,1)){return new v(t.clientX,t.clientY,i,t.timeStamp)}static fromJSON(t){return new v(t.x,t.y,t.p,t.t)}}class P{constructor(t,i,s,r){this.p=t,this.v=i,this.d=s,this.l=r}static of(t,i,s,r){return new P(t,i,s,r)}static fromJSON(t){return new P(v.fromJSON(t.p),u.from(t.v),t.d,t.l)}}function rt(e,t){return t-e.p.t>60?Math.min(e.p.p+.05,1):Math.min(e.p.p+.05*(t-e.p.t)/60,1)}function ot(e,t,i){return i-t>60?Math.min(e+.05,1):Math.min(e+.05*(i-t)/60,1)}class D{constructor(t,i=t.length>0?t[t.length-1].l:0){this.points=t,this.length=i,this.segments=[0],this.pending={__proto__:null}}static of(t=[]){let i=new D([],0);for(let s of t)i._push(s);return i._updateSegments(),i}static fromJSON(t){let i=new D(t.points.map(P.fromJSON),t.length);return i.segments=t.segments,i.pending=t.pending,i}get empty(){return this.length==0}get dot(){return this.points.length==1}insert(t,i){if(t==this.points.length){for(let s of i)this._push(s);t=this.points.length,(i=this.pending[t])?(delete this.pending[t],this.insert(t,i)):this._updateSegments()}else if(t>this.points.length)this.pending[t]=i;else throw new RangeError(`Position ${t} conflicts with existing points`);return this}push(t){return this._push(t),this._updateSegments(),this}_push(t){let i=this.points;if(i.length>0){let s=i[i.length-1],r=Math.hypot(t.x-s.p.x,t.y-s.p.y);if(this._updateLength(r),this.length-s.l<4){s.p.p=Math.max(s.p.p,t.p);return}i.push(P.of(t,u.from(t).subtract(s.p).normalize(),r,this.length))}else i.push(P.of(t,u.of(0,0),0,0))}isSpreading(t=performance.now()){return this.points.length>0&&t-this.points[this.points.length-1].p.t<60}outline(t,i,s=performance.now(),r=!0){let o=this.segments.find(a=>t<a),l=this.points.slice(t>0?t-1:t,o);if(l.length>1){let a=[],h=[],c=l.length,S=i,k=l[0].p.p,_=l[c-1].p.p,O=!0,I=-1,Q=l[0].p.t,j=new nt(Math.max(k,.36/5));if(r&&o==null&&c>=2&&(k==.5||k==1||_<.72)){O=!1;let d=l[c-2],f=d.d,E=d,$=0;for(let x=c-3;x>=0&&(E=l[x],f+=E.d,$=d.p.t-E.p.t,!($<=0||$>100));x--)I=x;f>.51*i?I+=Math.ceil((c-I)/3):I=c-3}for(let d=0;d<c;d++){let{p:f,v:E,d:$}=l[d];d==0&&($=0,E=l[1].v);let x=Math.min(1,$/i),tt=Math.min(1,1-x),C=Math.min(1,k+(tt-k)*(x*.5)),U=(d<c-1?l[d+1]:l[d]).v,et=d<c-1?E.dot(U):1;if(C=j.set(C).update((f.t-Q)/800),!O&&d>=I){let Y=1-(c-d-1)/(c-I);C=C*(1-Y*Y)}S=L(i*.5*ot(C,f.t,s),.75,i/2);let X=U.lerp(E,et).permutate().multiply(S),it=u.from(f).subtract(X),st=u.from(f).add(X);a.push(it),h.push(st),Q=f.t,k=f.p}let q=[],V=h[0],K=[];for(let d=1/13,f=0;f<=1;f+=d)q.push(V.rotate(l[0].p,3.1416926535897933*f));if(O){let d=l[c-1],f=d.v.negative().permutate(),E=u.from(d.p).project(f,S);for(let $=1/13,x=0;x<1;x+=$)K.push(E.rotate(d.p,3.1416926535897933*x))}return a.concat(K,h.reverse(),q)}else if(l.length==1){let a=l[0],h=u.from(a.p).project(u.of(1,0),i*.36*rt(a,s)),c=[];for(let S=1/13,k=0;k<=2;k+=S)c.push(h.rotate(a.p,3.1416926535897933*k));return c}else return[]}stroke(t=this.points.map(s=>s.p),i=!1){let s=t.length;if(s==0)return"";let r=t[0],o="",l,a;if(i){a=u.from(r).middle(t[s-1]),o+=`M${a.x.toFixed(2)},${a.y.toFixed(2)}`;for(let h=1;h<s;h++)l=t[h],a=u.from(r).middle(l),o+=`Q${r.x.toFixed(2)},${r.y.toFixed(2)} ${a.x.toFixed(2)},${a.y.toFixed(2)}`,r=l;s>1&&(o+="Z")}else{o+=`M${r.x.toFixed(2)},${r.y.toFixed(2)}`;for(let h=1;h<s;h++)l=t[h],a=u.from(r).middle(l),h==1?o+=`L${a.x.toFixed(2)},${a.y.toFixed(2)}`:o+=`Q${r.x.toFixed(2)},${r.y.toFixed(2)} ${a.x.toFixed(2)},${a.y.toFixed(2)}`,r=l;s>1&&(o+=`L${r.x.toFixed(2)},${r.y.toFixed(2)}`)}return o}_updateLength(t){this.length+=t}_updateSegments(){let t=this.segments,i=this.points,s=i.length;for(let r=t[t.length-1]+1;r<s;r++)i[r].v.dot(i[r-1].v)<0&&(t.push(r),r++)}}let R=document.getElementById("app"),p=R.appendChild(document.createElementNS("http://www.w3.org/2000/svg","svg")),g=R.appendChild(document.createElement("div")),n={color:document.getElementById("stroke-color"),size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),pressure:document.getElementById("pressure"),tail:document.getElementById("tail"),eraser:document.getElementById("eraser"),smooth:document.getElementById("smooth")},lt=n.pressure.checked,at=n.tail.checked,ht=n.smooth.value,ut=n.size.valueAsNumber;p.setAttribute("fill-rule","nonzero");p.setAttribute("fill","currentColor");p.style.cssText=`display: block; width: 100%; height: 100%;
font-size: 0; touch-action: none; position: relative; contain: content;
overflow: hidden; overscroll-behavior: none;`;g.style.cssText=`display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
touch-action: none; contain: content; z-index: 1;`;let pt=matchMedia("(prefers-color-scheme: dark)"),Z=()=>pt.matches?"#ffffff":"#000000";n.color.value=Z();n.color.onchange=n.color.oninput=()=>{M()};n.size.onchange=n.size.oninput=()=>{M()};n.clear.onclick=()=>{let e=Array.from(p.children);p.textContent="",N.commit(()=>p.append(...e),()=>p.textContent="")};n.undo.onclick=()=>N.undo();n.redo.onclick=()=>N.redo();let F;n.pressure.oninput=()=>{F=n.pressure.checked?void 0:.5,M()};n.tail.oninput=()=>{M()};n.smooth.onchange=n.smooth.oninput=()=>{M()};n.eraser.oninput=()=>{let e=n.eraser.checked;g.style.cursor=e?`url(https://api.iconify.design/mdi:eraser.svg?color=${encodeURIComponent(n.color.value)}) 12 32, auto`:"default",g.style.display=e?"block":"none"};for(let e=1;e<=15;e++){let t=document.createElement("option");t.value=t.textContent=String(e),n.smooth.appendChild(t)}let M=()=>{let e="";n.color.value!==Z()&&(e+=`&color=${n.color.value.slice(1)}`),n.size.valueAsNumber!==ut&&(e+=`&size=${n.size.valueAsNumber}`),n.pressure.checked!==lt&&(e+=`&pressure=${n.pressure.checked?1:0}`),n.tail.checked!==at&&(e+=`&tail=${n.tail.checked?1:0}`),n.smooth.value!==ht&&(e+=`&smooth=${n.smooth.value}`),history.replaceState({},"",e?e.replace("&","?"):location.pathname)},w=new URL(location.href).searchParams;w.has("color")&&(n.color.value="#"+w.get("color"));w.has("size")&&(n.size.value=w.get("size"));w.has("pressure")&&(n.pressure.checked=w.get("pressure")!=="0",n.pressure.dispatchEvent(new InputEvent("input")));w.has("tail")&&(n.tail.checked=w.get("tail")!=="0",n.tail.dispatchEvent(new InputEvent("input")));w.has("smooth")&&(n.smooth.value=w.get("smooth"));M();let y=new Map;p.onpointerdown=e=>{let t=e.pointerId;y.has(t)&&H(t),y.set(t,e),e.preventDefault(),e.stopPropagation(),p.setPointerCapture(t),gt(t,v.fromEvent(e,F))};p.onpointermove=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),y.has(t)){let i=y.get(t);if(i.clientX===e.clientX&&i.clientY===e.clientY)return;if(y.set(t,e),e.getCoalescedEvents)for(let s of e.getCoalescedEvents())T(t,v.fromEvent(s,F));else T(t,v.fromEvent(e,F))}};p.onpointerup=p.onpointerout=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),y.has(t)){if(e.getPredictedEvents){let i=y.get(t).getPredictedEvents()[0];i&&T(t,v.fromEvent(i,F))}vt(t),y.delete(t)}};p.onpointercancel=e=>{let t=e.pointerId;e.preventDefault(),e.stopPropagation(),y.has(t)&&(H(t),y.delete(t))};p.ontouchstart=p.ontouchmove=p.ontouchend=p.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let z;g.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),g.setPointerCapture(e.pointerId),W(z=v.fromEvent(e))};g.onpointermove=e=>{if(z){e.preventDefault(),e.stopPropagation();let t=v.fromEvent(e);W(t),z=t}};g.onpointerup=g.onpointerout=e=>{z=void 0};g.ontouchstart=g.ontouchmove=g.ontouchend=g.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let N={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(e,t){for(this.stack[this.index]={undo:e,redo:t},this.index++;this.stack.length>20;)this.stack.shift(),this.index--;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index--,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index++,this.update())},update(){n.undo.disabled=!this.undoable,n.redo.disabled=!this.redoable}};class dt{push(t){return this.item=t,this}dup(){if(this.item)return this}get(){return this.item}}class ct{constructor(t,i=2){this.compute=t,this.capacity=i,this.items=[],this.size=0}push(t){for(this.items.push(t),this.size++;this.size>this.capacity;)this.items.shift(),this.size--;return this}dup(){if(this.size>0)return this.push(this.items[this.items.length-1])}get(){return this.compute(this.items)}}let ft=e=>{let t=0,i=0,s=.5,r=0;for(let o of e)t+=o.x,i+=o.y,s=o.p,r=o.t;return v.of(t/e.length,i/e.length,s,r)},mt=e=>{if(n.smooth.value=="0")return new dt().push(e);{let t=Number.parseInt(n.smooth.value)+1;return new ct(ft,t).push(e)}},m={},A={},b={},gt=(e,t)=>{let i=D.of([t]),s=p.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path"));s.style.pointerEvents="none",s.style.fill=n.color.value,m[e]=[i,s],A[e]=mt(t),b[e]=!0,B()},T=(e,t)=>{m[e]&&(m[e][0].push(A[e].push(t).get()),b[e]=!0,B(),J())},H=e=>{m[e]&&(m[e][1].remove(),delete A[e],delete m[e],delete b[e])},vt=e=>{if(m[e]){let[t,i]=m[e],s=!0;t.empty&&!t.dot&&(i.remove(),s=!1),B(),delete A[e],delete b[e],J(),s&&N.commit(()=>i.remove(),()=>p.append(i))}},W=e=>{let t=p.createSVGPoint();t.x=e.x,t.y=e.y;for(let i of p.children)i.isPointInFill(t)&&i.remove();if(z){let i=e.x-z.x,s=e.y-z.y;for(let r=0;r<1;r+=.1){let o=p.createSVGPoint();o.x=e.x-r*i,o.y=e.y-r*s;for(let l of p.children)l.isPointInFill(o)&&l.remove()}}},B=()=>{let e=performance.now(),t=n.size.valueAsNumber,i=n.tail.checked;for(let s in b){if(m[s]){let r=y.has(+s),[o,l]=m[s],a="";for(let h of o.segments){let c=o.outline(h,t,e,!r&&i);a+=o.stroke(c,!0)}l.setAttribute("d",a)}delete b[s]}},G=0,J=()=>{cancelAnimationFrame(G),G=requestAnimationFrame(xt)},xt=()=>{var t;B();let e=!1;for(let i in m){let s=(t=A[i])==null?void 0:t.dup();s&&m[i][0].push(s.get()),m[i][0].isSpreading()&&(b[i]=!0,e=!0)}e&&J()},yt=/Mac/.test(navigator.platform);document.onkeydown=e=>{let t=e.ctrlKey,i=e.shiftKey,s=e.metaKey,r=e.altKey,o=e.keyCode,l=yt?s:t;const a=h=>{e.preventDefault(),h.focus(),h.click()};if(!t&&!i&&!s&&!r){if(o==80&&(n.eraser.checked?a(n.eraser):a(n.pressure)),o==69&&a(n.eraser),o==219||o==221){let h=n.size.valueAsNumber,c=o==221?5:-5;n.size.value=""+L(h+c,+n.size.min,+n.size.max),n.size.dispatchEvent(new InputEvent("input"))}o===84&&a(n.tail)}else l&&!i&&o==90?a(n.undo):l&&i&&o==90&&a(n.redo)};Object.assign(globalThis,{$settings:n,$svg:p,strokes:m,dirty:b,undoStack:N});
//# sourceMappingURL=main-Cg5kxmQq.js.map
