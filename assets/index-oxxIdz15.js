var Re=Object.defineProperty;var Me=(o,t,e)=>t in o?Re(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var T=(o,t,e)=>(Me(o,typeof t!="symbol"?t+"":t,e),e);const Se=o=>()=>o,Vt=o=>{const t=o?(e,i)=>i.minus(e).abs().isLessThanOrEqualTo(o):Se(!1);return(e,i)=>t(e,i)?0:e.comparedTo(i)};function Le(o){const t=o?(e,i,n,r,c)=>e.exponentiatedBy(2).isLessThanOrEqualTo(r.minus(i).exponentiatedBy(2).plus(c.minus(n).exponentiatedBy(2)).times(o)):Se(!1);return(e,i,n)=>{const r=e.x,c=e.y,h=n.x,g=n.y,E=c.minus(g).times(i.x.minus(h)).minus(r.minus(h).times(i.y.minus(g)));return t(E,r,c,h,g)?0:E.comparedTo(0)}}var ke=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Ft=Math.ceil,Z=Math.floor,V="[BigNumber Error] ",le=V+"Number primitive has more than 15 significant digits: ",it=1e14,R=14,Ut=9007199254740991,Xt=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ct=1e7,F=1e9;function ve(o){var t,e,i,n=_.prototype={constructor:_,toString:null,valueOf:null},r=new _(1),c=20,h=4,g=-7,E=21,S=-1e7,b=1e7,N=!1,A=1,k=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},C="0123456789abcdefghijklmnopqrstuvwxyz",nt=!0;function _(s,l){var u,m,a,d,w,f,p,x,y=this;if(!(y instanceof _))return new _(s,l);if(l==null){if(s&&s._isBigNumber===!0){y.s=s.s,!s.c||s.e>b?y.c=y.e=null:s.e<S?y.c=[y.e=0]:(y.e=s.e,y.c=s.c.slice());return}if((f=typeof s=="number")&&s*0==0){if(y.s=1/s<0?(s=-s,-1):1,s===~~s){for(d=0,w=s;w>=10;w/=10,d++);d>b?y.c=y.e=null:(y.e=d,y.c=[s]);return}x=String(s)}else{if(!ke.test(x=String(s)))return i(y,x,f);y.s=x.charCodeAt(0)==45?(x=x.slice(1),-1):1}(d=x.indexOf("."))>-1&&(x=x.replace(".","")),(w=x.search(/e/i))>0?(d<0&&(d=w),d+=+x.slice(w+1),x=x.substring(0,w)):d<0&&(d=x.length)}else{if(B(l,2,C.length,"Base"),l==10&&nt)return y=new _(s),K(y,c+y.e+1,h);if(x=String(s),f=typeof s=="number"){if(s*0!=0)return i(y,x,f,l);if(y.s=1/s<0?(x=x.slice(1),-1):1,_.DEBUG&&x.replace(/^0\.0*|\./,"").length>15)throw Error(le+s)}else y.s=x.charCodeAt(0)===45?(x=x.slice(1),-1):1;for(u=C.slice(0,l),d=w=0,p=x.length;w<p;w++)if(u.indexOf(m=x.charAt(w))<0){if(m=="."){if(w>d){d=p;continue}}else if(!a&&(x==x.toUpperCase()&&(x=x.toLowerCase())||x==x.toLowerCase()&&(x=x.toUpperCase()))){a=!0,w=-1,d=0;continue}return i(y,String(s),f,l)}f=!1,x=e(x,l,10,y.s),(d=x.indexOf("."))>-1?x=x.replace(".",""):d=x.length}for(w=0;x.charCodeAt(w)===48;w++);for(p=x.length;x.charCodeAt(--p)===48;);if(x=x.slice(w,++p)){if(p-=w,f&&_.DEBUG&&p>15&&(s>Ut||s!==Z(s)))throw Error(le+y.s*s);if((d=d-w-1)>b)y.c=y.e=null;else if(d<S)y.c=[y.e=0];else{if(y.e=d,y.c=[],w=(d+1)%R,d<0&&(w+=R),w<p){for(w&&y.c.push(+x.slice(0,w)),p-=R;w<p;)y.c.push(+x.slice(w,w+=R));w=R-(x=x.slice(w)).length}else w-=p;for(;w--;x+="0");y.c.push(+x)}}else y.c=[y.e=0]}_.clone=ve,_.ROUND_UP=0,_.ROUND_DOWN=1,_.ROUND_CEIL=2,_.ROUND_FLOOR=3,_.ROUND_HALF_UP=4,_.ROUND_HALF_DOWN=5,_.ROUND_HALF_EVEN=6,_.ROUND_HALF_CEIL=7,_.ROUND_HALF_FLOOR=8,_.EUCLID=9,_.config=_.set=function(s){var l,u;if(s!=null)if(typeof s=="object"){if(s.hasOwnProperty(l="DECIMAL_PLACES")&&(u=s[l],B(u,0,F,l),c=u),s.hasOwnProperty(l="ROUNDING_MODE")&&(u=s[l],B(u,0,8,l),h=u),s.hasOwnProperty(l="EXPONENTIAL_AT")&&(u=s[l],u&&u.pop?(B(u[0],-F,0,l),B(u[1],0,F,l),g=u[0],E=u[1]):(B(u,-F,F,l),g=-(E=u<0?-u:u))),s.hasOwnProperty(l="RANGE"))if(u=s[l],u&&u.pop)B(u[0],-F,-1,l),B(u[1],1,F,l),S=u[0],b=u[1];else if(B(u,-F,F,l),u)S=-(b=u<0?-u:u);else throw Error(V+l+" cannot be zero: "+u);if(s.hasOwnProperty(l="CRYPTO"))if(u=s[l],u===!!u)if(u)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))N=u;else throw N=!u,Error(V+"crypto unavailable");else N=u;else throw Error(V+l+" not true or false: "+u);if(s.hasOwnProperty(l="MODULO_MODE")&&(u=s[l],B(u,0,9,l),A=u),s.hasOwnProperty(l="POW_PRECISION")&&(u=s[l],B(u,0,F,l),k=u),s.hasOwnProperty(l="FORMAT"))if(u=s[l],typeof u=="object")U=u;else throw Error(V+l+" not an object: "+u);if(s.hasOwnProperty(l="ALPHABET"))if(u=s[l],typeof u=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(u))nt=u.slice(0,10)=="0123456789",C=u;else throw Error(V+l+" invalid: "+u)}else throw Error(V+"Object expected: "+s);return{DECIMAL_PLACES:c,ROUNDING_MODE:h,EXPONENTIAL_AT:[g,E],RANGE:[S,b],CRYPTO:N,MODULO_MODE:A,POW_PRECISION:k,FORMAT:U,ALPHABET:C}},_.isBigNumber=function(s){if(!s||s._isBigNumber!==!0)return!1;if(!_.DEBUG)return!0;var l,u,m=s.c,a=s.e,d=s.s;t:if({}.toString.call(m)=="[object Array]"){if((d===1||d===-1)&&a>=-F&&a<=F&&a===Z(a)){if(m[0]===0){if(a===0&&m.length===1)return!0;break t}if(l=(a+1)%R,l<1&&(l+=R),String(m[0]).length==l){for(l=0;l<m.length;l++)if(u=m[l],u<0||u>=it||u!==Z(u))break t;if(u!==0)return!0}}}else if(m===null&&a===null&&(d===null||d===1||d===-1))return!0;throw Error(V+"Invalid BigNumber: "+s)},_.maximum=_.max=function(){return At(arguments,-1)},_.minimum=_.min=function(){return At(arguments,1)},_.random=function(){var s=9007199254740992,l=Math.random()*s&2097151?function(){return Z(Math.random()*s)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(u){var m,a,d,w,f,p=0,x=[],y=new _(r);if(u==null?u=c:B(u,0,F),w=Ft(u/R),N)if(crypto.getRandomValues){for(m=crypto.getRandomValues(new Uint32Array(w*=2));p<w;)f=m[p]*131072+(m[p+1]>>>11),f>=9e15?(a=crypto.getRandomValues(new Uint32Array(2)),m[p]=a[0],m[p+1]=a[1]):(x.push(f%1e14),p+=2);p=w/2}else if(crypto.randomBytes){for(m=crypto.randomBytes(w*=7);p<w;)f=(m[p]&31)*281474976710656+m[p+1]*1099511627776+m[p+2]*4294967296+m[p+3]*16777216+(m[p+4]<<16)+(m[p+5]<<8)+m[p+6],f>=9e15?crypto.randomBytes(7).copy(m,p):(x.push(f%1e14),p+=7);p=w/7}else throw N=!1,Error(V+"crypto unavailable");if(!N)for(;p<w;)f=l(),f<9e15&&(x[p++]=f%1e14);for(w=x[--p],u%=R,w&&u&&(f=Xt[R-u],x[p]=Z(w/f)*f);x[p]===0;x.pop(),p--);if(p<0)x=[d=0];else{for(d=-1;x[0]===0;x.splice(0,1),d-=R);for(p=1,f=x[0];f>=10;f/=10,p++);p<R&&(d-=R-p)}return y.e=d,y.c=x,y}}(),_.sum=function(){for(var s=1,l=arguments,u=new _(l[0]);s<l.length;)u=u.plus(l[s++]);return u},e=function(){var s="0123456789";function l(u,m,a,d){for(var w,f=[0],p,x=0,y=u.length;x<y;){for(p=f.length;p--;f[p]*=m);for(f[0]+=d.indexOf(u.charAt(x++)),w=0;w<f.length;w++)f[w]>a-1&&(f[w+1]==null&&(f[w+1]=0),f[w+1]+=f[w]/a|0,f[w]%=a)}return f.reverse()}return function(u,m,a,d,w){var f,p,x,y,v,O,I,L,q=u.indexOf("."),$=c,M=h;for(q>=0&&(y=k,k=0,u=u.replace(".",""),L=new _(m),O=L.pow(u.length-q),k=y,L.c=l(ut(j(O.c),O.e,"0"),10,a,s),L.e=L.c.length),I=l(u,m,a,w?(f=C,s):(f=s,C)),x=y=I.length;I[--y]==0;I.pop());if(!I[0])return f.charAt(0);if(q<0?--x:(O.c=I,O.e=x,O.s=d,O=t(O,L,$,M,a),I=O.c,v=O.r,x=O.e),p=x+$+1,q=I[p],y=a/2,v=v||p<0||I[p+1]!=null,v=M<4?(q!=null||v)&&(M==0||M==(O.s<0?3:2)):q>y||q==y&&(M==4||v||M==6&&I[p-1]&1||M==(O.s<0?8:7)),p<1||!I[0])u=v?ut(f.charAt(1),-$,f.charAt(0)):f.charAt(0);else{if(I.length=p,v)for(--a;++I[--p]>a;)I[p]=0,p||(++x,I=[1].concat(I));for(y=I.length;!I[--y];);for(q=0,u="";q<=y;u+=f.charAt(I[q++]));u=ut(u,x,f.charAt(0))}return u}}(),t=function(){function s(m,a,d){var w,f,p,x,y=0,v=m.length,O=a%ct,I=a/ct|0;for(m=m.slice();v--;)p=m[v]%ct,x=m[v]/ct|0,w=I*p+x*O,f=O*p+w%ct*ct+y,y=(f/d|0)+(w/ct|0)+I*x,m[v]=f%d;return y&&(m=[y].concat(m)),m}function l(m,a,d,w){var f,p;if(d!=w)p=d>w?1:-1;else for(f=p=0;f<d;f++)if(m[f]!=a[f]){p=m[f]>a[f]?1:-1;break}return p}function u(m,a,d,w){for(var f=0;d--;)m[d]-=f,f=m[d]<a[d]?1:0,m[d]=f*w+m[d]-a[d];for(;!m[0]&&m.length>1;m.splice(0,1));}return function(m,a,d,w,f){var p,x,y,v,O,I,L,q,$,M,P,X,Nt,Dt,$t,st,St,J=m.s==a.s?1:-1,Y=m.c,z=a.c;if(!Y||!Y[0]||!z||!z[0])return new _(!m.s||!a.s||(Y?z&&Y[0]==z[0]:!z)?NaN:Y&&Y[0]==0||!z?J*0:J/0);for(q=new _(J),$=q.c=[],x=m.e-a.e,J=d+x+1,f||(f=it,x=W(m.e/R)-W(a.e/R),J=J/R|0),y=0;z[y]==(Y[y]||0);y++);if(z[y]>(Y[y]||0)&&x--,J<0)$.push(1),v=!0;else{for(Dt=Y.length,st=z.length,y=0,J+=2,O=Z(f/(z[0]+1)),O>1&&(z=s(z,O,f),Y=s(Y,O,f),st=z.length,Dt=Y.length),Nt=st,M=Y.slice(0,st),P=M.length;P<st;M[P++]=0);St=z.slice(),St=[0].concat(St),$t=z[0],z[1]>=f/2&&$t++;do{if(O=0,p=l(z,M,st,P),p<0){if(X=M[0],st!=P&&(X=X*f+(M[1]||0)),O=Z(X/$t),O>1)for(O>=f&&(O=f-1),I=s(z,O,f),L=I.length,P=M.length;l(I,M,L,P)==1;)O--,u(I,st<L?St:z,L,f),L=I.length,p=1;else O==0&&(p=O=1),I=z.slice(),L=I.length;if(L<P&&(I=[0].concat(I)),u(M,I,P,f),P=M.length,p==-1)for(;l(z,M,st,P)<1;)O++,u(M,st<P?St:z,P,f),P=M.length}else p===0&&(O++,M=[0]);$[y++]=O,M[0]?M[P++]=Y[Nt]||0:(M=[Y[Nt]],P=1)}while((Nt++<Dt||M[0]!=null)&&J--);v=M[0]!=null,$[0]||$.splice(0,1)}if(f==it){for(y=1,J=$[0];J>=10;J/=10,y++);K(q,d+(q.e=y+x*R-1)+1,w,v)}else q.e=x,q.r=+v;return q}}();function Et(s,l,u,m){var a,d,w,f,p;if(u==null?u=h:B(u,0,8),!s.c)return s.toString();if(a=s.c[0],w=s.e,l==null)p=j(s.c),p=m==1||m==2&&(w<=g||w>=E)?Mt(p,w):ut(p,w,"0");else if(s=K(new _(s),l,u),d=s.e,p=j(s.c),f=p.length,m==1||m==2&&(l<=d||d<=g)){for(;f<l;p+="0",f++);p=Mt(p,d)}else if(l-=w,p=ut(p,d,"0"),d+1>f){if(--l>0)for(p+=".";l--;p+="0");}else if(l+=d-f,l>0)for(d+1==f&&(p+=".");l--;p+="0");return s.s<0&&a?"-"+p:p}function At(s,l){for(var u,m,a=1,d=new _(s[0]);a<s.length;a++)m=new _(s[a]),(!m.s||(u=dt(d,m))===l||u===0&&d.s===l)&&(d=m);return d}function gt(s,l,u){for(var m=1,a=l.length;!l[--a];l.pop());for(a=l[0];a>=10;a/=10,m++);return(u=m+u*R-1)>b?s.c=s.e=null:u<S?s.c=[s.e=0]:(s.e=u,s.c=l),s}i=function(){var s=/^(-?)0([xbo])(?=\w[\w.]*$)/i,l=/^([^.]+)\.$/,u=/^\.([^.]+)$/,m=/^-?(Infinity|NaN)$/,a=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(d,w,f,p){var x,y=f?w:w.replace(a,"");if(m.test(y))d.s=isNaN(y)?null:y<0?-1:1;else{if(!f&&(y=y.replace(s,function(v,O,I){return x=(I=I.toLowerCase())=="x"?16:I=="b"?2:8,!p||p==x?O:v}),p&&(x=p,y=y.replace(l,"$1").replace(u,"0.$1")),w!=y))return new _(y,x);if(_.DEBUG)throw Error(V+"Not a"+(p?" base "+p:"")+" number: "+w);d.s=null}d.c=d.e=null}}();function K(s,l,u,m){var a,d,w,f,p,x,y,v=s.c,O=Xt;if(v){t:{for(a=1,f=v[0];f>=10;f/=10,a++);if(d=l-a,d<0)d+=R,w=l,p=v[x=0],y=Z(p/O[a-w-1]%10);else if(x=Ft((d+1)/R),x>=v.length)if(m){for(;v.length<=x;v.push(0));p=y=0,a=1,d%=R,w=d-R+1}else break t;else{for(p=f=v[x],a=1;f>=10;f/=10,a++);d%=R,w=d-R+a,y=w<0?0:Z(p/O[a-w-1]%10)}if(m=m||l<0||v[x+1]!=null||(w<0?p:p%O[a-w-1]),m=u<4?(y||m)&&(u==0||u==(s.s<0?3:2)):y>5||y==5&&(u==4||m||u==6&&(d>0?w>0?p/O[a-w]:0:v[x-1])%10&1||u==(s.s<0?8:7)),l<1||!v[0])return v.length=0,m?(l-=s.e+1,v[0]=O[(R-l%R)%R],s.e=-l||0):v[0]=s.e=0,s;if(d==0?(v.length=x,f=1,x--):(v.length=x+1,f=O[R-d],v[x]=w>0?Z(p/O[a-w]%O[w])*f:0),m)for(;;)if(x==0){for(d=1,w=v[0];w>=10;w/=10,d++);for(w=v[0]+=f,f=1;w>=10;w/=10,f++);d!=f&&(s.e++,v[0]==it&&(v[0]=1));break}else{if(v[x]+=f,v[x]!=it)break;v[x--]=0,f=1}for(d=v.length;v[--d]===0;v.pop());}s.e>b?s.c=s.e=null:s.e<S&&(s.c=[s.e=0])}return s}function H(s){var l,u=s.e;return u===null?s.toString():(l=j(s.c),l=u<=g||u>=E?Mt(l,u):ut(l,u,"0"),s.s<0?"-"+l:l)}return n.absoluteValue=n.abs=function(){var s=new _(this);return s.s<0&&(s.s=1),s},n.comparedTo=function(s,l){return dt(this,new _(s,l))},n.decimalPlaces=n.dp=function(s,l){var u,m,a,d=this;if(s!=null)return B(s,0,F),l==null?l=h:B(l,0,8),K(new _(d),s+d.e+1,l);if(!(u=d.c))return null;if(m=((a=u.length-1)-W(this.e/R))*R,a=u[a])for(;a%10==0;a/=10,m--);return m<0&&(m=0),m},n.dividedBy=n.div=function(s,l){return t(this,new _(s,l),c,h)},n.dividedToIntegerBy=n.idiv=function(s,l){return t(this,new _(s,l),0,1)},n.exponentiatedBy=n.pow=function(s,l){var u,m,a,d,w,f,p,x,y,v=this;if(s=new _(s),s.c&&!s.isInteger())throw Error(V+"Exponent not an integer: "+H(s));if(l!=null&&(l=new _(l)),f=s.e>14,!v.c||!v.c[0]||v.c[0]==1&&!v.e&&v.c.length==1||!s.c||!s.c[0])return y=new _(Math.pow(+H(v),f?s.s*(2-Rt(s)):+H(s))),l?y.mod(l):y;if(p=s.s<0,l){if(l.c?!l.c[0]:!l.s)return new _(NaN);m=!p&&v.isInteger()&&l.isInteger(),m&&(v=v.mod(l))}else{if(s.e>9&&(v.e>0||v.e<-1||(v.e==0?v.c[0]>1||f&&v.c[1]>=24e7:v.c[0]<8e13||f&&v.c[0]<=9999975e7)))return d=v.s<0&&Rt(s)?-0:0,v.e>-1&&(d=1/d),new _(p?1/d:d);k&&(d=Ft(k/R+2))}for(f?(u=new _(.5),p&&(s.s=1),x=Rt(s)):(a=Math.abs(+H(s)),x=a%2),y=new _(r);;){if(x){if(y=y.times(v),!y.c)break;d?y.c.length>d&&(y.c.length=d):m&&(y=y.mod(l))}if(a){if(a=Z(a/2),a===0)break;x=a%2}else if(s=s.times(u),K(s,s.e+1,1),s.e>14)x=Rt(s);else{if(a=+H(s),a===0)break;x=a%2}v=v.times(v),d?v.c&&v.c.length>d&&(v.c.length=d):m&&(v=v.mod(l))}return m?y:(p&&(y=r.div(y)),l?y.mod(l):d?K(y,k,h,w):y)},n.integerValue=function(s){var l=new _(this);return s==null?s=h:B(s,0,8),K(l,l.e+1,s)},n.isEqualTo=n.eq=function(s,l){return dt(this,new _(s,l))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(s,l){return dt(this,new _(s,l))>0},n.isGreaterThanOrEqualTo=n.gte=function(s,l){return(l=dt(this,new _(s,l)))===1||l===0},n.isInteger=function(){return!!this.c&&W(this.e/R)>this.c.length-2},n.isLessThan=n.lt=function(s,l){return dt(this,new _(s,l))<0},n.isLessThanOrEqualTo=n.lte=function(s,l){return(l=dt(this,new _(s,l)))===-1||l===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(s,l){var u,m,a,d,w=this,f=w.s;if(s=new _(s,l),l=s.s,!f||!l)return new _(NaN);if(f!=l)return s.s=-l,w.plus(s);var p=w.e/R,x=s.e/R,y=w.c,v=s.c;if(!p||!x){if(!y||!v)return y?(s.s=-l,s):new _(v?w:NaN);if(!y[0]||!v[0])return v[0]?(s.s=-l,s):new _(y[0]?w:h==3?-0:0)}if(p=W(p),x=W(x),y=y.slice(),f=p-x){for((d=f<0)?(f=-f,a=y):(x=p,a=v),a.reverse(),l=f;l--;a.push(0));a.reverse()}else for(m=(d=(f=y.length)<(l=v.length))?f:l,f=l=0;l<m;l++)if(y[l]!=v[l]){d=y[l]<v[l];break}if(d&&(a=y,y=v,v=a,s.s=-s.s),l=(m=v.length)-(u=y.length),l>0)for(;l--;y[u++]=0);for(l=it-1;m>f;){if(y[--m]<v[m]){for(u=m;u&&!y[--u];y[u]=l);--y[u],y[m]+=it}y[m]-=v[m]}for(;y[0]==0;y.splice(0,1),--x);return y[0]?gt(s,y,x):(s.s=h==3?-1:1,s.c=[s.e=0],s)},n.modulo=n.mod=function(s,l){var u,m,a=this;return s=new _(s,l),!a.c||!s.s||s.c&&!s.c[0]?new _(NaN):!s.c||a.c&&!a.c[0]?new _(a):(A==9?(m=s.s,s.s=1,u=t(a,s,0,3),s.s=m,u.s*=m):u=t(a,s,0,A),s=a.minus(u.times(s)),!s.c[0]&&A==1&&(s.s=a.s),s)},n.multipliedBy=n.times=function(s,l){var u,m,a,d,w,f,p,x,y,v,O,I,L,q,$,M=this,P=M.c,X=(s=new _(s,l)).c;if(!P||!X||!P[0]||!X[0])return!M.s||!s.s||P&&!P[0]&&!X||X&&!X[0]&&!P?s.c=s.e=s.s=null:(s.s*=M.s,!P||!X?s.c=s.e=null:(s.c=[0],s.e=0)),s;for(m=W(M.e/R)+W(s.e/R),s.s*=M.s,p=P.length,v=X.length,p<v&&(L=P,P=X,X=L,a=p,p=v,v=a),a=p+v,L=[];a--;L.push(0));for(q=it,$=ct,a=v;--a>=0;){for(u=0,O=X[a]%$,I=X[a]/$|0,w=p,d=a+w;d>a;)x=P[--w]%$,y=P[w]/$|0,f=I*x+y*O,x=O*x+f%$*$+L[d]+u,u=(x/q|0)+(f/$|0)+I*y,L[d--]=x%q;L[d]=u}return u?++m:L.splice(0,1),gt(s,L,m)},n.negated=function(){var s=new _(this);return s.s=-s.s||null,s},n.plus=function(s,l){var u,m=this,a=m.s;if(s=new _(s,l),l=s.s,!a||!l)return new _(NaN);if(a!=l)return s.s=-l,m.minus(s);var d=m.e/R,w=s.e/R,f=m.c,p=s.c;if(!d||!w){if(!f||!p)return new _(a/0);if(!f[0]||!p[0])return p[0]?s:new _(f[0]?m:a*0)}if(d=W(d),w=W(w),f=f.slice(),a=d-w){for(a>0?(w=d,u=p):(a=-a,u=f),u.reverse();a--;u.push(0));u.reverse()}for(a=f.length,l=p.length,a-l<0&&(u=p,p=f,f=u,l=a),a=0;l;)a=(f[--l]=f[l]+p[l]+a)/it|0,f[l]=it===f[l]?0:f[l]%it;return a&&(f=[a].concat(f),++w),gt(s,f,w)},n.precision=n.sd=function(s,l){var u,m,a,d=this;if(s!=null&&s!==!!s)return B(s,1,F),l==null?l=h:B(l,0,8),K(new _(d),s,l);if(!(u=d.c))return null;if(a=u.length-1,m=a*R+1,a=u[a]){for(;a%10==0;a/=10,m--);for(a=u[0];a>=10;a/=10,m++);}return s&&d.e+1>m&&(m=d.e+1),m},n.shiftedBy=function(s){return B(s,-Ut,Ut),this.times("1e"+s)},n.squareRoot=n.sqrt=function(){var s,l,u,m,a,d=this,w=d.c,f=d.s,p=d.e,x=c+4,y=new _("0.5");if(f!==1||!w||!w[0])return new _(!f||f<0&&(!w||w[0])?NaN:w?d:1/0);if(f=Math.sqrt(+H(d)),f==0||f==1/0?(l=j(w),(l.length+p)%2==0&&(l+="0"),f=Math.sqrt(+l),p=W((p+1)/2)-(p<0||p%2),f==1/0?l="5e"+p:(l=f.toExponential(),l=l.slice(0,l.indexOf("e")+1)+p),u=new _(l)):u=new _(f+""),u.c[0]){for(p=u.e,f=p+x,f<3&&(f=0);;)if(a=u,u=y.times(a.plus(t(d,a,x,1))),j(a.c).slice(0,f)===(l=j(u.c)).slice(0,f))if(u.e<p&&--f,l=l.slice(f-3,f+1),l=="9999"||!m&&l=="4999"){if(!m&&(K(a,a.e+c+2,0),a.times(a).eq(d))){u=a;break}x+=4,f+=4,m=1}else{(!+l||!+l.slice(1)&&l.charAt(0)=="5")&&(K(u,u.e+c+2,1),s=!u.times(u).eq(d));break}}return K(u,u.e+c+1,h,s)},n.toExponential=function(s,l){return s!=null&&(B(s,0,F),s++),Et(this,s,l,1)},n.toFixed=function(s,l){return s!=null&&(B(s,0,F),s=s+this.e+1),Et(this,s,l)},n.toFormat=function(s,l,u){var m,a=this;if(u==null)s!=null&&l&&typeof l=="object"?(u=l,l=null):s&&typeof s=="object"?(u=s,s=l=null):u=U;else if(typeof u!="object")throw Error(V+"Argument not an object: "+u);if(m=a.toFixed(s,l),a.c){var d,w=m.split("."),f=+u.groupSize,p=+u.secondaryGroupSize,x=u.groupSeparator||"",y=w[0],v=w[1],O=a.s<0,I=O?y.slice(1):y,L=I.length;if(p&&(d=f,f=p,p=d,L-=d),f>0&&L>0){for(d=L%f||f,y=I.substr(0,d);d<L;d+=f)y+=x+I.substr(d,f);p>0&&(y+=x+I.slice(d)),O&&(y="-"+y)}m=v?y+(u.decimalSeparator||"")+((p=+u.fractionGroupSize)?v.replace(new RegExp("\\d{"+p+"}\\B","g"),"$&"+(u.fractionGroupSeparator||"")):v):y}return(u.prefix||"")+m+(u.suffix||"")},n.toFraction=function(s){var l,u,m,a,d,w,f,p,x,y,v,O,I=this,L=I.c;if(s!=null&&(f=new _(s),!f.isInteger()&&(f.c||f.s!==1)||f.lt(r)))throw Error(V+"Argument "+(f.isInteger()?"out of range: ":"not an integer: ")+H(f));if(!L)return new _(I);for(l=new _(r),x=u=new _(r),m=p=new _(r),O=j(L),d=l.e=O.length-I.e-1,l.c[0]=Xt[(w=d%R)<0?R+w:w],s=!s||f.comparedTo(l)>0?d>0?l:x:f,w=b,b=1/0,f=new _(O),p.c[0]=0;y=t(f,l,0,1),a=u.plus(y.times(m)),a.comparedTo(s)!=1;)u=m,m=a,x=p.plus(y.times(a=x)),p=a,l=f.minus(y.times(a=l)),f=a;return a=t(s.minus(u),m,0,1),p=p.plus(a.times(x)),u=u.plus(a.times(m)),p.s=x.s=I.s,d=d*2,v=t(x,m,d,h).minus(I).abs().comparedTo(t(p,u,d,h).minus(I).abs())<1?[x,m]:[p,u],b=w,v},n.toNumber=function(){return+H(this)},n.toPrecision=function(s,l){return s!=null&&B(s,1,F),Et(this,s,l,2)},n.toString=function(s){var l,u=this,m=u.s,a=u.e;return a===null?m?(l="Infinity",m<0&&(l="-"+l)):l="NaN":(s==null?l=a<=g||a>=E?Mt(j(u.c),a):ut(j(u.c),a,"0"):s===10&&nt?(u=K(new _(u),c+a+1,h),l=ut(j(u.c),u.e,"0")):(B(s,2,C.length,"Base"),l=e(ut(j(u.c),a,"0"),10,s,m,!0)),m<0&&u.c[0]&&(l="-"+l)),l},n.valueOf=n.toJSON=function(){return H(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,o!=null&&_.set(o),_}function W(o){var t=o|0;return o>0||o===t?t:t-1}function j(o){for(var t,e,i=1,n=o.length,r=o[0]+"";i<n;){for(t=o[i++]+"",e=R-t.length;e--;t="0"+t);r+=t}for(n=r.length;r.charCodeAt(--n)===48;);return r.slice(0,n+1||1)}function dt(o,t){var e,i,n=o.c,r=t.c,c=o.s,h=t.s,g=o.e,E=t.e;if(!c||!h)return null;if(e=n&&!n[0],i=r&&!r[0],e||i)return e?i?0:-h:c;if(c!=h)return c;if(e=c<0,i=g==E,!n||!r)return i?0:!n^e?1:-1;if(!i)return g>E^e?1:-1;for(h=(g=n.length)<(E=r.length)?g:E,c=0;c<h;c++)if(n[c]!=r[c])return n[c]>r[c]^e?1:-1;return g==E?0:g>E^e?1:-1}function B(o,t,e,i){if(o<t||o>e||o!==Z(o))throw Error(V+(i||"Argument")+(typeof o=="number"?o<t||o>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(o))}function Rt(o){var t=o.c.length-1;return W(o.e/R)==t&&o.c[t]%2!=0}function Mt(o,t){return(o.length>1?o.charAt(0)+"."+o.slice(1):o)+(t<0?"e":"e+")+t}function ut(o,t,e){var i,n;if(t<0){for(n=e+".";++t;n+=e);o=n+o}else if(i=o.length,++t>i){for(n=e,t-=i;--t;n+=e);o+=n}else t<i&&(o=o.slice(0,t)+"."+o.slice(t));return o}var rt=ve();class Pe{constructor(t){T(this,"key");T(this,"left",null);T(this,"right",null);this.key=t}}class vt extends Pe{constructor(t){super(t)}}class Ce{constructor(){T(this,"size",0);T(this,"modificationCount",0);T(this,"splayCount",0)}splay(t){const e=this.root;if(e==null)return this.compare(t,t),-1;let i=null,n=null,r=null,c=null,h=e;const g=this.compare;let E;for(;;)if(E=g(h.key,t),E>0){let S=h.left;if(S==null||(E=g(S.key,t),E>0&&(h.left=S.right,S.right=h,h=S,S=h.left,S==null)))break;i==null?n=h:i.left=h,i=h,h=S}else if(E<0){let S=h.right;if(S==null||(E=g(S.key,t),E<0&&(h.right=S.left,S.left=h,h=S,S=h.right,S==null)))break;r==null?c=h:r.right=h,r=h,h=S}else break;return r!=null&&(r.right=h.left,h.left=c),i!=null&&(i.left=h.right,h.right=n),this.root!==h&&(this.root=h,this.splayCount++),E}splayMin(t){let e=t,i=e.left;for(;i!=null;){const n=i;e.left=n.right,n.right=e,e=n,i=e.left}return e}splayMax(t){let e=t,i=e.right;for(;i!=null;){const n=i;e.right=n.left,n.left=e,e=n,i=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let i=this.root;const n=i,r=i.left;if(this.size--,r==null)this.root=i.right;else{const c=i.right;i=this.splayMax(r),i.right=c,this.root=i}return this.modificationCount++,n}addNewRoot(t,e){this.size++,this.modificationCount++;const i=this.root;if(i==null){this.root=t;return}e<0?(t.left=i,t.right=i.right,i.right=null):(t.right=i,t.left=i.left,i.left=null),this.root=t}_first(){const t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){const t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}}var oi;const mt=class mt extends Ce{constructor(e,i){super();T(this,"root",null);T(this,"compare");T(this,"validKey");T(this,oi,"[object Set]");this.compare=e??this.defaultCompare(),this.validKey=i??(n=>n!=null&&n!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const i of e)this.delete(i)}forEach(e){const i=this[Symbol.iterator]();let n;for(;n=i.next(),!n.done;)e(n.value,n.value,this)}add(e){const i=this.splay(e);return i!=0&&this.addNewRoot(new vt(e),i),this}addAndReturn(e){const i=this.splay(e);return i!=0&&this.addNewRoot(new vt(e),i),this.root.key}addAll(e){for(const i of e)this.add(i)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let n=this.root.left;if(n==null)return null;let r=n.right;for(;r!=null;)n=r,r=n.right;return n.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let n=this.root.right;if(n==null)return null;let r=n.left;for(;r!=null;)n=r,r=n.left;return n.key}retainAll(e){const i=new mt(this.compare,this.validKey),n=this.modificationCount;for(const r of e){if(n!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(r)&&this.splay(r)==0&&i.add(this.root.key)}i.size!=this.size&&(this.root=i.root,this.size=i.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const i=new mt(this.compare,this.validKey);for(const n of this)e.has(n)&&i.add(n);return i}difference(e){const i=new mt(this.compare,this.validKey);for(const n of this)e.has(n)||i.add(n);return i}union(e){const i=this.clone();return i.addAll(e),i}clone(){const e=new mt(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function i(r,c){let h,g;do{if(h=r.left,g=r.right,h!=null){const E=new vt(h.key);c.left=E,i(h,E)}if(g!=null){const E=new vt(g.key);c.right=E,r=g,c=E}}while(g!=null)}const n=new vt(e.key);return i(e,n),n}toSet(){return this.clone()}entries(){return new Ge(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Be(this.wrap())}};oi=Symbol.toStringTag;let xt=mt;class _e{constructor(t){T(this,"tree");T(this,"path",new Array);T(this,"modificationCount",null);T(this,"splayCount");this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let i=this.tree.getRoot();for(;i!=null;)this.path.push(i),i=i.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}}class Be extends _e{getValue(t){return t.key}}class Ge extends _e{getValue(t){return[t.key,t.key]}}const qe=o=>o,ze=o=>{if(o){const t=new xt(Vt(o)),e=new xt(Vt(o)),i=(r,c)=>c.addAndReturn(r),n=r=>({x:i(r.x,t),y:i(r.y,e)});return n({x:new rt(0),y:new rt(0)}),n}return qe},Ht=o=>({set:t=>{ft=Ht(t)},reset:()=>Ht(o),compare:Vt(o),snap:ze(o),orient:Le(o)});let ft=Ht();const _t=(o,t)=>o.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(o.ur.x)&&o.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(o.ur.y),Jt=(o,t)=>{if(t.ur.x.isLessThan(o.ll.x)||o.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(o.ll.y)||o.ur.y.isLessThan(t.ll.y))return null;const e=o.ll.x.isLessThan(t.ll.x)?t.ll.x:o.ll.x,i=o.ur.x.isLessThan(t.ur.x)?o.ur.x:t.ur.x,n=o.ll.y.isLessThan(t.ll.y)?t.ll.y:o.ll.y,r=o.ur.y.isLessThan(t.ur.y)?o.ur.y:t.ur.y;return{ll:{x:e,y:n},ur:{x:i,y:r}}},kt=(o,t)=>o.x.times(t.y).minus(o.y.times(t.x)),be=(o,t)=>o.x.times(t.x).plus(o.y.times(t.y)),Ct=o=>be(o,o).sqrt(),De=(o,t,e)=>{const i={x:t.x.minus(o.x),y:t.y.minus(o.y)},n={x:e.x.minus(o.x),y:e.y.minus(o.y)};return kt(n,i).div(Ct(n)).div(Ct(i))},$e=(o,t,e)=>{const i={x:t.x.minus(o.x),y:t.y.minus(o.y)},n={x:e.x.minus(o.x),y:e.y.minus(o.y)};return be(n,i).div(Ct(n)).div(Ct(i))},ue=(o,t,e)=>t.y.isZero()?null:{x:o.x.plus(t.x.div(t.y).times(e.minus(o.y))),y:e},he=(o,t,e)=>t.x.isZero()?null:{x:e,y:o.y.plus(t.y.div(t.x).times(e.minus(o.x)))},Fe=(o,t,e,i)=>{if(t.x.isZero())return he(e,i,o.x);if(i.x.isZero())return he(o,t,e.x);if(t.y.isZero())return ue(e,i,o.y);if(i.y.isZero())return ue(o,t,e.y);const n=kt(t,i);if(n.isZero())return null;const r={x:e.x.minus(o.x),y:e.y.minus(o.y)},c=kt(r,t).div(n),h=kt(r,i).div(n),g=o.x.plus(h.times(t.x)),E=e.x.plus(c.times(i.x)),S=o.y.plus(h.times(t.y)),b=e.y.plus(c.times(i.y)),N=g.plus(E).div(2),A=S.plus(b).div(2);return{x:N,y:A}};class Q{constructor(t,e){T(this,"point");T(this,"isLeft");T(this,"segment");T(this,"otherSE");T(this,"consumedBy");t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}static compare(t,e){const i=Q.comparePoints(t.point,e.point);return i!==0?i:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:pt.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x.isLessThan(e.x)?-1:t.x.isGreaterThan(e.x)?1:t.y.isLessThan(e.y)?-1:t.y.isGreaterThan(e.y)?1:0}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let i=0,n=e.length;i<n;i++){const r=e[i];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const i=this.point.events[e];if(i.segment.consumedBy===void 0)for(let n=e+1;n<t;n++){const r=this.point.events[n];r.consumedBy===void 0&&i.otherSE.point.events===r.otherSE.point.events&&i.segment.consume(r.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,i=this.point.events.length;e<i;e++){const n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){const e=new Map,i=n=>{const r=n.otherSE;e.set(n,{sine:De(this.point,t.point,r.point),cosine:$e(this.point,t.point,r.point)})};return(n,r)=>{e.has(n)||i(n),e.has(r)||i(r);const{sine:c,cosine:h}=e.get(n),{sine:g,cosine:E}=e.get(r);return c.isGreaterThanOrEqualTo(0)&&g.isGreaterThanOrEqualTo(0)?h.isLessThan(E)?1:h.isGreaterThan(E)?-1:0:c.isLessThan(0)&&g.isLessThan(0)?h.isLessThan(E)?-1:h.isGreaterThan(E)?1:0:g.isLessThan(c)?-1:g.isGreaterThan(c)?1:0}}}let Ue=0;class pt{constructor(t,e,i,n){T(this,"id");T(this,"leftSE");T(this,"rightSE");T(this,"rings");T(this,"windings");T(this,"ringOut");T(this,"consumedBy");T(this,"prev");T(this,"_prevInResult");T(this,"_beforeState");T(this,"_afterState");T(this,"_isInResult");this.id=++Ue,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=i,this.windings=n}static compare(t,e){const i=t.leftSE.point.x,n=e.leftSE.point.x,r=t.rightSE.point.x,c=e.rightSE.point.x;if(c.isLessThan(i))return 1;if(r.isLessThan(n))return-1;const h=t.leftSE.point.y,g=e.leftSE.point.y,E=t.rightSE.point.y,S=e.rightSE.point.y;if(i.isLessThan(n)){if(g.isLessThan(h)&&g.isLessThan(E))return 1;if(g.isGreaterThan(h)&&g.isGreaterThan(E))return-1;const b=t.comparePoint(e.leftSE.point);if(b<0)return 1;if(b>0)return-1;const N=e.comparePoint(t.rightSE.point);return N!==0?N:-1}if(i.isGreaterThan(n)){if(h.isLessThan(g)&&h.isLessThan(S))return-1;if(h.isGreaterThan(g)&&h.isGreaterThan(S))return 1;const b=e.comparePoint(t.leftSE.point);if(b!==0)return b;const N=t.comparePoint(e.rightSE.point);return N<0?1:N>0?-1:1}if(h.isLessThan(g))return-1;if(h.isGreaterThan(g))return 1;if(r.isLessThan(c)){const b=e.comparePoint(t.rightSE.point);if(b!==0)return b}if(r.isGreaterThan(c)){const b=t.comparePoint(e.rightSE.point);if(b<0)return 1;if(b>0)return-1}if(!r.eq(c)){const b=E.minus(h),N=r.minus(i),A=S.minus(g),k=c.minus(n);if(b.isGreaterThan(N)&&A.isLessThan(k))return 1;if(b.isLessThan(N)&&A.isGreaterThan(k))return-1}return r.isGreaterThan(c)?1:r.isLessThan(c)||E.isLessThan(S)?-1:E.isGreaterThan(S)?1:t.id<e.id?-1:t.id>e.id?1:0}static fromRing(t,e,i){let n,r,c;const h=Q.comparePoints(t,e);if(h<0)n=t,r=e,c=1;else if(h>0)n=e,r=t,c=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const g=new Q(n,!0),E=new Q(r,!1);return new pt(g,E,[i],[c])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(e)?t:e},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(e)?t:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return ft.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){const e=this.bbox(),i=t.bbox(),n=Jt(e,i);if(n===null)return null;const r=this.leftSE.point,c=this.rightSE.point,h=t.leftSE.point,g=t.rightSE.point,E=_t(e,h)&&this.comparePoint(h)===0,S=_t(i,r)&&t.comparePoint(r)===0,b=_t(e,g)&&this.comparePoint(g)===0,N=_t(i,c)&&t.comparePoint(c)===0;if(S&&E)return N&&!b?c:!N&&b?g:null;if(S)return b&&r.x.eq(g.x)&&r.y.eq(g.y)?null:r;if(E)return N&&c.x.eq(h.x)&&c.y.eq(h.y)?null:h;if(N&&b)return null;if(N)return c;if(b)return g;const A=Fe(r,this.vector(),h,t.vector());return A===null||!_t(n,A)?null:ft.snap(A)}split(t){const e=[],i=t.events!==void 0,n=new Q(t,!0),r=new Q(t,!1),c=this.rightSE;this.replaceRightSE(r),e.push(r),e.push(n);const h=new pt(n,c,this.rings.slice(),this.windings.slice());return Q.comparePoints(h.leftSE.point,h.rightSE.point)>0&&h.swapEvents(),Q.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),r.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,i=this.windings.length;e<i;e++)this.windings[e]*=-1}consume(t){let e=this,i=t;for(;e.consumedBy;)e=e.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const n=pt.compare(e,i);if(n!==0){if(n>0){const r=e;e=i,i=r}if(e.prev===i){const r=e;e=i,i=r}for(let r=0,c=i.rings.length;r<c;r++){const h=i.rings[r],g=i.windings[r],E=e.rings.indexOf(h);E===-1?(e.rings.push(h),e.windings.push(g)):e.windings[E]+=g}i.rings=null,i.windings=null,i.consumedBy=e,i.leftSE.consumedBy=e.leftSE,i.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let h=0,g=this.rings.length;h<g;h++){const E=this.rings[h],S=this.windings[h],b=e.indexOf(E);b===-1?(e.push(E),i.push(S)):i[b]+=S}const r=[],c=[];for(let h=0,g=e.length;h<g;h++){if(i[h]===0)continue;const E=e[h],S=E.poly;if(c.indexOf(S)===-1)if(E.isExterior)r.push(S);else{c.indexOf(S)===-1&&c.push(S);const b=r.indexOf(E.poly);b!==-1&&r.splice(b,1)}}for(let h=0,g=r.length;h<g;h++){const E=r[h].multiPoly;n.indexOf(E)===-1&&n.push(E)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Gt.type){case"union":{const i=t.length===0,n=e.length===0;this._isInResult=i!==n;break}case"intersection":{let i,n;t.length<e.length?(i=t.length,n=e.length):(i=e.length,n=t.length),this._isInResult=n===Gt.numMultiPolys&&i<n;break}case"xor":{const i=Math.abs(t.length-e.length);this._isInResult=i%2===1;break}case"difference":{const i=n=>n.length===1&&n[0].isSubject;this._isInResult=i(t)!==i(e);break}}return this._isInResult}}class fe{constructor(t,e,i){T(this,"poly");T(this,"isExterior");T(this,"segments");T(this,"bbox");if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=ft.snap({x:new rt(t[0][0]),y:new rt(t[0][1])});this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let r=n;for(let c=1,h=t.length;c<h;c++){if(typeof t[c][0]!="number"||typeof t[c][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const g=ft.snap({x:new rt(t[c][0]),y:new rt(t[c][1])});g.x.eq(r.x)&&g.y.eq(r.y)||(this.segments.push(pt.fromRing(r,g,this)),g.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=g.x),g.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=g.y),g.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=g.x),g.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=g.y),r=g)}(!n.x.eq(r.x)||!n.y.eq(r.y))&&this.segments.push(pt.fromRing(r,n,this))}getSweepEvents(){const t=[];for(let e=0,i=this.segments.length;e<i;e++){const n=this.segments[e];t.push(n.leftSE),t.push(n.rightSE)}return t}}class Xe{constructor(t,e){T(this,"multiPoly");T(this,"exteriorRing");T(this,"interiorRings");T(this,"bbox");if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new fe(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,n=t.length;i<n;i++){const r=new fe(t[i],this,!1);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,i=this.interiorRings.length;e<i;e++){const n=this.interiorRings[e].getSweepEvents();for(let r=0,c=n.length;r<c;r++)t.push(n[r])}return t}}class ce{constructor(t,e){T(this,"isSubject");T(this,"polys");T(this,"bbox");if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new rt(Number.POSITIVE_INFINITY),y:new rt(Number.POSITIVE_INFINITY)},ur:{x:new rt(Number.NEGATIVE_INFINITY),y:new rt(Number.NEGATIVE_INFINITY)}};for(let i=0,n=t.length;i<n;i++){const r=new Xe(t[i],this);r.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const n=this.polys[e].getSweepEvents();for(let r=0,c=n.length;r<c;r++)t.push(n[r])}return t}}class Bt{constructor(t){T(this,"events");T(this,"poly");T(this,"_isExteriorRing");T(this,"_enclosingRing");this.events=t;for(let e=0,i=t.length;e<i;e++)t[e].segment.ringOut=this;this.poly=null}static factory(t){const e=[];for(let i=0,n=t.length;i<n;i++){const r=t[i];if(!r.isInResult()||r.ringOut)continue;let c=null,h=r.leftSE,g=r.rightSE;const E=[h],S=h.point,b=[];for(;c=h,h=g,E.push(h),h.point!==S;)for(;;){const N=h.getAvailableLinkedEvents();if(N.length===0){const U=E[0].point,C=E[E.length-1].point;throw new Error(`Unable to complete output ring starting at [${U.x}, ${U.y}]. Last matching segment found ends at [${C.x}, ${C.y}].`)}if(N.length===1){g=N[0].otherSE;break}let A=null;for(let U=0,C=b.length;U<C;U++)if(b[U].point===h.point){A=U;break}if(A!==null){const U=b.splice(A)[0],C=E.splice(U.index);C.unshift(C[0].otherSE),e.push(new Bt(C.reverse()));continue}b.push({index:E.length,point:h.point});const k=h.getLeftmostComparator(c);g=N.sort(k)[0].otherSE;break}e.push(new Bt(E))}return e}getGeom(){let t=this.events[0].point;const e=[t];for(let E=1,S=this.events.length-1;E<S;E++){const b=this.events[E].point,N=this.events[E+1].point;ft.orient(b,t,N)!==0&&(e.push(b),t=b)}if(e.length===1)return null;const i=e[0],n=e[1];ft.orient(i,t,n)===0&&e.shift(),e.push(e[0]);const r=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:e.length-1,h=this.isExteriorRing()?e.length:-1,g=[];for(let E=c;E!=h;E+=r)g.push([e[E].x.toNumber(),e[E].y.toNumber()]);return g}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var n,r;let t=this.events[0];for(let c=1,h=this.events.length;c<h;c++){const g=this.events[c];Q.compare(t,g)>0&&(t=g)}let e=t.segment.prevInResult(),i=e?e.prevInResult():null;for(;;){if(!e)return null;if(!i)return e.ringOut;if(i.ringOut!==e.ringOut)return((n=i.ringOut)==null?void 0:n.enclosingRing())!==e.ringOut?e.ringOut:(r=e.ringOut)==null?void 0:r.enclosingRing();e=i.prevInResult(),i=e?e.prevInResult():null}}}class ae{constructor(t){T(this,"exteriorRing");T(this,"interiorRings");this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=this.exteriorRing.getGeom();if(t===null)return null;const e=[t];for(let i=0,n=this.interiorRings.length;i<n;i++){const r=this.interiorRings[i].getGeom();r!==null&&e.push(r)}return e}}class Ye{constructor(t){T(this,"rings");T(this,"polys");this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,i=this.polys.length;e<i;e++){const n=this.polys[e].getGeom();n!==null&&t.push(n)}return t}_composePolys(t){var i;const e=[];for(let n=0,r=t.length;n<r;n++){const c=t[n];if(!c.poly)if(c.isExteriorRing())e.push(new ae(c));else{const h=c.enclosingRing();h!=null&&h.poly||e.push(new ae(h)),(i=h==null?void 0:h.poly)==null||i.addInterior(c)}}return e}}class Ke{constructor(t,e=pt.compare){T(this,"queue");T(this,"tree");T(this,"segments");this.queue=t,this.tree=new xt(e),this.segments=[]}process(t){const e=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),i;t.isLeft&&this.tree.add(e);let n=e,r=e;do n=this.tree.lastBefore(n);while(n!=null&&n.consumedBy!=null);do r=this.tree.firstAfter(r);while(r!=null&&r.consumedBy!=null);if(t.isLeft){let c=null;if(n){const g=n.getIntersection(e);if(g!==null&&(e.isAnEndpoint(g)||(c=g),!n.isAnEndpoint(g))){const E=this._splitSafely(n,g);for(let S=0,b=E.length;S<b;S++)i.push(E[S])}}let h=null;if(r){const g=r.getIntersection(e);if(g!==null&&(e.isAnEndpoint(g)||(h=g),!r.isAnEndpoint(g))){const E=this._splitSafely(r,g);for(let S=0,b=E.length;S<b;S++)i.push(E[S])}}if(c!==null||h!==null){let g=null;c===null?g=h:h===null?g=c:g=Q.comparePoints(c,h)<=0?c:h,this.queue.delete(e.rightSE),i.push(e.rightSE);const E=e.split(g);for(let S=0,b=E.length;S<b;S++)i.push(E[S])}i.length>0?(this.tree.delete(e),i.push(t)):(this.segments.push(e),e.prev=n)}else{if(n&&r){const c=n.getIntersection(r);if(c!==null){if(!n.isAnEndpoint(c)){const h=this._splitSafely(n,c);for(let g=0,E=h.length;g<E;g++)i.push(h[g])}if(!r.isAnEndpoint(c)){const h=this._splitSafely(r,c);for(let g=0,E=h.length;g<E;g++)i.push(h[g])}}}this.tree.delete(e)}return i}_splitSafely(t,e){this.tree.delete(t);const i=t.rightSE;this.queue.delete(i);const n=t.split(e);return n.push(i),t.consumedBy===void 0&&this.tree.add(t),n}}class Ve{constructor(){T(this,"type");T(this,"numMultiPolys")}run(t,e,i){bt.type=t;const n=[new ce(e,!0)];for(let S=0,b=i.length;S<b;S++)n.push(new ce(i[S],!1));if(bt.numMultiPolys=n.length,bt.type==="difference"){const S=n[0];let b=1;for(;b<n.length;)Jt(n[b].bbox,S.bbox)!==null?b++:n.splice(b,1)}if(bt.type==="intersection")for(let S=0,b=n.length;S<b;S++){const N=n[S];for(let A=S+1,k=n.length;A<k;A++)if(Jt(N.bbox,n[A].bbox)===null)return[]}const r=new xt(Q.compare);for(let S=0,b=n.length;S<b;S++){const N=n[S].getSweepEvents();for(let A=0,k=N.length;A<k;A++)r.add(N[A])}const c=new Ke(r);let h=null;for(r.size!=0&&(h=r.first(),r.delete(h));h;){const S=c.process(h);for(let b=0,N=S.length;b<N;b++){const A=S[b];A.consumedBy===void 0&&r.add(A)}r.size!=0?(h=r.first(),r.delete(h)):h=null}ft.reset();const g=Bt.factory(c.segments);return new Ye(g).getGeom()}}const bt=new Ve,Gt=bt,Te=(o,...t)=>Gt.run("union",o,t),He=(o,...t)=>Gt.run("difference",o,t),Je=ft.set,pe=({x:o,y:t},e=Math.hypot(o,t))=>({x:o/e,y:t/e}),ee=(o,t)=>({x:o.x+t.x,y:o.y+t.y}),Pt=(o,t)=>({x:o.x-t.x,y:o.y-t.y}),ie=(o,t)=>({x:o.x*t,y:o.y*t}),Yt=({x:o,y:t})=>({x:t,y:-o}),de=({x:o,y:t})=>({x:-o,y:-t}),Kt=({x:o,y:t},e,i)=>{const n=Math.sin(i),r=Math.cos(i),c=o-e.x,h=t-e.y,g=c*r-h*n,E=c*n+h*r;return{x:g+e.x,y:E+e.y}},ge=(o,t)=>o.x*t.x+o.y*t.y,je=(o,t,e)=>ee(o,ie(Pt(t,o),e)),ye=(o,t,e)=>ee(o,ie(t,e)),Oe=(o,t,e)=>o<t?t:o>e?e:o;class Ze{constructor(){this._observers=new Map}on(t,e){let i=this._observers.get(t);return i===void 0&&this._observers.set(t,i=new Set),i.add(e),this.off.bind(this,t,e)}off(t,e){let i=this._observers.get(t);i!==void 0&&(i.delete(e),i.size==0&&this._observers.delete(t))}emit(t,...e){let i=this._observers.get(t);i&&i.forEach(n=>this._invoke(n,e))}_invoke(t,e){try{t(...e)}catch(i){console.error(i)}}dispose(){this._observers.clear()}}class ne extends Ze{constructor(t=!1,e=!0,i=!0){super(),this.paused=t,this.gesture=e,this.pressure=i,this._map=new Map,this._onpointerdown=r=>{if(this.paused)return;let c=r.pointerId;this._map.has(c)&&this.emit("cancel",c),this._map.set(c,r),r.preventDefault(),r.stopPropagation(),this._dom.setPointerCapture(c);let h=this._rect=this._dom.getBoundingClientRect();if(this._mapGesture(r)&&this._map.size>1){let g=this._pinch=new We(this);this._map.forEach((E,S)=>{g.has(S)||(c!=S&&this.emit("cancel",S),g.add(E))})}else this.emit("open",c,{x:r.clientX-h.left,y:r.clientY-h.top,r:this._mapPressure(r.pressure)})},this._onpointermove=r=>{if(this.paused)return;let c=r.pointerId;if(r.preventDefault(),r.stopPropagation(),this._map.has(c)){let h=this._map.get(c);if(h.clientX==r.clientX&&h.clientY==r.clientY)return;if(this._map.set(c,r),this._pinch)this._pinch.move(r);else{let g;r.pointerType=="mouse"&&r.pressure==0&&(g=this._mapPressure(.5));let{left:E,top:S}=this._rect;if(r.getCoalescedEvents)for(let b of r.getCoalescedEvents())this.emit("update",c,{x:b.clientX-E,y:b.clientY-S,r:g??this._mapPressure(r.pressure)});else this.emit("update",c,{x:r.clientX-E,y:r.clientY-S,r:g??this._mapPressure(r.pressure)})}}},this._onpointerup=r=>{var h;if(this.paused)return;let c=r.pointerId;if(r.preventDefault(),r.stopPropagation(),this._map.has(c)){if(this._pinch)this._pinch.delete(c),this._pinch.empty&&(this._pinch=null);else{let{left:g,top:E}=this._rect;if(r.getPredictedEvents){let S=(h=this._map.get(c))==null?void 0:h.getPredictedEvents()[0];S&&this.emit("update",c,{x:S.clientX-g,y:S.clientY-E,r:this._mapPressure(S.pressure)})}this.emit("close",c)}this._map.delete(c)}},this._onpointercancel=r=>{if(this.paused)return;let c=r.pointerId;r.preventDefault(),r.stopPropagation(),this._map.delete(c),this._pinch?(this._pinch.delete(c),this._pinch.empty&&(this._pinch=null)):this.emit("cancel",c)},this._onwheel=r=>{if(this.paused)return;r.preventDefault(),r.stopPropagation();let{deltaX:c,deltaY:h}=r,g=Math.hypot(c,h),E=0,S=0;this._browser.windows&&(g=-g),c+h<0&&(g=-g),this._browser.mac&&r.ctrlKey?g=-g*.5:this._browser.mac&&(r.wheelDelta%120!=0||r.movementX!=0||r.deltaX!=0)||this._browser.windows&&!r.ctrlKey?(E=-c,S=-h,g=0):g*=.035,g=Math.max(g,-40)*.02;let{left:b,top:N}=this._rect;this.emit("wheel",{x:r.clientX-b,y:r.clientY-N,deltaX:E,deltaY:S,deltaScale:g})};const n=typeof navigator<"u"?navigator:{platform:""};this._browser={mac:/Mac/.test(n.platform),windows:/Win/.test(n.platform)}}get dom(){return this._dom}set dom(t){this._dom!=t&&(this._dom=t,this._listen(this._dom,{pointerdown:this._onpointerdown,pointermove:this._onpointermove,pointerup:this._onpointerup,pointerout:this._onpointerup,pointercancel:this._onpointercancel,wheel:this._onwheel}),this._dom&&(this._rect=this._dom.getBoundingClientRect()))}pause(){this.paused=!0}resume(){this.paused=!1}_listen(t,e){if(this._unlistenDOM&&(this._unlistenDOM(),this._unlistenDOM=void 0),t){for(let i in e)t.addEventListener(i,e[i]);this._unlistenDOM=()=>{for(let i in e)t.removeEventListener(i,e[i])}}}_mapPressure(t){return this.pressure===!0?t:Oe(this.pressure||.5,0,1)}_mapGesture(t){return this.gesture===!0||this.gesture&&t.pointerType=="touch"}dispose(){this._unlistenDOM&&(this._unlistenDOM(),this._unlistenDOM=void 0),super.dispose()}static create(t={}){let e=new ne(t.paused,t.gesture,t.pressure);return e.dom=t.dom,e}}class We{constructor(t){this.input=t,this.points=new Map,this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.scale=1,this.ox=0,this.oy=0,this.rate=1,this.initialized=!1,this.size=0}get empty(){return this.points.size==0}has(t){return this.points.has(t)}add(t){this.points.set(t.pointerId,t),this.update()}move(t){this.points.set(t.pointerId,t),this.update()}delete(t){this.points.delete(t),this.update()}update(){let t=this.desc(),e=1;this.size==0&&this.points.size==1?e=0:this.size>0&&this.points.size==0&&(e=2),this.initialized?(this.size!==this.points.size&&(this.ox=this.x1-t.x,this.oy=this.y1-t.y,this.rate=this.scale/t.d,this.size=this.points.size),this.x1=t.x+this.ox,this.y1=t.y+this.oy,this.scale=t.d*this.rate):(this.ox=this.oy=0,this.rate=1/t.d,this.x1=this.x0=t.x,this.y1=this.y0=t.y,this.scale=1,this.size=this.points.size,this.initialized=!0),this.input.emit("pinch",{phase:e,x:this.x0,y:this.y0,deltaX:this.x0-this.x1/this.scale,deltaY:this.y0-this.y1/this.scale,deltaScale:this.scale})}desc(){let t=0,e=0,i=0;for(let n of this.points.values())t+=n.clientX,e+=n.clientY;this.points.size>0&&(t/=this.points.size,e/=this.points.size);for(let n of this.points.values())i+=Math.hypot(n.clientX-t,n.clientY-e);return{x:t,y:e,d:i||1}}}class yt{constructor(t,e,i,n,r){this.p=t,this.r=e,this.v=i,this.d=n,this.l=r}toJSON(){return[this.p.x,this.p.y,this.r]}dup(t=this.r){return new yt(this.p,t,this.v,this.d,this.l)}}class qt{constructor(t,e=t.length>0?t[t.length-1].l:0){this.points=t,this.length=e,this.sections=[0],this.pending={__proto__:null},this.queue=[],this.updateSections()}get empty(){return this.points.length==0}get dot(){return this.points.length==1}insert(t,e){if(t==this.points.length)e.forEach(i=>this.push(i,!0)),t=this.points.length,(e=this.pending[t])?(delete this.pending[t],this.insert(t,e)):this.updateSections();else if(t>this.points.length)this.pending[t]&&console.warn(`Override pending points from ${t}`),this.pending[t]=e;else throw new RangeError(`Position ${t} conflicts with existing points`)}push(t,e=!1){let{points:i}=this;if(i.length>0){let n,r=i[i.length-1];n=t;let c=r.p,h=Math.hypot(n.x-c.x,n.y-c.y);if(this.updateLength(h),this.length-r.l<4){r.r=Math.max(r.r,n.r);return}i.push(new yt(n,n.r,pe(Pt(c,n)),h,this.length)),e||this.updateSections()}else i.push(new yt(t,t.r,{x:1,y:1},0,0))}outline(t,e){let i=this.sections.find(r=>t<r),n=this.points.slice(t>0?t-1:t,i);if(n.length>1){let r=[],c=[],h=n.length,g=e,E=n[0].r,S=!0;if(i==null&&h>=2){let A=n[h-2];if((A.r==.5||A.r==1)&&A.d>.4*e){n[h-1]=n[h-1].dup(.05),n[h-2]=A.dup(Math.max(.1,A.r-.3));let k=h>=3?n[h-3]:null;k&&(n[h-3]=k.dup(Math.max(.1,k.r-.1))),S=!1}}for(let A=0;A<h;A++){let{p:k,r:U,v:C,d:nt}=n[A];A==0&&(nt=0,C=n[1].v);let _=Math.min(1,nt/e),Et=Math.min(1,1-_),At=Math.min(1,E+(Et-E)*(_*.3)),gt=(A<h-1?n[A+1]:n[A]).v,K=A<h-1?ge(C,gt):1;g=Oe(e*.5*At,.75,e/2);let H=ie(Yt(je(gt,C,K)),g),s=Pt(k,H);r.push(s);let l=ee(k,H);c.push(l),E=U}let b=[],N=[];for(let A=1/13,k=A;k<=1;k+=A)b.push(Kt(c[0],n[0].p,3.1416926535897933*k));if(S){let A=n[h-1],k=Yt(de(A.v)),U=ye(A.p,k,g);for(let C=1/13,nt=C;nt<1;nt+=C)N.push(Kt(U,A.p,3.1416926535897933*nt))}return r.concat(N,c.reverse(),b)}else if(n.length==1){let r=n[0],c=Yt(de(r.v)),h=ye(r.p,c,e*.36*r.r),g=[];for(let E=1/13,S=0;S<=2;S+=E)g.push(Kt(h,r.p,3.1416926535897933*S));return g}else return[]}updateLength(t){this.length+=t}updateSections(){let{sections:t}=this;for(let e=t.length>1?t[t.length-1]+1:2,i=this.points.length;e<i;e++)this.points[e].d<1e3&&ge(this.points[e].v,this.points[e-1].v)<0&&(t.push(e),e+=1)}updateCurr(t,e){for(this.queue.push(t);this.queue.length>e;)this.queue.shift();let i=0,n=0;for(let r of this.queue)i+=r.x,n+=r.y;return e=this.queue.length,{x:i/e,y:n/e,r:t.r}}toJSON(){return this.points.map(t=>t.toJSON())}static fromJSON(t){if(!t||!Array.isArray(t))throw new RangeError("Invalid JSON representation for Stroke");return qt.create(t.map(e=>({x:e[0],y:e[1],r:e[2]})))}static create(t=[]){let e=[],i=0;if(t.length>0){let n=t[0],r=0;e.push(new yt(n,n.r,{x:1,y:1},0,0));for(let c=1;c<t.length;c++){let h=t[c],g=Math.hypot(h.x-n.x,h.y-n.y);if(r+=g,r-i<4){e[e.length-1].r=h.r;continue}e.push(new yt(h,h.r,pe(Pt(n,h)),g,r)),n=h,i=r}i=r}return new qt(e,i)}}Je(1e-12);let Qe=document.getElementById("app"),ot=document.createElementNS("http://www.w3.org/2000/svg","svg"),D=document.createElementNS("http://www.w3.org/2000/svg","g"),Ie=document.createElementNS("http://www.w3.org/2000/svg","defs"),G={size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),outline:document.getElementById("outline"),pressure:document.getElementById("pressure"),eraser:document.getElementById("eraser"),data:document.getElementById("data")},Lt=document.getElementById("log");function Ae(...o){Lt.append(o.map(jt).join(" ")+`
`),Lt.childNodes.length>20&&Lt.removeChild(Lt.firstChild)}function jt(o){if(typeof o=="object"){if(typeof o=="function")return"Fn()";if(Array.isArray(o)){let t="[",e=!1;for(let i of o)t+=" "+jt(i)+",",e=!0;return t=e?t.slice(0,-1)+" ]":t+"]",t}else{let t="{",e=!1;for(let i in o)t+=" "+i+": "+jt(o[i])+",",e=!0;return t=e?t.slice(0,-1)+" }":t+"}",t}}else return typeof o=="number"?o.toFixed(1):""+o}window.onerror=function(t){Ae(t)};let ti=console.log;console.log=function(){return Ae.apply(this,arguments),ti.apply(this,arguments)};let zt=0,Zt=0,Ne=0;function ei(o){try{Zt=JSON.stringify(o.toJSON()).length,Ne+=Zt}catch(t){console.error(t)}}function Wt(){G.data.textContent=`${zt.toFixed(1)}ms, ${me(Zt)} (Total: ${me(Ne)})`}function me(o){return o<1024?o+" B":(o/1024).toFixed(1)+" kB"}let wt={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(o,t){for(this.stack[this.index]={undo:o,redo:t},this.index+=1;this.stack.length>20;)this.stack.shift(),this.index-=1;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index-=1,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index+=1,this.update())},update(){G.undo.disabled=!this.undoable,G.redo.disabled=!this.redoable}};function It(){return G.eraser.checked}let Tt=document.createElementNS("http://www.w3.org/2000/svg","mask");G.eraser.oninput=()=>{It()?(Ie.append(Tt),G.pressure.disabled=!0):(Tt.remove(),G.pressure.disabled=!1)};Tt.setAttribute("id","eraser");let at=document.createElementNS("http://www.w3.org/2000/svg","rect");at.setAttribute("width","100%");at.setAttribute("height","100%");at.setAttribute("fill","white");Tt.append(at);D.setAttribute("mask","url(#eraser)");ot.append(Ie);ot.append(D);Qe.append(ot);G.clear.onclick=()=>{let o=Array.from(D.children);D.textContent="",wt.commit(()=>D.append(...o),()=>D.textContent="")};G.undo.onclick=()=>wt.undo();G.redo.onclick=()=>wt.redo();D.setAttribute("fill","currentColor");G.outline.oninput=()=>{G.outline.checked?(D.setAttribute("fill","none"),D.setAttribute("stroke","currentColor"),D.setAttribute("stroke-width","1")):D.setAttribute("fill","currentColor")};ot.setAttribute("fill-rule","nonzero");ot.style.cssText=`display: block; width: 100%; height: 100%;
font-size: 0; touch-action: none; position: relative; contain: content;
overflow: hidden; overscroll-behavior: none;`;let et={__proto__:null},Ot={__proto__:null},lt=ne.create({dom:ot,gesture:!1}),tt;G.pressure.oninput=()=>{lt.pressure=G.pressure.checked};let ht={x:0,y:0,scale:1};D.style.transformOrigin="0 0";function ii(){let{x:o,y:t,scale:e}=ht;D.style.transform=`scale(${e}) translate(${o}px, ${t}px)`,at.setAttribute("x",""+-ht.x),at.setAttribute("y",""+-ht.y),at.setAttribute("width",""+lt._rect.width/e),at.setAttribute("height",""+lt._rect.height/e)}function Qt(o){return{x:o.x/ht.scale-ht.x,y:o.y/ht.scale-ht.y,r:o.r}}lt.on("wheel",o=>{let{x:t,y:e,scale:i}=ht;if(o.deltaScale!=0){let n=1+o.deltaScale,r=(1-1/n)/i;t-=r*o.x,e-=r*o.y,i*=n}t+=o.deltaX/i,e+=o.deltaY/i,ht={x:t,y:e,scale:i},ii()});lt.on("open",(o,t)=>{let e=qt.create([Qt(t)]),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.style.pointerEvents="none",It()?(i.setAttribute("fill","black"),Tt.append(i),tt&&tt.$path.remove(),tt={stroke:e,$path:i}):(et[o]=[e,i],Ot[o]=!0,D.append(i),re())});lt.on("update",(o,t)=>{if(It()&&tt){let e=G.size.valueAsNumber*2,{stroke:i,$path:n}=tt,r="",c=[];i.push(Qt(t));for(let h of i.sections){let g=i.outline(h,e);r+=oe(g),c.push(g)}n[se]=c,n.setAttribute("d",r)}else if(et[o]){let[e]=et[o];e.push(Qt(t)),Ot[o]=!0,re()}});lt.on("cancel",o=>{It()&&tt?tt.$path.remove():et[o]&&(et[o][1].remove(),delete et[o])});lt.on("close",o=>{if(It()&&tt){let t=performance.now();try{ri(tt)}catch(e){console.error(e),alert("Failed to erase: "+e)}finally{tt.$path.remove()}tt=void 0,zt=performance.now()-t,Wt()}if(et[o]){let[t,e]=et[o],i=!0;t.empty&&(e.remove(),i=!1),re(),ei(t),Wt(),console.info(t),delete et[o],i&&wt.commit(()=>e.remove(),()=>D.append(e))}});ot.ontouchstart=ot.ontouchmove=ot.ontouchend=ot.ontouchcancel=o=>{o.preventDefault(),o.stopPropagation()};document.onkeydown=o=>{let t=o.ctrlKey,e=o.shiftKey,i=o.metaKey,n=o.altKey,r=o.keyCode,c=lt._browser.mac?i:t;const h=g=>{o.preventDefault(),g.focus(),g.click()};!t&&!e&&!i&&!n?(r==79&&h(G.outline),r==80&&(G.pressure.disabled?h(G.eraser):h(G.pressure)),r==69&&h(G.eraser)):c&&!e&&r==90?h(G.undo):c&&e&&r==90&&h(G.redo)};const xe=(o,t)=>({x:(o.x+t.x)/2,y:(o.y+t.y)/2}),ni=({x:o,y:t})=>`M${o.toFixed(2)},${t.toFixed(2)}`,we=({x:o,y:t})=>`L${o.toFixed(2)},${t.toFixed(2)}`,si=(o,{x:t,y:e})=>`Q${o.x.toFixed(2)},${o.y.toFixed(2)} ${t.toFixed(2)},${e.toFixed(2)}`,se="_outlines",te="_poly";function re(){let o=G.size.valueAsNumber,t=performance.now(),e=!1;for(let i in Ot){if(et[i]){let[n,r]=et[i],c="",h=[];for(let g of n.sections){let E=n.outline(g,o);c+=oe(E),h.push(E)}r[se]=h,r.setAttribute("d",c)}delete Ot[i],e=!0}e&&(zt=performance.now()-t)}function oe(o){if(o.length==0)return"";let t=o.shift(),e=ni(t),i=1;for(let n of o)i&&(e+=we(xe(t,n))),e+=si(t,xe(t,n)),i=0,t=n;return e+we(o[o.length-1])}function Ee(o){if(o[te])return o[te];let t=o[se]||[],e=[];for(let i of t)e=Te(e,[i.map(n=>[n.x,n.y])]);return e}function ri({$path:o}){let t=performance.now(),e=Array.from(D.children),i=[];i=Te(i,...e.map(Ee));let n=Ee(o),r=He(i,n),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.style.pointerEvents="none";let h="";for(let g of r)for(let E of g){let S=E.map(b=>({x:b[0],y:b[1]}));h+=oe(S)}c[te]=r,c.setAttribute("d",h),D.textContent="",D.append(c),wt.commit(()=>{D.textContent="",D.append(...e)},()=>{D.textContent="",D.append(c)}),zt=performance.now()-t,Wt()}Object.assign(window,{debug:{undoStack:wt,strokes:et,dirty:Ot,input:lt,eraser:()=>tt}});
//# sourceMappingURL=index-oxxIdz15.js.map
