const A=(i,t,e)=>i<t?t:i>e?e:i;class o{constructor(t,e){this.x=t,this.y=e}static of(t,e){return new o(t,e)}static from(t){return new o(t.x,t.y)}add(t){return new o(this.x+t.x,this.y+t.y)}subtract(t){return new o(this.x-t.x,this.y-t.y)}multiply(t){return new o(this.x*t,this.y*t)}normalize(t=Math.hypot(this.x,this.y)){return new o(this.x/t,this.y/t)}permutate(){return new o(-this.y,this.x)}negative(){return new o(-this.x,-this.y)}middle(t){return new o((this.x+t.x)/2,(this.y+t.y)/2)}rotate(t,e){const s=Math.sin(e),n=Math.cos(e),r=this.x-t.x,h=this.y-t.y,u=r*n-h*s,l=r*s+h*n;return new o(u+t.x,l+t.y)}dot(t){return this.x*t.x+this.y*t.y}lerp(t,e){return new o(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}project(t,e){return new o(this.x+t.x*e,this.y+t.y*e)}}class G{constructor(){this.value=-1,this.last=-1,this.target=-1}set(t){return this.target=t,this.value<0&&(this.value=t,this.last=t),this}update(t){if(t||(t=.016667),this.value>=0&&this.target>=0&&this.last>=0){let s=this.target-this.value,n=(this.value-this.last)/t,r=.7*s,h=.5*n,u=r-h,l=(n+u)*t;this.last=this.value,Math.abs(l)<.01&&Math.abs(s)<.01?this.value=this.target:this.value+=l}return this.value}}class g{constructor(t,e,s,n){this.x=t,this.y=e,this.p=s,this.t=n}static of(t,e,s,n){return new g(t,e,s,n)}static fromEvent(t,e=A(t.pressure||.5,0,1)){return new g(t.clientX,t.clientY,e,t.timeStamp)}static fromJSON(t){return new g(t.x,t.y,t.p,t.t)}}class E{constructor(t,e,s,n){this.p=t,this.v=e,this.d=s,this.l=n}static of(t,e,s,n){return new E(t,e,s,n)}static fromJSON(t){return new E(g.fromJSON(t.p),o.from(t.v),t.d,t.l)}}function H(i,t){return t-i.p.t>300?Math.min(i.p.p+.12,1):Math.min(i.p.p+.12*(t-i.p.t)/300,1)}function W(i,t,e){return e-t>300?Math.min(i+.12,1):Math.min(i+.12*(e-t)/300,1)}class S{constructor(t,e=t.length>0?t[t.length-1].l:0){this.points=t,this.length=e,this.segments=[0],this.pending={__proto__:null}}static of(t=[]){let e=new S([],0);for(let s of t)e._push(s);return e._updateSegments(),e}static fromJSON(t){let e=new S(t.points.map(E.fromJSON),t.length);return e.segments=t.segments,e.pending=t.pending,e}get empty(){return this.length==0}get dot(){return this.points.length==1}insert(t,e){if(t==this.points.length){for(let s of e)this._push(s);t=this.points.length,(e=this.pending[t])?(delete this.pending[t],this.insert(t,e)):this._updateSegments()}else if(t>this.points.length)this.pending[t]=e;else throw new RangeError(`Position ${t} conflicts with existing points`);return this}push(t){return this._push(t),this._updateSegments(),this}_push(t){let e=this.points;if(e.length>0){let s=e[e.length-1],n=Math.hypot(t.x-s.p.x,t.y-s.p.y);if(this._updateLength(n),this.length-s.l<4){s.p.p=Math.max(s.p.p,t.p);return}e.push(E.of(t,o.from(t).subtract(s.p).normalize(),n,this.length))}else e.push(E.of(t,o.of(0,0),0,0))}isSpreading(t=performance.now()){return this.points.length>0&&t-this.points[this.points.length-1].p.t<300}outline(t,e,s=performance.now()){let n=this.segments.find(h=>t<h),r=this.points.slice(t>0?t-1:t,n);if(r.length>1){let h=[],u=[],l=r.length,y=e,v=r[0].p.p,I=!0,N=0,T=new G;if(n==null&&l>=2){let p=r[l-2];(p.p.p==.5||p.p.p==1)&&p.d>.4*e&&(I=!1)}for(let p=0;p<l;p++){let{p:c,v:M,d:$}=r[p];p==0&&($=0,M=r[1].v);let k=Math.min(1,$/e),Y=Math.min(1,1-k),x=Math.min(1,v+(Y-v)*(k*.7)),O=(p<l-1?r[p+1]:r[p]).v,q=p<l-1?M.dot(O):1;x=T.set(x).update(N&&(c.t-N)/1e3),I||(p==l-1&&(x=.05),p==l-2&&(x=Math.max(.1,x-.2)),p==l-3&&(x=Math.max(.1,x-.1))),y=A(e*.5*W(x,c.t,s),.75,e/2);let J=O.lerp(M,q).permutate().multiply(y),Q=o.from(c).subtract(J),U=o.from(c).add(J);h.push(Q),u.push(U),N=c.t,v=c.p}let D=[],X=u[0],B=[];for(let p=1/13,c=0;c<=1;c+=p)D.push(X.rotate(r[0].p,3.1416926535897933*c));if(I){let p=r[l-1],c=p.v.negative().permutate(),M=o.from(p.p).project(c,y);for(let $=1/13,k=0;k<1;k+=$)B.push(M.rotate(p.p,3.1416926535897933*k))}return h.concat(B,u.reverse(),D)}else if(r.length==1){let h=r[0],u=o.from(h.p).project(o.of(1,0),e*.36*H(h,s)),l=[];for(let y=1/13,v=0;v<=2;v+=y)l.push(u.rotate(h.p,3.1416926535897933*v));return l}else return[]}stroke(t=this.points.map(e=>e.p)){let e=t.length;if(e==0)return"";let s=t[0],n=`M${s.x.toFixed(2)},${s.y.toFixed(2)}`;for(let r=1;r<e;r++){let h=t[r],u=o.from(s).middle(h);r==1?n+=`L${u.x.toFixed(2)},${u.y.toFixed(2)}`:n+=`Q${s.x.toFixed(2)},${s.y.toFixed(2)} ${u.x.toFixed(2)},${u.y.toFixed(2)}`,s=h}return e>1&&(n+=`L${s.x.toFixed(2)},${s.y.toFixed(2)}`),n}_updateLength(t){this.length+=t}_updateSegments(){let t=this.segments,e=this.points,s=e.length;for(let n=t[t.length-1]+1;n<s;n++)e[n].v.dot(e[n-1].v)<0&&(t.push(n),n++)}}let Z=document.getElementById("app"),a=Z.appendChild(document.createElementNS("http://www.w3.org/2000/svg","svg")),d={size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),pressure:document.getElementById("pressure")};a.setAttribute("fill-rule","nonzero");a.setAttribute("fill","currentColor");a.style.cssText=`display: block; width: 100%; height: 100%;
font-size: 0; touch-action: none; position: relative; contain: content;
overflow: hidden; overscroll-behavior: none;`;d.clear.onclick=()=>{let i=Array.from(a.children);a.textContent="",C.commit(()=>a.append(...i),()=>a.textContent="")};d.undo.onclick=()=>C.undo();d.redo.onclick=()=>C.redo();let b;d.pressure.oninput=()=>{b=d.pressure.checked?void 0:.5};let m=new Map;a.onpointerdown=i=>{let t=i.pointerId;m.has(t)&&L(t),m.set(t,i),i.preventDefault(),i.stopPropagation(),a.setPointerCapture(t),R(t,g.fromEvent(i,b))};a.onpointermove=i=>{let t=i.pointerId;if(i.preventDefault(),i.stopPropagation(),m.has(t)){let e=m.get(t);if(e.clientX===i.clientX&&e.clientY===i.clientY)return;if(m.set(t,i),i.getCoalescedEvents)for(let s of i.getCoalescedEvents())P(t,g.fromEvent(s,b));else P(t,g.fromEvent(i,b))}};a.onpointerup=a.onpointerout=i=>{let t=i.pointerId;if(i.preventDefault(),i.stopPropagation(),m.has(t)){if(i.getPredictedEvents){let e=m.get(t).getPredictedEvents()[0];e&&P(t,g.fromEvent(e,b))}_(t),m.delete(t)}};a.onpointercancel=i=>{let t=i.pointerId;i.preventDefault(),i.stopPropagation(),m.has(t)&&(L(t),m.delete(t))};a.ontouchstart=a.ontouchmove=a.ontouchend=a.ontouchcancel=i=>{i.preventDefault(),i.stopPropagation()};let C={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(i,t){for(this.stack[this.index]={undo:i,redo:t},this.index++;this.stack.length>20;)this.stack.shift(),this.index--;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index--,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index++,this.update())},update(){d.undo.disabled=!this.undoable,d.redo.disabled=!this.redoable}},f={},w={},R=(i,t)=>{let e=S.of([t]),s=a.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path"));s.style.pointerEvents="none",f[i]=[e,s],w[i]=!0,F()},P=(i,t)=>{f[i]&&(f[i][0].push(t),w[i]=!0,F(),z())},L=i=>{f[i]&&(f[i][1].remove(),delete f[i],delete w[i])},_=i=>{if(f[i]){let[t,e]=f[i],s=!0;t.empty&&!t.dot&&(e.remove(),s=!1),F(),delete w[i],z(),s&&C.commit(()=>e.remove(),()=>a.append(e))}},F=()=>{let i=d.size.valueAsNumber;for(let t in w){if(f[t]){let[e,s]=f[t],n="";for(let r of e.segments){let h=e.outline(r,i);n+=e.stroke(h)}s.setAttribute("d",n)}delete w[t]}},K=0,z=()=>{cancelAnimationFrame(K),K=requestAnimationFrame(j)},j=()=>{F();let i=!1;for(let t in f)f[t][0].isSpreading()&&(w[t]=!0,i=!0);i&&z()},V=/Mac/.test(navigator.platform);document.onkeydown=i=>{let t=i.ctrlKey,e=i.shiftKey,s=i.metaKey,n=i.altKey,r=i.keyCode,h=V?s:t;const u=l=>{i.preventDefault(),l.focus(),l.click()};if(!t&&!e&&!s&&!n){if(r==80&&u(d.pressure),r==219||r==221){let l=d.size.valueAsNumber,y=r==221?5:-5;d.size.value=""+A(l+y,+d.size.min,+d.size.max)}}else h&&!e&&r==90?u(d.undo):h&&e&&r==90&&u(d.redo)};
//# sourceMappingURL=index-BlrXi-Ne.js.map
