const L=(e,t,i)=>e<t?t:e>i?i:e;class u{constructor(t,i){this.x=t,this.y=i}static of(t,i){return new u(t,i)}static from(t){return new u(t.x,t.y)}add(t){return new u(this.x+t.x,this.y+t.y)}subtract(t){return new u(this.x-t.x,this.y-t.y)}multiply(t){return new u(this.x*t,this.y*t)}normalize(t=Math.hypot(this.x,this.y)){return new u(this.x/t,this.y/t)}permutate(){return new u(-this.y,this.x)}negative(){return new u(-this.x,-this.y)}middle(t){return new u((this.x+t.x)/2,(this.y+t.y)/2)}rotate(t,i){const s=Math.sin(i),r=Math.cos(i),o=this.x-t.x,l=this.y-t.y,a=o*r-l*s,c=o*s+l*r;return new u(a+t.x,c+t.y)}dot(t){return this.x*t.x+this.y*t.y}lerp(t,i){return new u(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i)}project(t,i){return new u(this.x+t.x*i,this.y+t.y*i)}}class nt{constructor(t=.36){this.value=this.last=this.target=t}set(t){return this.target=t,this}update(t){if(t||(t=.016667),this.value>=0&&this.target>=0&&this.last>=0){let s=this.target-this.value,r=(this.value-this.last)/t,o=2*s,l=.1*r,a=o-l,c=(r+a)*t;this.last=this.value,Math.abs(c)<.01&&Math.abs(s)<.01?this.value=this.target:this.value+=c}return this.value}}class v{constructor(t,i,s,r){this.x=t,this.y=i,this.p=s,this.t=r}static of(t,i,s,r){return new v(t,i,s,r)}static fromEvent(t,i=L(t.pressure||.5,0,1)){return new v(t.clientX,t.clientY,i,t.timeStamp)}static fromJSON(t){return new v(t.x,t.y,t.p,t.t)}}class I{constructor(t,i,s,r){this.p=t,this.v=i,this.d=s,this.l=r}static of(t,i,s,r){return new I(t,i,s,r)}static fromJSON(t){return new I(v.fromJSON(t.p),u.from(t.v),t.d,t.l)}}function rt(e,t){return t-e.p.t>60?Math.min(e.p.p+.05,1):Math.min(e.p.p+.05*(t-e.p.t)/60,1)}function ot(e,t,i){return i-t>60?Math.min(e+.05,1):Math.min(e+.05*(i-t)/60,1)}class D{constructor(t,i=t.length>0?t[t.length-1].l:0){this.points=t,this.length=i,this.segments=[0],this.pending={__proto__:null}}static of(t=[]){let i=new D([],0);for(let s of t)i._push(s);return i._updateSegments(),i}static fromJSON(t){let i=new D(t.points.map(I.fromJSON),t.length);return i.segments=t.segments,i.pending=t.pending,i}get empty(){return this.length==0}get dot(){return this.points.length==1}insert(t,i){if(t==this.points.length){for(let s of i)this._push(s);t=this.points.length,(i=this.pending[t])?(delete this.pending[t],this.insert(t,i)):this._updateSegments()}else if(t>this.points.length)this.pending[t]=i;else throw new RangeError(`Position ${t} conflicts with existing points`);return this}push(t){return this._push(t),this._updateSegments(),this}_push(t){let i=this.points;if(i.length>0){let s=i[i.length-1],r=Math.hypot(t.x-s.p.x,t.y-s.p.y);if(this._updateLength(r),this.length-s.l<4){s.p.p=Math.max(s.p.p,t.p);return}i.push(I.of(t,u.from(t).subtract(s.p).normalize(),r,this.length))}else i.push(I.of(t,u.of(0,0),0,0))}isSpreading(t=performance.now()){return this.points.length>0&&t-this.points[this.points.length-1].p.t<60}outline(t,i,s=performance.now(),r=!0){let o=this.segments.find(a=>t<a),l=this.points.slice(t>0?t-1:t,o);if(l.length>1){let a=[],c=[],d=l.length,M=i,x=l[0].p.p,_=l[d-1].p.p,O=!0,S=-1,q=l[0].p.t,j=new nt(Math.max(x,.36/5));if(r&&o==null&&d>=2&&(x==.5||x==1||_<.36)){let p=l[d-2],f=p.d,E=p,b=0;for(let y=d-3;y>=0&&(E=l[y],f+=E.d,b=p.p.t-E.p.t,!(b<=0||b>100));y--)S=y;f>.51*i&&(O=!1,S+=Math.ceil((d-S)/3))}for(let p=0;p<d;p++){let{p:f,v:E,d:b}=l[p];p==0&&(b=0,E=l[1].v);let y=Math.min(1,b/i),tt=Math.min(1,1-y),C=Math.min(1,x+(tt-x)*(y*.5)),U=(p<d-1?l[p+1]:l[p]).v,et=p<d-1?E.dot(U):1;if(C=j.set(C).update((f.t-q)/800),!O&&p>=S){let Y=1-(d-p-1)/(d-S);C=C*(1-Y*Y)}M=L(i*.5*ot(C,f.t,s),.75,i/2);let X=U.lerp(E,et).permutate().multiply(M),it=u.from(f).subtract(X),st=u.from(f).add(X);a.push(it),c.push(st),q=f.t,x=f.p}let K=[],V=c[0],Q=[];for(let p=1/13,f=0;f<=1;f+=p)K.push(V.rotate(l[0].p,3.1416926535897933*f));if(O){let p=l[d-1],f=p.v.negative().permutate(),E=u.from(p.p).project(f,M);for(let b=1/13,y=0;y<1;y+=b)Q.push(E.rotate(p.p,3.1416926535897933*y))}return a.concat(Q,c.reverse(),K)}else if(l.length==1){let a=l[0],c=u.from(a.p).project(u.of(1,0),i*.36*rt(a,s)),d=[];for(let M=1/13,x=0;x<=2;x+=M)d.push(c.rotate(a.p,3.1416926535897933*x));return d}else return[]}stroke(t=this.points.map(i=>i.p)){let i=t.length;if(i==0)return"";let s=t[0],r=`M${s.x.toFixed(2)},${s.y.toFixed(2)}`;for(let o=1;o<i;o++){let l=t[o],a=u.from(s).middle(l);o==1?r+=`L${a.x.toFixed(2)},${a.y.toFixed(2)}`:r+=`Q${s.x.toFixed(2)},${s.y.toFixed(2)} ${a.x.toFixed(2)},${a.y.toFixed(2)}`,s=l}return i>1&&(r+=`L${s.x.toFixed(2)},${s.y.toFixed(2)}`),r}_updateLength(t){this.length+=t}_updateSegments(){let t=this.segments,i=this.points,s=i.length;for(let r=t[t.length-1]+1;r<s;r++)i[r].v.dot(i[r-1].v)<0&&(t.push(r),r++)}}let R=document.getElementById("app"),h=R.appendChild(document.createElementNS("http://www.w3.org/2000/svg","svg")),g=R.appendChild(document.createElement("div")),n={color:document.getElementById("stroke-color"),size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),pressure:document.getElementById("pressure"),tail:document.getElementById("tail"),eraser:document.getElementById("eraser"),smooth:document.getElementById("smooth")},lt=n.pressure.checked,at=n.tail.checked,ht=n.smooth.value,ut=n.size.valueAsNumber;h.setAttribute("fill-rule","nonzero");h.setAttribute("fill","currentColor");h.style.cssText=`display: block; width: 100%; height: 100%;
font-size: 0; touch-action: none; position: relative; contain: content;
overflow: hidden; overscroll-behavior: none;`;g.style.cssText=`display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
touch-action: none; contain: content; z-index: 1;`;let pt=matchMedia("(prefers-color-scheme: dark)"),H=()=>pt.matches?"#ffffff":"#000000";n.color.value=H();n.color.onchange=n.color.oninput=()=>{P()};n.size.onchange=n.size.oninput=()=>{P()};n.clear.onclick=()=>{let e=Array.from(h.children);h.textContent="",F.commit(()=>h.append(...e),()=>h.textContent="")};n.undo.onclick=()=>F.undo();n.redo.onclick=()=>F.redo();let N;n.pressure.oninput=()=>{N=n.pressure.checked?void 0:.5,P()};n.tail.oninput=()=>{P()};n.smooth.onchange=n.smooth.oninput=()=>{P()};n.eraser.oninput=()=>{let e=n.eraser.checked;g.style.cursor=e?`url(https://api.iconify.design/mdi:eraser.svg?color=${encodeURIComponent(n.color.value)}) 12 32, auto`:"default",g.style.display=e?"block":"none"};for(let e=1;e<=15;e++){let t=document.createElement("option");t.value=t.textContent=String(e),n.smooth.appendChild(t)}let P=()=>{let e="";n.color.value!==H()&&(e+=`&color=${n.color.value.slice(1)}`),n.size.valueAsNumber!==ut&&(e+=`&size=${n.size.valueAsNumber}`),n.pressure.checked!==lt&&(e+=`&pressure=${n.pressure.checked?1:0}`),n.tail.checked!==at&&(e+=`&tail=${n.tail.checked?1:0}`),n.smooth.value!==ht&&(e+=`&smooth=${n.smooth.value}`),history.replaceState({},"",e?e.replace("&","?"):location.pathname)},w=new URL(location.href).searchParams;w.has("color")&&(n.color.value="#"+w.get("color"));w.has("size")&&(n.size.value=w.get("size"));w.has("pressure")&&(n.pressure.checked=w.get("pressure")!=="0",n.pressure.dispatchEvent(new InputEvent("input")));w.has("tail")&&(n.tail.checked=w.get("tail")!=="0",n.tail.dispatchEvent(new InputEvent("input")));w.has("smooth")&&(n.smooth.value=w.get("smooth"));P();let k=new Map;h.onpointerdown=e=>{let t=e.pointerId;k.has(t)&&W(t),k.set(t,e),e.preventDefault(),e.stopPropagation(),h.setPointerCapture(t),gt(t,v.fromEvent(e,N))};h.onpointermove=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),k.has(t)){let i=k.get(t);if(i.clientX===e.clientX&&i.clientY===e.clientY)return;if(k.set(t,e),e.getCoalescedEvents)for(let s of e.getCoalescedEvents())T(t,v.fromEvent(s,N));else T(t,v.fromEvent(e,N))}};h.onpointerup=h.onpointerout=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),k.has(t)){if(e.getPredictedEvents){let i=k.get(t).getPredictedEvents()[0];i&&T(t,v.fromEvent(i,N))}vt(t),k.delete(t)}};h.onpointercancel=e=>{let t=e.pointerId;e.preventDefault(),e.stopPropagation(),k.has(t)&&(W(t),k.delete(t))};h.ontouchstart=h.ontouchmove=h.ontouchend=h.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let z;g.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),g.setPointerCapture(e.pointerId),Z(z=v.fromEvent(e))};g.onpointermove=e=>{if(z){e.preventDefault(),e.stopPropagation();let t=v.fromEvent(e);Z(t),z=t}};g.onpointerup=g.onpointerout=e=>{z=void 0};g.ontouchstart=g.ontouchmove=g.ontouchend=g.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let F={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(e,t){for(this.stack[this.index]={undo:e,redo:t},this.index++;this.stack.length>20;)this.stack.shift(),this.index--;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index--,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index++,this.update())},update(){n.undo.disabled=!this.undoable,n.redo.disabled=!this.redoable}};class ct{push(t){return this.item=t,this}dup(){if(this.item)return this}get(){return this.item}}class dt{constructor(t,i=2){this.compute=t,this.capacity=i,this.items=[],this.size=0}push(t){for(this.items.push(t),this.size++;this.size>this.capacity;)this.items.shift(),this.size--;return this}dup(){if(this.size>0)return this.push(this.items[this.items.length-1])}get(){return this.compute(this.items)}}let ft=e=>{let t=0,i=0,s=.5,r=0;for(let o of e)t+=o.x,i+=o.y,s=o.p,r=o.t;return v.of(t/e.length,i/e.length,s,r)},mt=e=>{if(n.smooth.value=="0")return new ct().push(e);{let t=Number.parseInt(n.smooth.value)+1;return new dt(ft,t).push(e)}},m={},A={},$={},gt=(e,t)=>{let i=D.of([t]),s=h.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path"));s.style.pointerEvents="none",s.style.fill=n.color.value,m[e]=[i,s],A[e]=mt(t),$[e]=!0,B()},T=(e,t)=>{m[e]&&(m[e][0].push(A[e].push(t).get()),$[e]=!0,B(),J())},W=e=>{m[e]&&(m[e][1].remove(),delete A[e],delete m[e],delete $[e])},vt=e=>{if(m[e]){let[t,i]=m[e],s=!0;t.empty&&!t.dot&&(i.remove(),s=!1),B(),delete A[e],delete $[e],J(),s&&F.commit(()=>i.remove(),()=>h.append(i))}},Z=e=>{let t=h.createSVGPoint();t.x=e.x,t.y=e.y;for(let i of h.children)i.isPointInFill(t)&&i.remove();if(z){let i=e.x-z.x,s=e.y-z.y;for(let r=0;r<1;r+=.1){let o=h.createSVGPoint();o.x=e.x-r*i,o.y=e.y-r*s;for(let l of h.children)l.isPointInFill(o)&&l.remove()}}},B=()=>{let e=performance.now(),t=n.size.valueAsNumber,i=n.tail.checked;for(let s in $){if(m[s]){let[r,o]=m[s],l="";for(let a of r.segments){let c=r.outline(a,t,e,i);l+=r.stroke(c)}o.setAttribute("d",l)}delete $[s]}},G=0,J=()=>{cancelAnimationFrame(G),G=requestAnimationFrame(yt)},yt=()=>{var t;B();let e=!1;for(let i in m){let s=(t=A[i])==null?void 0:t.dup();s&&m[i][0].push(s.get()),m[i][0].isSpreading()&&($[i]=!0,e=!0)}e&&J()},xt=/Mac/.test(navigator.platform);document.onkeydown=e=>{let t=e.ctrlKey,i=e.shiftKey,s=e.metaKey,r=e.altKey,o=e.keyCode,l=xt?s:t;const a=c=>{e.preventDefault(),c.focus(),c.click()};if(!t&&!i&&!s&&!r){if(o==80&&(n.eraser.checked?a(n.eraser):a(n.pressure)),o==69&&a(n.eraser),o==219||o==221){let c=n.size.valueAsNumber,d=o==221?5:-5;n.size.value=""+L(c+d,+n.size.min,+n.size.max),n.size.dispatchEvent(new InputEvent("input"))}o===84&&a(n.tail)}else l&&!i&&o==90?a(n.undo):l&&i&&o==90&&a(n.redo)};Object.assign(globalThis,{$settings:n,$svg:h,strokes:m,dirty:$,undoStack:F});
//# sourceMappingURL=index-BFRXpzmz.js.map
