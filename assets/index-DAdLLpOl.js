const D=({x:e,y:t},n=Math.hypot(e,t))=>({x:e/n,y:t/n}),A=(e,t)=>({x:e.x+t.x,y:e.y+t.y}),E=(e,t)=>({x:e.x-t.x,y:e.y-t.y}),C=(e,t)=>({x:e.x*t,y:e.y*t}),P=({x:e,y:t})=>({x:t,y:-e}),O=({x:e,y:t})=>({x:-e,y:-t}),S=({x:e,y:t},n,o)=>{const i=Math.sin(o),r=Math.cos(o),l=e-n.x,s=t-n.y,c=l*r-s*i,x=l*i+s*r;return{x:c+n.x,y:x+n.y}},J=(e,t)=>e.x*t.x+e.y*t.y,H=(e,t,n)=>A(e,C(E(t,e),n)),L=(e,t,n)=>A(e,C(t,n));class I{constructor(t,n,o,i,r){this.p=t,this.r=n,this.v=o,this.d=i,this.l=r}toJSON(){return[this.p.x,this.p.y,this.r]}dup(t=this.r){return new I(this.p,t,this.v,this.d,this.l)}}class M{constructor(t,n=t.length>0?t[t.length-1].l:0){this.points=t,this.length=n,this.sections=[0],this.pending={__proto__:null},this.queue=[],this.updateSections()}get empty(){return this.points.length==0}get dot(){return this.points.length==1}insert(t,n){if(t==this.points.length)n.forEach(o=>this.push(o,!0)),t=this.points.length,(n=this.pending[t])?(delete this.pending[t],this.insert(t,n)):this.updateSections();else if(t>this.points.length)this.pending[t]&&console.warn(`Override pending points from ${t}`),this.pending[t]=n;else throw new RangeError(`Position ${t} conflicts with existing points`)}push(t,n=!1){let{points:o}=this;if(o.length>0){let i,r=o[o.length-1];i={x:(t.x+r.p.x)/2,y:(t.y+r.p.y)/2,r:t.r};let l=r.p,s=Math.hypot(i.x-l.x,i.y-l.y);if(this.updateLength(s),this.length-r.l<5){r.r=Math.max(r.r,i.r);return}o.push(new I(i,i.r,D(E(l,i)),s,this.length)),n||this.updateSections()}else o.push(new I(t,t.r,{x:1,y:1},0,0))}outline(t,n){let o=this.sections.find(r=>t<r),i=this.points.slice(t>0?t-1:t,o);if(i.length>1){let r=[],l=[],s=i.length,c=n,x=i[0].r,y=!0;o==null&&i[s-1].r==.5&&i[s-1].d>.4*n&&(s-1>=0&&(i[s-1]=i[s-1].dup(Math.max(.1,i[s-1].r-.4))),s-2>=0&&(i[s-2]=i[s-2].dup(Math.max(.1,i[s-2].r-.2))),y=!1);for(let h=0;h<s;h++){let{p:g,r:b,v:m,d:w}=i[h];h==0&&(w=0,h<s-1&&(m=i[h+1].v));let X=Math.min(1,w/n),v=Math.min(1,1-X),Q=Math.min(1,x+(v-x)*(X*.3)),Y=(h<s-1?i[h+1]:i[h]).v,T=h<s-1?J(m,Y):1;c=Math.max(n*(.5*Q),.75);let B=C(P(H(Y,m,T)),c),V=E(g,B);r.push(V);let G=A(g,B);l.push(G),x=b}let N=[],F=[];for(let h=1/13,g=h;g<=1;g+=h)N.push(S(l[0],i[0].p,3.1416926535897933*g));if(y){let h=i[s-1],g=P(O(h.v)),b=L(h.p,g,c);for(let m=1/13,w=m;w<1;w+=m)F.push(S(b,h.p,3.1416926535897933*w))}return r.concat(F,l.reverse(),N)}else if(i.length==1){let r=i[0],l=P(O(r.v)),s=L(r.p,l,n*.36*r.r),c=[];for(let x=1/13,y=0;y<=2;y+=x)c.push(S(s,r.p,3.1416926535897933*y));return c}else return[]}updateLength(t){this.length+=t}updateSections(){let{sections:t}=this;for(let n=t.length>1?t[t.length-1]+1:2,o=this.points.length;n<o;n++)this.points[n].d<1e3&&J(this.points[n].v,this.points[n-1].v)<0&&(t.push(n),n+=1)}updateCurr(t,n){for(this.queue.push(t);this.queue.length>n;)this.queue.shift();let o=0,i=0;for(let r of this.queue)o+=r.x,i+=r.y;return n=this.queue.length,{x:o/n,y:i/n,r:t.r}}toJSON(){return this.points.map(t=>t.toJSON())}static fromJSON(t){if(!t||!Array.isArray(t))throw new RangeError("Invalid JSON representation for Stroke");return M.create(t.map(n=>({x:n[0],y:n[1],r:n[2]})))}static create(t=[]){let n=[],o=0;if(t.length>0){let i=t[0],r=0;n.push(new I(i,i.r,{x:1,y:1},0,0));for(let l=1;l<t.length;l++){let s=t[l],c=Math.hypot(s.x-i.x,s.y-i.y);if(r+=c,r-o<5){n[n.length-1].r=s.r;continue}n.push(new I(s,s.r,D(E(i,s)),c,r)),i=s,o=r}}return new M(n,o)}}let K=document.getElementById("app"),p=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","g"),f={size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),outline:document.getElementById("outline")},$={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(e,t){this.stack[this.index]={undo:e,redo:t},this.index+=1,this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index-=1,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index+=1,this.update())},update(){f.undo.disabled=!this.undoable,f.redo.disabled=!this.redoable}};p.append(d);K.append(p);f.clear.onclick=()=>{let e=Array.from(d.children);d.textContent="",$.commit(()=>d.append(...e),()=>d.textContent="")};f.undo.onclick=()=>$.undo();f.redo.onclick=()=>$.redo();let a;d.setAttribute("fill","currentColor");f.outline.oninput=()=>{f.outline.checked?(d.setAttribute("fill","none"),d.setAttribute("stroke","currentColor"),d.setAttribute("stroke-width","1")):d.setAttribute("fill","currentColor")};p.setAttribute("fill-rule","nonzero");p.style.cssText="display: block; width: 100%; height: 100%; font-size: 0; touch-action: none; position: relative; contain: content";let k=!1,u={__proto__:null},_={__proto__:null};p.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),p.setPointerCapture(e.pointerId),a=p.getBoundingClientRect();let t=M.create([{x:e.clientX-a.left,y:e.clientY-a.top,r:e.pressure}]),n=document.createElementNS("http://www.w3.org/2000/svg","path");n.style.pointerEvents="none",u[e.pointerId]=[t,n,e.clientX,e.clientY],_[e.pointerId]=!0,d.append(n),!k&&(k=!0,queueMicrotask(q))};p.onpointermove=e=>{if(e.preventDefault(),e.stopPropagation(),u[e.pointerId]){let[t,n,o,i]=u[e.pointerId];if(o==e.clientX&&i==e.clientY)return;u[e.pointerId][2]=e.clientX,u[e.pointerId][3]=e.clientY;let r;if(e.pointerType==="mouse"&&r==0&&(r=.5),e.getCoalescedEvents?e.getCoalescedEvents().forEach(l=>{t.push({x:l.clientX-a.left,y:l.clientY-a.top,r:r??l.pressure})}):t.push({x:e.clientX-a.left,y:e.clientY-a.top,r:r??e.pressure}),_[e.pointerId]=!0,e.getPredictedEvents&&(u[e.pointerId][4]=e.getPredictedEvents()[0]),k)return;k=!0,queueMicrotask(q)}};p.onpointercancel=e=>{e.preventDefault(),e.stopPropagation(),u[e.pointerId]&&(u[e.pointerId][1].remove(),delete u[e.pointerId])};p.onpointerup=p.onpointerout=e=>{if(e.preventDefault(),e.stopPropagation(),u[e.pointerId]){let[t,n,o,i,r]=u[e.pointerId],l=!0;r&&(r.clientX!=o||r.clientY!=i)?(t.push({x:Math.round(r.clientX-a.left),y:Math.round(r.clientY-a.top),r:Math.max(r.pressure,.1)}),_[r.pointerId]=!0,q()):t.empty&&(n.remove(),l=!1),console.log(t),delete u[e.pointerId],l&&$.commit(()=>n.remove(),()=>d.append(n))}};p.ontouchstart=p.ontouchmove=p.ontouchend=p.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};const z=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2}),U=({x:e,y:t})=>`M${e.toFixed(2)},${t.toFixed(2)}`,R=({x:e,y:t})=>`L${e.toFixed(2)},${t.toFixed(2)}`,W=(e,{x:t,y:n})=>`Q${e.x.toFixed(2)},${e.y.toFixed(2)} ${t.toFixed(2)},${n.toFixed(2)}`;function q(){k=!1;let e=f.size.valueAsNumber;for(let t in _)if(u[t]){let[n,o]=u[t],i="";for(let r of n.sections)i+=Z(n.outline(r,e));o.setAttribute("d",i)}_={__proto__:null}}function Z(e){if(e.length==0)return"";let t=e.shift(),n=U(t),o=1;for(let i of e)o&&(n+=R(z(t,i))),n+=W(t,z(t,i)),o=0,t=i;return n+R(e[e.length-1])}
//# sourceMappingURL=index-DAdLLpOl.js.map
