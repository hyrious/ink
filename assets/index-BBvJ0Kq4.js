const L=(e,t,s)=>e<t?t:e>s?s:e;class u{constructor(t,s){this.x=t,this.y=s}static of(t,s){return new u(t,s)}static from(t){return new u(t.x,t.y)}add(t){return new u(this.x+t.x,this.y+t.y)}subtract(t){return new u(this.x-t.x,this.y-t.y)}multiply(t){return new u(this.x*t,this.y*t)}normalize(t=Math.hypot(this.x,this.y)){return new u(this.x/t,this.y/t)}permutate(){return new u(-this.y,this.x)}negative(){return new u(-this.x,-this.y)}middle(t){return new u((this.x+t.x)/2,(this.y+t.y)/2)}rotate(t,s){const i=Math.sin(s),r=Math.cos(s),o=this.x-t.x,l=this.y-t.y,c=o*r-l*i,a=o*i+l*r;return new u(c+t.x,a+t.y)}dot(t){return this.x*t.x+this.y*t.y}lerp(t,s){return new u(this.x+(t.x-this.x)*s,this.y+(t.y-this.y)*s)}project(t,s){return new u(this.x+t.x*s,this.y+t.y*s)}}class tt{constructor(){this.value=.36,this.last=.36,this.target=.36}set(t){return this.target=t,this}update(t){if(t||(t=.016667),this.value>=0&&this.target>=0&&this.last>=0){let i=this.target-this.value,r=(this.value-this.last)/t,o=.75*i,l=.25*r,c=o-l,a=(r+c)*t;this.last=this.value,Math.abs(a)<.01&&Math.abs(i)<.01?this.value=this.target:this.value+=a}return this.value}}class g{constructor(t,s,i,r){this.x=t,this.y=s,this.p=i,this.t=r}static of(t,s,i,r){return new g(t,s,i,r)}static fromEvent(t,s=L(t.pressure||.5,0,1)){return new g(t.clientX,t.clientY,s,t.timeStamp)}static fromJSON(t){return new g(t.x,t.y,t.p,t.t)}}class z{constructor(t,s,i,r){this.p=t,this.v=s,this.d=i,this.l=r}static of(t,s,i,r){return new z(t,s,i,r)}static fromJSON(t){return new z(g.fromJSON(t.p),u.from(t.v),t.d,t.l)}}function et(e,t){return t-e.p.t>300?Math.min(e.p.p+.12,1):Math.min(e.p.p+.12*(t-e.p.t)/300,1)}function st(e,t,s){return s-t>300?Math.min(e+.12,1):Math.min(e+.12*(s-t)/300,1)}class N{constructor(t,s=t.length>0?t[t.length-1].l:0){this.points=t,this.length=s,this.segments=[0],this.pending={__proto__:null}}static of(t=[]){let s=new N([],0);for(let i of t)s._push(i);return s._updateSegments(),s}static fromJSON(t){let s=new N(t.points.map(z.fromJSON),t.length);return s.segments=t.segments,s.pending=t.pending,s}get empty(){return this.length==0}get dot(){return this.points.length==1}insert(t,s){if(t==this.points.length){for(let i of s)this._push(i);t=this.points.length,(s=this.pending[t])?(delete this.pending[t],this.insert(t,s)):this._updateSegments()}else if(t>this.points.length)this.pending[t]=s;else throw new RangeError(`Position ${t} conflicts with existing points`);return this}push(t){return this._push(t),this._updateSegments(),this}_push(t){let s=this.points;if(s.length>0){let i=s[s.length-1],r=Math.hypot(t.x-i.p.x,t.y-i.p.y);if(this._updateLength(r),this.length-i.l<4){i.p.p=Math.max(i.p.p,t.p);return}s.push(z.of(t,u.from(t).subtract(i.p).normalize(),r,this.length))}else s.push(z.of(t,u.of(0,0),0,0))}isSpreading(t=performance.now()){return this.points.length>0&&t-this.points[this.points.length-1].p.t<300}outline(t,s,i=performance.now()){let r=this.segments.find(l=>t<l),o=this.points.slice(t>0?t-1:t,r);if(o.length>1){let l=[],c=[],a=o.length,w=s,E=o[0].p.p,D=!0,B=0,H=new tt;if(r==null&&a>=2){let p=o[a-2];(p.p.p==.5||p.p.p==1)&&p.d>.4*s&&(D=!1)}for(let p=0;p<a;p++){let{p:f,v:P,d:I}=o[p];p==0&&(I=0,P=o[1].v);let $=Math.min(1,I/s),Z=Math.min(1,1-$),y=Math.min(1,E+(Z-E)*($*.7)),K=(p<a-1?o[p+1]:o[p]).v,_=p<a-1?P.dot(K):1;y=H.set(y).update(B&&(f.t-B)/1e3),D||(p==a-1&&(y=.05),p==a-2&&(y=Math.max(.1,y-.2)),p==a-3&&(y=Math.max(.1,y-.1))),w=L(s*.5*st(y,f.t,i),.75,s/2);let Q=K.lerp(P,_).permutate().multiply(w),j=u.from(f).subtract(Q),V=u.from(f).add(Q);l.push(j),c.push(V),B=f.t,E=f.p}let J=[],W=c[0],q=[];for(let p=1/13,f=0;f<=1;f+=p)J.push(W.rotate(o[0].p,3.1416926535897933*f));if(D){let p=o[a-1],f=p.v.negative().permutate(),P=u.from(p.p).project(f,w);for(let I=1/13,$=0;$<1;$+=I)q.push(P.rotate(p.p,3.1416926535897933*$))}return l.concat(q,c.reverse(),J)}else if(o.length==1){let l=o[0],c=u.from(l.p).project(u.of(1,0),s*.36*et(l,i)),a=[];for(let w=1/13,E=0;E<=2;E+=w)a.push(c.rotate(l.p,3.1416926535897933*E));return a}else return[]}stroke(t=this.points.map(s=>s.p)){let s=t.length;if(s==0)return"";let i=t[0],r=`M${i.x.toFixed(2)},${i.y.toFixed(2)}`;for(let o=1;o<s;o++){let l=t[o],c=u.from(i).middle(l);o==1?r+=`L${c.x.toFixed(2)},${c.y.toFixed(2)}`:r+=`Q${i.x.toFixed(2)},${i.y.toFixed(2)} ${c.x.toFixed(2)},${c.y.toFixed(2)}`,i=l}return s>1&&(r+=`L${i.x.toFixed(2)},${i.y.toFixed(2)}`),r}_updateLength(t){this.length+=t}_updateSegments(){let t=this.segments,s=this.points,i=s.length;for(let r=t[t.length-1]+1;r<i;r++)s[r].v.dot(s[r-1].v)<0&&(t.push(r),r++)}}let X=document.getElementById("app"),h=X.appendChild(document.createElementNS("http://www.w3.org/2000/svg","svg")),m=X.appendChild(document.createElement("div")),n={color:document.getElementById("stroke-color"),size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),pressure:document.getElementById("pressure"),eraser:document.getElementById("eraser"),smooth:document.getElementById("smooth")},it=n.pressure.checked,nt=n.smooth.value,rt=n.size.valueAsNumber;h.setAttribute("fill-rule","nonzero");h.setAttribute("fill","currentColor");h.style.cssText=`display: block; width: 100%; height: 100%;
font-size: 0; touch-action: none; position: relative; contain: content;
overflow: hidden; overscroll-behavior: none;`;m.style.cssText=`display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
touch-action: none; contain: content; z-index: 1;`;let ot=matchMedia("(prefers-color-scheme: dark)"),Y=()=>ot.matches?"#ffffff":"#000000";n.color.value=Y();n.color.onchange=n.color.oninput=()=>{F()};n.size.onchange=n.size.oninput=()=>{F()};n.clear.onclick=()=>{let e=Array.from(h.children);h.textContent="",S.commit(()=>h.append(...e),()=>h.textContent="")};n.undo.onclick=()=>S.undo();n.redo.onclick=()=>S.redo();let M;n.pressure.oninput=()=>{M=n.pressure.checked?void 0:.5,F()};n.smooth.onchange=n.smooth.oninput=()=>{F()};n.eraser.oninput=()=>{let e=n.eraser.checked;m.style.cursor=e?`url(https://api.iconify.design/mdi:eraser.svg?color=${encodeURIComponent(n.color.value)}) 12 32, auto`:"default",m.style.display=e?"block":"none"};for(let e=1;e<=15;e++){let t=document.createElement("option");t.value=t.textContent=String(e),n.smooth.appendChild(t)}let x=new URL(location.href).searchParams;x.has("color")&&(n.color.value=x.get("color"));x.has("size")&&(n.size.value=x.get("size"));x.has("pressure")&&(n.pressure.checked=x.get("pressure")!=="0",n.pressure.dispatchEvent(new InputEvent("input")));x.has("smooth")&&(n.smooth.value=x.get("smooth"));let F=()=>{let e="";n.color.value!==Y()&&(e+=`&color=${n.color.value.slice(1)}`),n.size.valueAsNumber!==rt&&(e+=`&size=${n.size.valueAsNumber}`),n.pressure.checked!==it&&(e+=`&pressure=${n.pressure.checked?1:0}`),n.smooth.value!==nt&&(e+=`&smooth=${n.smooth.value}`),history.replaceState({},"",e?e.replace("&","?"):location.pathname)},v=new Map;h.onpointerdown=e=>{let t=e.pointerId;v.has(t)&&G(t),v.set(t,e),e.preventDefault(),e.stopPropagation(),h.setPointerCapture(t),pt(t,g.fromEvent(e,M))};h.onpointermove=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),v.has(t)){let s=v.get(t);if(s.clientX===e.clientX&&s.clientY===e.clientY)return;if(v.set(t,e),e.getCoalescedEvents)for(let i of e.getCoalescedEvents())O(t,g.fromEvent(i,M));else O(t,g.fromEvent(e,M))}};h.onpointerup=h.onpointerout=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),v.has(t)){if(e.getPredictedEvents){let s=v.get(t).getPredictedEvents()[0];s&&O(t,g.fromEvent(s,M))}ct(t),v.delete(t)}};h.onpointercancel=e=>{let t=e.pointerId;e.preventDefault(),e.stopPropagation(),v.has(t)&&(G(t),v.delete(t))};h.ontouchstart=h.ontouchmove=h.ontouchend=h.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let b;m.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),m.setPointerCapture(e.pointerId),R(b=g.fromEvent(e))};m.onpointermove=e=>{if(b){e.preventDefault(),e.stopPropagation();let t=g.fromEvent(e);R(t),b=t}};m.onpointerup=m.onpointerout=e=>{b=void 0};m.ontouchstart=m.ontouchmove=m.ontouchend=m.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let S={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(e,t){for(this.stack[this.index]={undo:e,redo:t},this.index++;this.stack.length>20;)this.stack.shift(),this.index--;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index--,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index++,this.update())},update(){n.undo.disabled=!this.undoable,n.redo.disabled=!this.redoable}};class lt{push(t){return this.item=t,this}dup(){if(this.item)return this}get(){return this.item}}class ht{constructor(t,s=2){this.compute=t,this.capacity=s,this.items=[],this.size=0}push(t){for(this.items.push(t),this.size++;this.size>this.capacity;)this.items.shift(),this.size--;return this}dup(){if(this.size>0)return this.push(this.items[this.items.length-1])}get(){return this.compute(this.items)}}let at=e=>{let t=0,s=0,i=.5,r=0;for(let o of e)t+=o.x,s+=o.y,i=o.p,r=o.t;return g.of(t/e.length,s/e.length,i,r)},ut=e=>{if(n.smooth.value=="0")return new lt().push(e);{let t=Number.parseInt(n.smooth.value)+1;return new ht(at,t).push(e)}},d={},C={},k={},pt=(e,t)=>{let s=N.of([t]),i=h.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path"));i.style.pointerEvents="none",i.style.fill=n.color.value,d[e]=[s,i],C[e]=ut(t),k[e]=!0,A()},O=(e,t)=>{d[e]&&(d[e][0].push(C[e].push(t).get()),k[e]=!0,A(),T())},G=e=>{d[e]&&(d[e][1].remove(),delete C[e],delete d[e],delete k[e])},ct=e=>{if(d[e]){let[t,s]=d[e],i=!0;t.empty&&!t.dot&&(s.remove(),i=!1),A(),delete C[e],delete k[e],T(),i&&S.commit(()=>s.remove(),()=>h.append(s))}},R=e=>{let t=h.createSVGPoint();t.x=e.x,t.y=e.y;for(let s of h.children)s.isPointInFill(t)&&s.remove();if(b){let s=e.x-b.x,i=e.y-b.y;for(let r=0;r<1;r+=.1){let o=h.createSVGPoint();o.x=e.x-r*s,o.y=e.y-r*i;for(let l of h.children)l.isPointInFill(o)&&l.remove()}}},A=()=>{let e=n.size.valueAsNumber;for(let t in k){if(d[t]){let[s,i]=d[t],r="";for(let o of s.segments){let l=s.outline(o,e);r+=s.stroke(l)}i.setAttribute("d",r)}delete k[t]}},U=0,T=()=>{cancelAnimationFrame(U),U=requestAnimationFrame(dt)},dt=()=>{var t;A();let e=!1;for(let s in d){let i=(t=C[s])==null?void 0:t.dup();i&&d[s][0].push(i.get()),d[s][0].isSpreading()&&(k[s]=!0,e=!0)}e&&T()},ft=/Mac/.test(navigator.platform);document.onkeydown=e=>{let t=e.ctrlKey,s=e.shiftKey,i=e.metaKey,r=e.altKey,o=e.keyCode,l=ft?i:t;const c=a=>{e.preventDefault(),a.focus(),a.click()};if(!t&&!s&&!i&&!r){if(o==80&&(n.eraser.checked?c(n.eraser):c(n.pressure)),o==69&&c(n.eraser),o==219||o==221){let a=n.size.valueAsNumber,w=o==221?5:-5;n.size.value=""+L(a+w,+n.size.min,+n.size.max)}}else l&&!s&&o==90?c(n.undo):l&&s&&o==90&&c(n.redo)};Object.assign(globalThis,{$settings:n,$svg:h,strokes:d,dirty:k,undoStack:S});
//# sourceMappingURL=index-BBvJ0Kq4.js.map
