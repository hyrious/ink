const L=(e,t,s)=>e<t?t:e>s?s:e;class p{constructor(t,s){this.x=t,this.y=s}static of(t,s){return new p(t,s)}static from(t){return new p(t.x,t.y)}add(t){return new p(this.x+t.x,this.y+t.y)}subtract(t){return new p(this.x-t.x,this.y-t.y)}multiply(t){return new p(this.x*t,this.y*t)}normalize(t=Math.hypot(this.x,this.y)){return new p(this.x/t,this.y/t)}permutate(){return new p(-this.y,this.x)}negative(){return new p(-this.x,-this.y)}middle(t){return new p((this.x+t.x)/2,(this.y+t.y)/2)}rotate(t,s){const i=Math.sin(s),r=Math.cos(s),o=this.x-t.x,l=this.y-t.y,c=o*r-l*i,a=o*i+l*r;return new p(c+t.x,a+t.y)}dot(t){return this.x*t.x+this.y*t.y}lerp(t,s){return new p(this.x+(t.x-this.x)*s,this.y+(t.y-this.y)*s)}project(t,s){return new p(this.x+t.x*s,this.y+t.y*s)}}class tt{constructor(){this.value=.36,this.last=.36,this.target=.36}set(t){return this.target=t,this}update(t){if(t||(t=.016667),this.value>=0&&this.target>=0&&this.last>=0){let i=this.target-this.value,r=(this.value-this.last)/t,o=.75*i,l=.25*r,c=o-l,a=(r+c)*t;this.last=this.value,Math.abs(a)<.01&&Math.abs(i)<.01?this.value=this.target:this.value+=a}return this.value}}class g{constructor(t,s,i,r){this.x=t,this.y=s,this.p=i,this.t=r}static of(t,s,i,r){return new g(t,s,i,r)}static fromEvent(t,s=L(t.pressure||.5,0,1)){return new g(t.clientX,t.clientY,s,t.timeStamp)}static fromJSON(t){return new g(t.x,t.y,t.p,t.t)}}class M{constructor(t,s,i,r){this.p=t,this.v=s,this.d=i,this.l=r}static of(t,s,i,r){return new M(t,s,i,r)}static fromJSON(t){return new M(g.fromJSON(t.p),p.from(t.v),t.d,t.l)}}function et(e,t){return t-e.p.t>300?Math.min(e.p.p+.12,1):Math.min(e.p.p+.12*(t-e.p.t)/300,1)}function st(e,t,s){return s-t>300?Math.min(e+.12,1):Math.min(e+.12*(s-t)/300,1)}class N{constructor(t,s=t.length>0?t[t.length-1].l:0){this.points=t,this.length=s,this.segments=[0],this.pending={__proto__:null}}static of(t=[]){let s=new N([],0);for(let i of t)s._push(i);return s._updateSegments(),s}static fromJSON(t){let s=new N(t.points.map(M.fromJSON),t.length);return s.segments=t.segments,s.pending=t.pending,s}get empty(){return this.length==0}get dot(){return this.points.length==1}insert(t,s){if(t==this.points.length){for(let i of s)this._push(i);t=this.points.length,(s=this.pending[t])?(delete this.pending[t],this.insert(t,s)):this._updateSegments()}else if(t>this.points.length)this.pending[t]=s;else throw new RangeError(`Position ${t} conflicts with existing points`);return this}push(t){return this._push(t),this._updateSegments(),this}_push(t){let s=this.points;if(s.length>0){let i=s[s.length-1],r=Math.hypot(t.x-i.p.x,t.y-i.p.y);if(this._updateLength(r),this.length-i.l<4){i.p.p=Math.max(i.p.p,t.p);return}s.push(M.of(t,p.from(t).subtract(i.p).normalize(),r,this.length))}else s.push(M.of(t,p.of(0,0),0,0))}isSpreading(t=performance.now()){return this.points.length>0&&t-this.points[this.points.length-1].p.t<300}outline(t,s,i=performance.now()){let r=this.segments.find(l=>t<l),o=this.points.slice(t>0?t-1:t,r);if(o.length>1){let l=[],c=[],a=o.length,$=s,z=o[0].p.p,D=!0,B=0,H=new tt;if(r==null&&a>=2){let u=o[a-2];if(u.p.p==.5||u.p.p==1){let d=u.d,x=u,k=0;for(let v=a-3;v>=0&&(x=o[v],d+=x.d,k=u.p.t-x.p.t,!(k<=0||k>100));v--);d>.4*s&&(D=!1)}}for(let u=0;u<a;u++){let{p:d,v:x,d:k}=o[u];u==0&&(k=0,x=o[1].v);let v=Math.min(1,k/s),Z=Math.min(1,1-v),w=Math.min(1,z+(Z-z)*(v*.7)),K=(u<a-1?o[u+1]:o[u]).v,_=u<a-1?x.dot(K):1;w=H.set(w).update(B&&(d.t-B)/1e3),D||(u==a-1&&(w=.05),u==a-2&&(w=Math.max(.1,w-.2)),u==a-3&&(w=Math.max(.1,w-.1))),$=L(s*.5*st(w,d.t,i),.75,s/2);let Q=K.lerp(x,_).permutate().multiply($),j=p.from(d).subtract(Q),V=p.from(d).add(Q);l.push(j),c.push(V),B=d.t,z=d.p}let J=[],W=c[0],q=[];for(let u=1/13,d=0;d<=1;d+=u)J.push(W.rotate(o[0].p,3.1416926535897933*d));if(D){let u=o[a-1],d=u.v.negative().permutate(),x=p.from(u.p).project(d,$);for(let k=1/13,v=0;v<1;v+=k)q.push(x.rotate(u.p,3.1416926535897933*v))}return l.concat(q,c.reverse(),J)}else if(o.length==1){let l=o[0],c=p.from(l.p).project(p.of(1,0),s*.36*et(l,i)),a=[];for(let $=1/13,z=0;z<=2;z+=$)a.push(c.rotate(l.p,3.1416926535897933*z));return a}else return[]}stroke(t=this.points.map(s=>s.p)){let s=t.length;if(s==0)return"";let i=t[0],r=`M${i.x.toFixed(2)},${i.y.toFixed(2)}`;for(let o=1;o<s;o++){let l=t[o],c=p.from(i).middle(l);o==1?r+=`L${c.x.toFixed(2)},${c.y.toFixed(2)}`:r+=`Q${i.x.toFixed(2)},${i.y.toFixed(2)} ${c.x.toFixed(2)},${c.y.toFixed(2)}`,i=l}return s>1&&(r+=`L${i.x.toFixed(2)},${i.y.toFixed(2)}`),r}_updateLength(t){this.length+=t}_updateSegments(){let t=this.segments,s=this.points,i=s.length;for(let r=t[t.length-1]+1;r<i;r++)s[r].v.dot(s[r-1].v)<0&&(t.push(r),r++)}}let X=document.getElementById("app"),h=X.appendChild(document.createElementNS("http://www.w3.org/2000/svg","svg")),m=X.appendChild(document.createElement("div")),n={color:document.getElementById("stroke-color"),size:document.getElementById("stroke-size"),clear:document.getElementById("clear"),undo:document.getElementById("undo"),redo:document.getElementById("redo"),pressure:document.getElementById("pressure"),eraser:document.getElementById("eraser"),smooth:document.getElementById("smooth")},it=n.pressure.checked,nt=n.smooth.value,rt=n.size.valueAsNumber;h.setAttribute("fill-rule","nonzero");h.setAttribute("fill","currentColor");h.style.cssText=`display: block; width: 100%; height: 100%;
font-size: 0; touch-action: none; position: relative; contain: content;
overflow: hidden; overscroll-behavior: none;`;m.style.cssText=`display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
touch-action: none; contain: content; z-index: 1;`;let ot=matchMedia("(prefers-color-scheme: dark)"),Y=()=>ot.matches?"#ffffff":"#000000";n.color.value=Y();n.color.onchange=n.color.oninput=()=>{F()};n.size.onchange=n.size.oninput=()=>{F()};n.clear.onclick=()=>{let e=Array.from(h.children);h.textContent="",C.commit(()=>h.append(...e),()=>h.textContent="")};n.undo.onclick=()=>C.undo();n.redo.onclick=()=>C.redo();let S;n.pressure.oninput=()=>{S=n.pressure.checked?void 0:.5,F()};n.smooth.onchange=n.smooth.oninput=()=>{F()};n.eraser.oninput=()=>{let e=n.eraser.checked;m.style.cursor=e?`url(https://api.iconify.design/mdi:eraser.svg?color=${encodeURIComponent(n.color.value)}) 12 32, auto`:"default",m.style.display=e?"block":"none"};for(let e=1;e<=15;e++){let t=document.createElement("option");t.value=t.textContent=String(e),n.smooth.appendChild(t)}let E=new URL(location.href).searchParams;E.has("color")&&(n.color.value="#"+E.get("color"));E.has("size")&&(n.size.value=E.get("size"));E.has("pressure")&&(n.pressure.checked=E.get("pressure")!=="0",n.pressure.dispatchEvent(new InputEvent("input")));E.has("smooth")&&(n.smooth.value=E.get("smooth"));let F=()=>{let e="";n.color.value!==Y()&&(e+=`&color=${n.color.value.slice(1)}`),n.size.valueAsNumber!==rt&&(e+=`&size=${n.size.valueAsNumber}`),n.pressure.checked!==it&&(e+=`&pressure=${n.pressure.checked?1:0}`),n.smooth.value!==nt&&(e+=`&smooth=${n.smooth.value}`),history.replaceState({},"",e?e.replace("&","?"):location.pathname)},y=new Map;h.onpointerdown=e=>{let t=e.pointerId;y.has(t)&&G(t),y.set(t,e),e.preventDefault(),e.stopPropagation(),h.setPointerCapture(t),pt(t,g.fromEvent(e,S))};h.onpointermove=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),y.has(t)){let s=y.get(t);if(s.clientX===e.clientX&&s.clientY===e.clientY)return;if(y.set(t,e),e.getCoalescedEvents)for(let i of e.getCoalescedEvents())O(t,g.fromEvent(i,S));else O(t,g.fromEvent(e,S))}};h.onpointerup=h.onpointerout=e=>{let t=e.pointerId;if(e.preventDefault(),e.stopPropagation(),y.has(t)){if(e.getPredictedEvents){let s=y.get(t).getPredictedEvents()[0];s&&O(t,g.fromEvent(s,S))}ct(t),y.delete(t)}};h.onpointercancel=e=>{let t=e.pointerId;e.preventDefault(),e.stopPropagation(),y.has(t)&&(G(t),y.delete(t))};h.ontouchstart=h.ontouchmove=h.ontouchend=h.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let P;m.onpointerdown=e=>{e.preventDefault(),e.stopPropagation(),m.setPointerCapture(e.pointerId),R(P=g.fromEvent(e))};m.onpointermove=e=>{if(P){e.preventDefault(),e.stopPropagation();let t=g.fromEvent(e);R(t),P=t}};m.onpointerup=m.onpointerout=e=>{P=void 0};m.ontouchstart=m.ontouchmove=m.ontouchend=m.ontouchcancel=e=>{e.preventDefault(),e.stopPropagation()};let C={index:0,stack:[],get undoable(){return this.index>0},get redoable(){return this.index<this.stack.length},commit(e,t){for(this.stack[this.index]={undo:e,redo:t},this.index++;this.stack.length>20;)this.stack.shift(),this.index--;this.stack.length=this.index,this.update()},undo(){this.undoable&&(this.index--,this.stack[this.index].undo(),this.update())},redo(){this.redoable&&(this.stack[this.index].redo(),this.index++,this.update())},update(){n.undo.disabled=!this.undoable,n.redo.disabled=!this.redoable}};class lt{push(t){return this.item=t,this}dup(){if(this.item)return this}get(){return this.item}}class ht{constructor(t,s=2){this.compute=t,this.capacity=s,this.items=[],this.size=0}push(t){for(this.items.push(t),this.size++;this.size>this.capacity;)this.items.shift(),this.size--;return this}dup(){if(this.size>0)return this.push(this.items[this.items.length-1])}get(){return this.compute(this.items)}}let at=e=>{let t=0,s=0,i=.5,r=0;for(let o of e)t+=o.x,s+=o.y,i=o.p,r=o.t;return g.of(t/e.length,s/e.length,i,r)},ut=e=>{if(n.smooth.value=="0")return new lt().push(e);{let t=Number.parseInt(n.smooth.value)+1;return new ht(at,t).push(e)}},f={},I={},b={},pt=(e,t)=>{let s=N.of([t]),i=h.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path"));i.style.pointerEvents="none",i.style.fill=n.color.value,f[e]=[s,i],I[e]=ut(t),b[e]=!0,A()},O=(e,t)=>{f[e]&&(f[e][0].push(I[e].push(t).get()),b[e]=!0,A(),T())},G=e=>{f[e]&&(f[e][1].remove(),delete I[e],delete f[e],delete b[e])},ct=e=>{if(f[e]){let[t,s]=f[e],i=!0;t.empty&&!t.dot&&(s.remove(),i=!1),A(),delete I[e],delete b[e],T(),i&&C.commit(()=>s.remove(),()=>h.append(s))}},R=e=>{let t=h.createSVGPoint();t.x=e.x,t.y=e.y;for(let s of h.children)s.isPointInFill(t)&&s.remove();if(P){let s=e.x-P.x,i=e.y-P.y;for(let r=0;r<1;r+=.1){let o=h.createSVGPoint();o.x=e.x-r*s,o.y=e.y-r*i;for(let l of h.children)l.isPointInFill(o)&&l.remove()}}},A=()=>{let e=n.size.valueAsNumber;for(let t in b){if(f[t]){let[s,i]=f[t],r="";for(let o of s.segments){let l=s.outline(o,e);r+=s.stroke(l)}i.setAttribute("d",r)}delete b[t]}},U=0,T=()=>{cancelAnimationFrame(U),U=requestAnimationFrame(dt)},dt=()=>{var t;A();let e=!1;for(let s in f){let i=(t=I[s])==null?void 0:t.dup();i&&f[s][0].push(i.get()),f[s][0].isSpreading()&&(b[s]=!0,e=!0)}e&&T()},ft=/Mac/.test(navigator.platform);document.onkeydown=e=>{let t=e.ctrlKey,s=e.shiftKey,i=e.metaKey,r=e.altKey,o=e.keyCode,l=ft?i:t;const c=a=>{e.preventDefault(),a.focus(),a.click()};if(!t&&!s&&!i&&!r){if(o==80&&(n.eraser.checked?c(n.eraser):c(n.pressure)),o==69&&c(n.eraser),o==219||o==221){let a=n.size.valueAsNumber,$=o==221?5:-5;n.size.value=""+L(a+$,+n.size.min,+n.size.max)}}else l&&!s&&o==90?c(n.undo):l&&s&&o==90&&c(n.redo)};Object.assign(globalThis,{$settings:n,$svg:h,strokes:f,dirty:b,undoStack:C});
//# sourceMappingURL=index-CYC4ccks.js.map
